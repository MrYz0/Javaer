---
title: MyBatis
date: 2022-07-21 09:19:25
permalink: /frame/MyBatis/
categories:
  - æ¡†æ¶
  - æ•°æ®åº“
tags:
  - 
author: 
  name: æ¨æ´²
  link: https://github.com/xugaoyi
---

# MyBatis

> MyBatiså­¦ä¹ ç›®æ ‡

![MyBatis](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/MyBatis.png)

## ä¸€ã€Mybatisç®€ä»‹

### 1ã€Mybatiså†å²

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyBatisæœ€åˆæ˜¯Apacheçš„ä¸€ä¸ªå¼€æºé¡¹ç›®**iBatis**, 2010å¹´6æœˆè¿™ä¸ªé¡¹ç›®ç”±Apache Software Foundationè¿ç§»åˆ°äº†Google Codeã€‚éšç€å¼€å‘å›¢é˜Ÿè½¬æŠ•Google Codeæ——ä¸‹ï¼Œ iBatis3.xæ­£å¼æ›´åä¸ºMyBatisã€‚ä»£ç äº2013å¹´11æœˆè¿ç§»åˆ°Githubã€‚

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iBatisä¸€è¯æ¥æºäºâ€œinternetâ€å’Œâ€œabatisâ€çš„ç»„åˆï¼Œæ˜¯ä¸€ä¸ªåŸºäºJavaçš„æŒä¹…å±‚æ¡†æ¶ã€‚ iBatisæä¾›çš„æŒä¹…å±‚æ¡†æ¶åŒ…æ‹¬SQL Mapså’ŒData Access Objectsï¼ˆDAOï¼‰ã€‚

å®˜ç½‘ï¼š[https://mybatis.org/mybatis-3/zh/index.html](https://mybatis.org/mybatis-3/zh/index.html)

![image-20220727201858267](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220727201858267.png)

### 2ã€MyBatisç‰¹æ€§

1ï¼‰ MyBatis æ˜¯æ”¯æŒå®šåˆ¶åŒ– SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„çš„ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶

2ï¼‰ MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†

3ï¼‰ MyBatiså¯ä»¥ä½¿ç”¨ç®€å•çš„XMLæˆ–æ³¨è§£ç”¨äºé…ç½®å’ŒåŸå§‹æ˜ å°„ï¼Œå°†æ¥å£å’ŒJavaçš„POJOï¼ˆPlain Old Java

Objectsï¼Œæ™®é€šçš„Javaå¯¹è±¡ï¼‰æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•

4ï¼‰ MyBatis æ˜¯ä¸€ä¸ª åŠè‡ªåŠ¨çš„ORMï¼ˆObject Relation Mappingï¼‰æ¡†æ¶

### 3ã€Mybatisä¸‹è½½

MyBatisä¸‹è½½åœ°å€ï¼š[https://github.com/mybatis/mybatis-3](https://github.com/mybatis/mybatis-3)

![](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220727174728831.png)

![image-20220727174848318](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220727174848318.png)

### 4ã€å’Œå…¶ä»–æŒä¹…åŒ–å±‚æŠ€æœ¯å¯¹æ¯”

- JDBC

  - SQL å¤¹æ‚åœ¨Javaä»£ç ä¸­è€¦åˆåº¦é«˜ï¼Œå¯¼è‡´ç¡¬ç¼–ç å†…ä¼¤

  - ç»´æŠ¤ä¸æ˜“ä¸”å®é™…å¼€å‘éœ€æ±‚ä¸­ SQL æœ‰å˜åŒ–ï¼Œé¢‘ç¹ä¿®æ”¹çš„æƒ…å†µå¤šè§

  - ä»£ç å†—é•¿ï¼Œå¼€å‘æ•ˆç‡ä½

- Hibernate å’Œ JPA

  - æ“ä½œç®€ä¾¿ï¼Œå¼€å‘æ•ˆç‡é«˜

  - ç¨‹åºä¸­çš„é•¿éš¾å¤æ‚ SQL éœ€è¦ç»•è¿‡æ¡†æ¶

  - å†…éƒ¨è‡ªåŠ¨ç”Ÿäº§çš„ SQLï¼Œä¸å®¹æ˜“åšç‰¹æ®Šä¼˜åŒ–

  - åŸºäºå…¨æ˜ å°„çš„å…¨è‡ªåŠ¨æ¡†æ¶ï¼Œå¤§é‡å­—æ®µçš„ POJO è¿›è¡Œéƒ¨åˆ†æ˜ å°„æ—¶æ¯”è¾ƒå›°éš¾ã€‚

  - åå°„æ“ä½œå¤ªå¤šï¼Œå¯¼è‡´æ•°æ®åº“æ€§èƒ½ä¸‹é™

- MyBatis

  - è½»é‡çº§ï¼Œæ€§èƒ½å‡ºè‰²

  - SQL å’Œ Java ç¼–ç åˆ†å¼€ï¼ŒåŠŸèƒ½è¾¹ç•Œæ¸…æ™°ã€‚Javaä»£ç ä¸“æ³¨ä¸šåŠ¡ã€SQLè¯­å¥ä¸“æ³¨æ•°æ®

  - å¼€å‘æ•ˆç‡ç¨é€ŠäºHIbernateï¼Œä½†æ˜¯å®Œå…¨èƒ½å¤Ÿæ¥å—

## äºŒã€æ­å»ºMybatis

### 1ã€å¼€å‘ç¯å¢ƒ

IDEï¼šidea 2022.2

æ„å»ºå·¥å…·ï¼šmaven 3.8.5

MySQLç‰ˆæœ¬ï¼šMySQL 5.7

MyBatisç‰ˆæœ¬ï¼šMyBatis 3.5.7

### 2ã€åˆ›å»ºMaveå·¥ç¨‹

#### a>æ‰“åŒ…æ–¹å¼ï¼šjaråŒ…

````xml
    <packaging>jar</packaging>
````

#### b>å¼•å…¥ä¾èµ–

````xml
    <dependencies>
        <!-- Mybatisæ ¸å¿ƒ -->
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
            <version>3.5.7</version>
        </dependency>
        <!-- junitæµ‹è¯• -->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.12</version>
            <scope>test</scope>
        </dependency>
        <!-- MySQLé©±åŠ¨ -->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>8.0.29</version>
        </dependency>
    </dependencies>
````

### 3ã€åˆ›å»ºMybatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶

> ä¹ æƒ¯ä¸Šå‘½åä¸ºmybatis-config.xmlï¼Œè¿™ä¸ªæ–‡ä»¶åä»…ä»…åªæ˜¯å»ºè®®ï¼Œå¹¶éå¼ºåˆ¶è¦æ±‚ã€‚å°†æ¥æ•´åˆSpringä¹‹åï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥çœç•¥ï¼Œæ‰€ä»¥å¤§å®¶æ“ä½œæ—¶å¯ä»¥ç›´æ¥å¤åˆ¶ã€ç²˜è´´ã€‚
>
> **æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸»è¦ç”¨äºé…ç½®è¿æ¥æ•°æ®åº“çš„ç¯å¢ƒä»¥åŠMyBatisçš„å…¨å±€é…ç½®ä¿¡æ¯**
>
> æ ¸å¿ƒé…ç½®æ–‡ä»¶å­˜æ”¾çš„ä½ç½®æ˜¯src/main/resourcesç›®å½•ä¸‹ï¼šmybatis-config.xml

````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <!--è®¾ç½®è¿æ¥æ•°æ®åº“çš„ç¯å¢ƒ-->
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://localhost:3306/MyBatis"/>
                <property name="username" value="root"/>
                <property name="password" value="123456"/>
            </dataSource>
        </environment>
    </environments>
    <!--å¼•å…¥æ˜ å°„æ–‡ä»¶-->
    <mappers>
        <mapper resource="mappers/UserMapper.xml"></mapper>
    </mappers>
</configuration>
````

### 4ã€åˆ›å»ºå®ä½“ç±»

````java
package com.yz.Mybatis_demo1.entity;

import lombok.Data;

/**
 * ç”¨æˆ·
 *
 * @Author æ¨æ´²
 * @Date 2022/7/27 20:27
 */
@Data
public class User {

    /**
     * id
     */
    private Integer id;

    /**
     * ç”¨æˆ·å
     */
    private String username;

    /**
     * å¯†ç 
     */
    private String password;

    /**
     * å¹´é¾„
     */
    private Integer age;

    /**
     * æ€§åˆ«
     */
    private String sex;

    /**
     * ç”µå­é‚®ä»¶
     */
    private String email;
}

````

### 5ã€åˆ›å»ºmapperæ¥å£

> MyBatisä¸­çš„mapperæ¥å£ç›¸å½“äºä»¥å‰çš„daoã€‚ä½†æ˜¯åŒºåˆ«åœ¨äºï¼Œmapperä»…ä»…æ˜¯æ¥å£ï¼Œæˆ‘ä»¬ä¸éœ€è¦æä¾›å®ç°ç±»ã€‚

````java
package com.yz.Mybatis_demo1.mapper;

/**
 * ç”¨æˆ·æ˜ å°„å™¨
 *
 * @Author æ¨æ´²
 * @Date 2022/7/27 18:09
 */
public interface UserMapper {

    /**
     * æ’å…¥ç”¨æˆ·
     *
     */
    int insertUser();
}
````

### 6ã€åˆ›å»ºMyBatisçš„æ˜ å°„æ–‡ä»¶

ç›¸å…³æ¦‚å¿µï¼š**ORM(Obejct Relationship Mapping)**å¯¹è±¡å…³ç³»æ˜ å°„ã€‚

- å¯¹è±¡ï¼šJavaçš„å®ä½“ç±»å¯¹è±¡
- å…³ç³»ï¼šå…³ç³»å‹æ•°æ®åº“
- æ˜ å°„ï¼šäºŒè€…ä¹‹é—´çš„å¯¹åº”å…³ç³»

| Javaæ¦‚å¿µ | æ•°æ®åº“æ¦‚å¿µ |
| -------- | ---------- |
| ç±»       | è¡¨         |
| å±æ€§     | å­—æ®µ/åˆ—    |
| å¯¹è±¡     | è®°å½•/è¡Œ    |

::: note

1ã€æ˜ å°„æ–‡ä»¶çš„å‘½åè§„åˆ™ï¼š

è¡¨å¯¹åº”çš„å®ä½“ç±»çš„ç±»å+Mapper.xml

ä¾‹å¦‚ï¼šè¡¨t_userï¼Œæ˜ å°„çš„å®ä½“ç±»ä¸ºUserï¼Œæ‰€å¯¹åº”çš„æ˜ å°„æ–‡ä»¶ä¸ºUserMapper.xml

å› æ­¤ä¸€ä¸ªæ˜ å°„æ–‡ä»¶å¯¹åº”ä¸€ä¸ªå®ä½“ç±»ï¼Œå¯¹åº”ä¸€å¼ è¡¨çš„æ“ä½œ

MyBatisæ˜ å°„æ–‡ä»¶ç”¨äºç¼–å†™SQLï¼Œè®¿é—®ä»¥åŠæ“ä½œè¡¨ä¸­çš„æ•°æ®

MyBatisæ˜ å°„æ–‡ä»¶å­˜æ”¾çš„ä½ç½®æ˜¯src/main/resources/mappersç›®å½•ä¸‹

2ã€MyBatisä¸­å¯ä»¥é¢å‘æ¥å£æ“ä½œæ•°æ®ï¼Œè¦ä¿è¯ä¸¤ä¸ªä¸€è‡´ï¼š

a>mapperæ¥å£çš„å…¨ç±»åå’Œæ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´(namespace)ä¿æŒä¸€è‡´

b>mapperæ¥å£ä¸­çš„æ–¹æ³•çš„æ–¹æ³•åå’Œæ˜ å°„æ–‡ä»¶ä¸­ç¼–å†™SQLçš„æ ‡ç­¾çš„idå±æ€§ä¿æŒä¸€è‡´

:::

````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yz.Mybatis_demo1.mapper.UserMapper">

    <!--int insertUser();-->
    <insert id="insertUser">
        insert into t_user values (null,'æ¨æ´²','123','ç”·','2569901191@qq.com')
    </insert>
</mapper>
````

### 7ã€é€šè¿‡juintæµ‹è¯•åŠŸèƒ½

````java
package com.yz.Mybatis.test;

import com.yz.Mybatis_demo1.mapper.UserMapper;
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;
import org.junit.Test;

import java.io.IOException;
import java.io.InputStream;

/**
 * @Author æ¨æ´²
 * @Date 2022/7/27 20:53
 */
public class MyBatisTest {

    @Test
    public void testMyBatis() throws IOException {
        //åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶
        InputStream is = Resources.getResourceAsStream("mybatis-config.xml");
        //è·å–SqlSessionFactoryBuilder
        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();
        //è·å–sqlSessionFactory
        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(is);
        //è·å–SqlSession
        SqlSession sqlSession = sqlSessionFactory.openSession();
        //è·å–mapperæ¥å£å¯¹è±¡
        UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
        //æµ‹è¯•åŠŸèƒ½
        int result = userMapper.insertUser();
        //æäº¤äº‹åŠ¡
        sqlSession.commit();
        System.out.println("ç»“æœ"+result);

    }
}
````

æ‰§è¡Œç»“æœï¼š

**ç»“è¿‡ä¸º1åˆ™æ·»åŠ æˆåŠŸ**

![image-20220727210707539](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220727210707539.png)

**æŸ¥æ¡ˆæ•°æ®åº“**

![image-20220728123220180](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220728123220180.png)

::: note

- SqlSessionï¼šä»£è¡¨Javaç¨‹åºå’Œ**æ•°æ®åº“**ä¹‹é—´çš„**ä¼šè¯**ã€‚ï¼ˆHttpSessionæ˜¯Javaç¨‹åºå’Œæµè§ˆå™¨ä¹‹é—´çš„ä¼šè¯ï¼‰

- SqlSessionFactoryï¼šæ˜¯â€œç”Ÿäº§â€SqlSessionçš„â€œå·¥å‚â€ã€‚

- å·¥å‚æ¨¡å¼ï¼šå¦‚æœåˆ›å»ºæŸä¸€ä¸ªå¯¹è±¡ï¼Œä½¿ç”¨çš„è¿‡ç¨‹åŸºæœ¬å›ºå®šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æŠŠåˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„ç›¸å…³ä»£ç å°è£…åˆ°ä¸€ä¸ªâ€œå·¥å‚ç±»â€ä¸­ï¼Œä»¥åéƒ½ä½¿ç”¨è¿™ä¸ªå·¥å‚ç±»æ¥â€œç”Ÿäº§â€æˆ‘ä»¬éœ€è¦çš„å¯¹è±¡ã€‚

:::

### 8ã€åŠ å…¥4jæ—¥å¿—åŠŸèƒ½

a>åŠ å…¥ä¾èµ–

````xml
<!-- log4jæ—¥å¿— -->
<dependency>
    <groupId>log4j</groupId>
    <artifactId>log4j</artifactId>
    <version>1.2.17</version>
</dependency>
````

b>åŠ å…¥log4jé…ç½®æ–‡ä»¶

````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">

<log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/">

    <appender name="STDOUT" class="org.apache.log4j.ConsoleAppender">
        <param name="Encoding" value="UTF-8" />
        <layout class="org.apache.log4j.PatternLayout">
            <param name="ConversionPattern" value="%-5p %d{MM-dd HH:mm:ss,SSS} %m  (%F:%L) \n" />
        </layout>
    </appender>
    <logger name="java.sql">
        <level value="debug" />
    </logger>
    <logger name="org.apache.ibatis">
        <level value="info" />
    </logger>
    <root>
        <level value="debug" />
        <appender-ref ref="STDOUT" />
    </root>
</log4j:configuration>
````

::: note

**æ—¥å¿—çš„çº§åˆ«**

FATAL(è‡´å‘½)>ERROR(é”™è¯¯)>WARN(è­¦å‘Š)>INFO(ä¿¡æ¯)>DEBUG(è°ƒè¯•)

ä»å·¦åˆ°å³æ‰“å°çš„å†…å®¹è¶Šæ¥è¶Šè¯¦ç»†

:::

## ä¸‰ã€æ ¸å¿ƒé…ç½®æ–‡ä»¶è¯¦è§£

æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­çš„æ ‡ç­¾å¿…é¡»æŒ‰ç…§å›ºå®šçš„é¡ºåºï¼š

properties?,settings?,typeAliases?,typeHandlers?,objectFactory?,objectWrapperFactory?,reflectorF

actory?,plugins?,environments?,databaseIdProvider?,mappers?

````xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    
    <!--å¼•å…¥propertiesæ–‡ä»¶-->
    <properties resource="jdbc.properties"></properties>
    <!--è®¾ç½®ç±»å‹åˆ«å-->
    <typeAliases>
        <!--
            typeAlias:è®¾ç½®æŸä¸ªç±»å‹çš„åˆ«å
            å±æ€§ï¼š
                typeï¼šè®¾ç½®éœ€è¦è®¾ç½®åˆ«åçš„ç±»å‹
                aliasï¼šè®¾ç½®æŸä¸ªç±»å‹çš„åˆ«åï¼Œè‹¥ä¸è®¾ç½®è¯¥å±æ€§ï¼Œé‚£ä¹ˆè¯¥ç±»å‹æ‹¥æœ‰é»˜è®¤çš„åˆ«åï¼Œå³ç±»åä¸åŒºåˆ†å¤§å°å†™
        -->
        <typeAlias type="com.yz.Mybatis_demo1.entity.User" alias="User"></typeAlias>
        <!--ä»¥åŒ…ä¸ºå•ä½ï¼Œå°†åŒ…ä¸‹æ‰€æœ‰çš„ç±»å‹è®¾ç½®é»˜è®¤çš„ç±»å‹åˆ«åï¼Œå³ç±»åä¸”ä¸åŒºåˆ†å¤§å°å†™-->
        <!--<package name="com.yz.Mybatis_demo1.entity"/>-->
    </typeAliases>
    <!--
        environments:é…ç½®å¤šä¸ªæ•°æ®åº“çš„ç¯å¢ƒ
        ä¸è¿‡è¦è®°ä½ï¼šå°½ç®¡å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒï¼Œä½†æ¯ä¸ª SqlSessionFactory å®ä¾‹åªèƒ½é€‰æ‹©ä¸€ç§ç¯å¢ƒã€‚
        å±æ€§ï¼š
            defaultï¼šè®¾ç½®é»˜è®¤æ˜¯ç”¨çš„ç¯å¢ƒçš„id
    -->
    <!--è®¾ç½®è¿æ¥æ•°æ®åº“çš„ç¯å¢ƒ-->
    <environments default="development">
        <!--
            environmentï¼šé…ç½®æŸä¸ªå…·ä½“çš„ç¯å¢ƒ
            å±æ€§ï¼š
                idï¼šè¡¨ç¤ºè¿æ¥æ•°æ®åº“çš„ç¯å¢ƒçš„å”¯ä¸€æ ‡è¯†ï¼Œä¸èƒ½é‡å¤
        -->
        <environment id="development">
            <!--
                transactionManagerï¼šè®¾ç½®äº‹åŠ¡ç®¡ç†æ–¹å¼
                å±æ€§ï¼š
                    typeï¼šâ€œJDBC|MANAGED
                    JDBCï¼šè¡¨ç¤ºå½“å‰ç¯å¢ƒä¸­ï¼Œæ‰§è¡ŒSQLæ—¶ï¼Œä½¿ç”¨çš„æ˜¯JDBCä¸­åŸç”Ÿçš„äº‹åŠ¡ç®¡ç†æ–¹å¼ï¼Œäº‹åŠ¡çš„æäº¤æˆ–å›æ»šéœ€è¦æ‰‹åŠ¨å¤„ç†
                    MANAGED:è¢«ç®¡ç†ï¼Œä¾‹å¦‚Spring
            -->
            <transactionManager type="JDBC"/>
            <!--
                dataSource:é…ç½®æ•°æ®æº
                å±æ€§:
                    typeï¼šè®¾ç½®æ•°æ®æºçš„ç±»å‹
                    type:"POOLED|UNPOOLED|JNDI"
                    POOLEDï¼šè¡¨ç¤ºä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ç¼“å­˜æ•°æ®åº“è¿æ¥
                    UNPOOLEDï¼šè¡¨ç¤ºä¸ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± 
                    JNDIï¼šè¡¨ç¤ºä½¿ç”¨ä¸Šä¸‹æ–‡ä¸­çš„æ•°æ®æº
            -->
            <dataSource type="POOLED">
                <!--
                    driver â€“ è¿™æ˜¯ JDBC é©±åŠ¨çš„ Java ç±»å…¨é™å®šåï¼ˆå¹¶ä¸æ˜¯ JDBC é©±åŠ¨ä¸­å¯èƒ½åŒ…å«çš„æ•°æ®æºç±»ï¼‰ã€‚
                    url â€“ è¿™æ˜¯æ•°æ®åº“çš„ JDBC URL åœ°å€ã€‚
                    username â€“ ç™»å½•æ•°æ®åº“çš„ç”¨æˆ·åã€‚
                    password â€“ ç™»å½•æ•°æ®åº“çš„å¯†ç ã€‚
                -->
                <property name="driver" value="${jdbc.driver}"/>
                <property name="url" value="${jdbc.url}"/>
                <property name="username" value="${jdbc.username}"/>
                <property name="password" value="${jdbc.password}"/>
            </dataSource>
        </environment>
    </environments>
    <!--å¼•å…¥æ˜ å°„æ–‡ä»¶-->
    <mappers>
        <mapper resource="mappers/UserMapper.xml"></mapper>
        <!-- å°†åŒ…å†…çš„æ˜ å°„å™¨æ¥å£å®ç°å…¨éƒ¨æ³¨å†Œä¸ºæ˜ å°„å™¨ -->
<!--        <package name="com.yz.Mybatis_demo1.mapper"/>-->
    </mappers>
</configuration>
````

jdbc.properties

````properties
jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/mybatis
jdbc.username=root
jdbc.password=123456
````

æ›´å¤šè¯¦è§£æŸ¥çœ‹MyBatiså®˜ç½‘[https://mybatis.net.cn/configuration.html](https://mybatis.net.cn/configuration.html)

![image-20220728143803615](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220728143803615.png)

## å››ã€MyBatisçš„å¢åˆ æ”¹æŸ¥

### 1ã€æ·»åŠ 

````````xml
	<!--int insertUser();-->
    <insert id="insertUser">
        insert into t_user (id, username, password, age, sex, email) values  (null,'æ¨æ´²','123',21,'ç”·','2569901191@qq.com')
    </insert>
````````

### 2ã€åˆ é™¤

````xml
    <delete id="deleteUser">
        delete from t_user where id = 28
    </delete>
````

### 3ã€ä¿®æ”¹

````xml
    <!--int updateUser();-->
    <update id="updateUser">
        update t_user set username = 'æå››' where id = 7
    </update>
````

::: details Insert, Update, Delete å…ƒç´ çš„å±æ€§

![image-20220728131518580](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220728131518580.png)

:::

### 4ã€æŸ¥è¯¢ä¸€ä¸ªå®ä½“ç±»å¯¹è±¡

````xml
    <select id="getUserById" resultType="com.yz.Mybatis_demo1.entity.User">
        select * from t_user where id = 11
    </select>
````

![image-20220728130437142](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220728130437142.png)

### 5ã€æŸ¥è¯¢é›†åˆ

````xml
    <select id="getAllUser" resultType="com.yz.Mybatis_demo1.entity.User">
        select * from t_user
    </select>
````

![image-20220728130549218](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220728130549218.png)

::: details Select å…ƒç´ çš„å±æ€§

![image-20220728131407536](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220728131407536.png)

:::

::: note

1ã€æŸ¥è¯¢çš„æ ‡ç­¾selectå¿…é¡»è®¾ç½®å±æ€§resultTypeæˆ–resultMapï¼Œç”¨äºè®¾ç½®å®ä½“ç±»å’Œæ•°æ®åº“è¡¨çš„æ˜ å°„å…³ç³»

**resultTypeï¼šè‡ªåŠ¨æ˜ å°„ï¼Œç”¨äºå±æ€§åå’Œè¡¨ä¸­å­—æ®µåä¸€è‡´çš„æƒ…å†µ**

**resultMapï¼šè‡ªå®šä¹‰æ˜ å°„ï¼Œç”¨äºä¸€å¯¹å¤šæˆ–å¤šå¯¹ä¸€æˆ–å­—æ®µåå’Œå±æ€§åä¸ä¸€è‡´çš„æƒ…å†µ**

2ã€å½“æŸ¥è¯¢çš„æ•°æ®ä¸ºå¤šæ¡æ—¶ï¼Œä¸èƒ½ä½¿ç”¨å®ä½“ç±»ä½œä¸ºè¿”å›å€¼ï¼Œåªèƒ½ä½¿ç”¨é›†åˆï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸

TooManyResultsExceptionï¼›ä½†æ˜¯è‹¥æŸ¥è¯¢çš„æ•°æ®åªæœ‰ä¸€æ¡ï¼Œå¯ä»¥ä½¿ç”¨å®ä½“ç±»æˆ–é›†åˆä½œä¸ºè¿”å›å€¼

:::

## äº”ã€MyBatisè·å–å‚æ•°å€¼çš„ä¸¤ç§æ–¹å¼ï¼ˆé‡ç‚¹ğŸ””ï¸ï¼‰

> MyBatisè·å–å‚æ•°å€¼çš„ä¸¤ç§æ–¹å¼ï¼š**${}**å’Œ**#{}**

${}çš„æœ¬è´¨å°±æ˜¯**å­—ç¬¦ä¸²æ‹¼æ¥**ï¼Œ#{}çš„æœ¬è´¨å°±æ˜¯**å ä½ç¬¦èµ‹å€¼**

${}ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼æ‹¼æ¥sqlï¼Œè‹¥ä¸ºå­—ç¬¦ä¸²ç±»å‹æˆ–æ—¥æœŸç±»å‹çš„å­—æ®µè¿›è¡Œèµ‹å€¼æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨åŠ å•å¼•å·ï¼›

#{}ä½¿ç”¨å ä½ç¬¦èµ‹å€¼çš„æ–¹å¼æ‹¼æ¥sqlï¼Œæ­¤æ—¶ä¸ºå­—ç¬¦ä¸²ç±»å‹æˆ–æ—¥æœŸç±»å‹çš„å­—æ®µè¿›è¡Œèµ‹å€¼æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨æ·»åŠ å•å¼•å·ã€‚

````java
    /**
     *  æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
     *
     * @param id id
     * @return {@link User}
     */
    User getUserById(@Param("id")int id);
````

````xml
    <select id="getUserById" resultType="com.yz.mybatis.entity.User">
        select * from t_user where id = #{id}
    </select>
````

### 1ã€å•ä¸ªå­—é¢é‡ç±»å‹çš„å‚æ•°

è‹¥mapperæ¥å£ä¸­çš„æ–¹æ³•å‚æ•°ä¸ºå•ä¸ªçš„å­—é¢é‡ç±»å‹

æ­¤æ—¶å¯ä»¥ä½¿ç”¨${}å’Œ#{}ä»¥ä»»æ„çš„åç§°è·å–å‚æ•°çš„å€¼ï¼Œ<span style="color:red">**æ³¨æ„${}éœ€è¦æ‰‹åŠ¨åŠ å•å¼•å·**</span>

### 2ã€å¤šä¸ªå­—é¢é‡ç±»å‹çš„å‚æ•°

è‹¥mapperæ¥å£ä¸­çš„æ–¹æ³•å‚æ•°ä¸ºå¤šä¸ªæ—¶

æ­¤æ—¶MyBatisä¼šè‡ªåŠ¨å°†è¿™äº›å‚æ•°æ”¾åœ¨ä¸€ä¸ªmapé›†åˆä¸­ï¼Œä»¥arg0,arg1...ä¸ºé”®ï¼Œä»¥å‚æ•°ä¸ºå€¼ï¼›ä»¥param1,param2...ä¸ºé”®ï¼Œä»¥å‚æ•°ä¸ºå€¼ï¼›å› æ­¤åªéœ€è¦é€šè¿‡${}å’Œ#{}è®¿é—®mapé›†åˆçš„é”®å°±å¯ä»¥è·å–ç›¸å¯¹åº”çš„å€¼ï¼Œæ³¨æ„${}éœ€è¦æ‰‹åŠ¨åŠ å•å¼•å·

### 3ã€mapé›†åˆç±»å‹çš„å‚æ•°

è‹¥mapperæ¥å£ä¸­çš„æ–¹æ³•éœ€è¦çš„å‚æ•°ä¸ºå¤šä¸ªæ—¶ï¼Œæ­¤æ—¶å¯ä»¥æ‰‹åŠ¨åˆ›å»ºmapé›†åˆï¼Œè®²è¿™äº›æ•°æ®æ”¾åœ¨mapé›†åˆå½“ä¸­ï¼Œåªéœ€è¦é€šè¿‡

### 4ã€å®ä½“ç±»ç±»å‹çš„å‚æ•°

è‹¥mapperæ¥å£ä¸­çš„æ–¹æ³•å‚æ•°ä¸ºå®ä½“ç±»å¯¹è±¡æ—¶

æ­¤æ—¶å¯ä»¥ä½¿ç”¨${}å’Œ#{}ï¼Œé€šè¿‡è®¿é—®å®ä½“ç±»å¯¹è±¡ä¸­çš„å±æ€§åè·å–å±æ€§å€¼ï¼Œæ³¨æ„${}éœ€è¦æ‰‹åŠ¨åŠ å•å¼•å·

````java
    /**
     * æ–°å¢ç”¨æˆ·
     *
     * @param user ç”¨æˆ·
     * @return int
     */
    int insertUser(User user);
````

````xml
    <insert id="insertUser">
        insert into t_user values (null,#{username},#{password},#{age},#{sex},#{email})
    </insert>
````

æµ‹è¯•

````java
    @Test
    public void insertUser(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class);
        User user = new User();
        user.setUsername("æ¨æ´²7-30");
        user.setPassword("123");
        user.setAge(21);
        user.setSex("ç”·");
        user.setEmail("256@qq.com");
        int result = mapper.insertUser(user);
        System.out.println(result);
    }
````

![image-20220730102420585](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730102420585.png)

### 5ã€ä½¿ç”¨@Paramæ ‡è¯†å‚æ•°

<span style="color:red">**å¯ä»¥é€šè¿‡@Paramæ³¨è§£æ ‡è¯†mapperæ¥å£ä¸­çš„æ–¹æ³•å‚æ•°**</span>

æ­¤æ—¶ï¼Œä¼šå°†è¿™äº›å‚æ•°æ”¾åœ¨mapé›†åˆä¸­ï¼Œä»¥@Paramæ³¨è§£çš„valueå±æ€§å€¼ä¸ºé”®ï¼Œä»¥å‚æ•°ä¸ºå€¼ï¼›ä»¥param1,param2...ä¸ºé”®ï¼Œä»¥å‚æ•°ä¸ºå€¼ï¼›åªéœ€è¦é€šè¿‡${}å’Œ#{}è®¿é—®mapé›†åˆçš„é”®å°±å¯ä»¥è·å–ç›¸å¯¹åº”çš„å€¼ï¼Œæ³¨æ„${}éœ€è¦æ‰‹åŠ¨åŠ å•å¼•å·

ä¸åŠ @Paramä¹‹å‰ï¼šæŠ¥é”™

![image-20220730101011927](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730101011927.png)

åŠ @Paramä¹‹å

````java
    /**
     * æ£€æŸ¥ç™»å½•ç”¨æˆ·
     *
     * @param username ç”¨æˆ·å
     * @param password å¯†ç 
     * @return {@link User}
     */
    User checkLoginUser(@Param("username")String username,@Param("password")String password);
````

````xml
    <select id="checkLoginUser" resultType="com.yz.mybatis.entity.User">
        select * from t_user where username = #{username} and password = #{password}
    </select>
````

![image-20220730101040804](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730101040804.png)

## å…­ã€MyBatisçš„å„ç§æŸ¥è¯¢åŠŸèƒ½

é‡æ–°å»ºä¸€ä¸ªæ¨¡å—

![image-20220729161245241](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220729161245241.png)

### 1ã€æŸ¥è¯¢ä¸€ä¸ªå®ä½“ç±»å¯¹è±¡

````java
    /**
     *  æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
     *
     * @param id id
     * @return {@link User}
     */
    User getUserById(@Param("id")int id);
````

````xml
    <select id="getUserById" resultType="User">
        select * from t_user where id = #{id}
    </select>
````

````java
    @Test
    public void getUserById(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class);
        User user = mapper.getUserById(11);
        System.out.println(user);
    }
````

![image-20220730131139923](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730131139923.png)

### 2ã€æŸ¥è¯¢ä¸€ä¸ªListé›†åˆ

````java
    /**
     * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
     *
     * @return {@link List}<{@link User}>
     */
    List<User> getAllUser();
````

````xml
	<select id="getAllUser" resultType="User">
        select * from t_user
    </select>
````

````java
    @Test
    public void testgetAllUser(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class);
        List<User> allUser = mapper.getAllUser();
        allUser.forEach(user -> System.out.println(user));
    }
````

![image-20220730130126075](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730130126075.png)

### 3ã€æŸ¥è¯¢å•ä¸ªæ•°æ®

````java
    /**
     * æŸ¥è¯¢ç”¨æˆ·çš„æ€»è®°å½•æ•°
     * åœ¨MyBatisä¸­ï¼Œå¯¹äºJavaä¸­å¸¸ç”¨çš„ç±»å‹éƒ½è®¾ç½®äº†ç±»å‹åˆ«å
     * ä¾‹å¦‚ï¼šjava.lang.Integer-->int|integer
     * ä¾‹å¦‚ï¼šint-->_int|_integer
     * ä¾‹å¦‚ï¼šMap-->map,List-->list
     * @return int
     */
    int getCount();
````

````xml
    <select id="getCount" resultType="java.lang.Integer">
        select count(id) from t_user
    </select>
````

````java
    @Test
    public void countUser(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class);
        int count = mapper.getCount();
        System.out.println(count);
    }
````

![image-20220730124301673](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730124301673.png)

### 4ã€æŸ¥è¯¢ä¸€ä¸ªæ•°æ®ä¸ºmapçš„é›†åˆ

````java
    /**
     * æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ä¸ºmapé›†åˆ
     *
     * @param id id
     * @return {@link Map}<{@link String}, {@link Object}>
     */
    Map<String, Object> getUserMap(@Param("id")int id);
````

````xml
    <select id="getUserMap" resultType="java.util.Map">
        select * from t_user where id = #{id}
    </select>
````

````java
    @Test
    public void getUserMap(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class);
        Map<String, Object> userMap = mapper.getUserMap(11);
        System.out.println(userMap);
    }
````

![image-20220730131708283](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730131708283.png)

### 5ã€æŸ¥è¯¢å¤šæ¡æ•°æ®ä¸ºmapé›†åˆ

````java
    /**
     * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ä¸ºmapé›†åˆ 
     * @return
     * å°†è¡¨ä¸­çš„æ•°æ®ä»¥mapé›†åˆçš„æ–¹å¼æŸ¥è¯¢ï¼Œä¸€æ¡æ•°æ®å¯¹åº”ä¸€ä¸ªmapï¼›è‹¥æœ‰å¤šæ¡æ•°æ®ï¼Œå°±ä¼šäº§ç”Ÿå¤šä¸ªmapé›†åˆï¼Œæ­¤ æ—¶å¯ä»¥å°†è¿™äº›mapæ”¾åœ¨ä¸€ä¸ªlisté›†åˆä¸­è·å–
     */
    List<Map<String, Object>> getAllUserToMap();
````

````xml
    <select id="getAllUserToMap" resultType="java.util.Map">
        select * from t_user
    </select>
````

````java
    @Test
    public void getAllUserToMap(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class);
        List<Map<String, Object>> userToMap = mapper.getAllUserToMap();
        for (Object users: userToMap) {
            System.out.println(users);
        }
    }
````

![image-20220730132314914](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730132314914.png)

## ä¸ƒã€ç‰¹æ®ŠSQLçš„æ‰§è¡Œ

### 1ã€æ¨¡ç³ŠæŸ¥è¯¢

````java
    /**
     * æµ‹è¯•æ¨¡ç³ŠæŸ¥è¯¢
     *
     * @param username ç”¨æˆ·å
     * @return {@link List}<{@link User}>
     */
    List<User> testMohu(@Param("username")String username);
````

````xml
    <select id="testMohu" resultType="com.yz.mybatis.entity.User">
        select * from t_user where username like "%"#{username}"%"
    </select>
````

````java
    @Test
    public void testMohu(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class);
        List<User> users = mapper.testMohu("æ¨");
        users.forEach(user -> System.out.println(user));
    }
````

![image-20220730132916212](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730132916212.png)

### 2ã€æ‰¹é‡åˆ é™¤

````java
    /**
     * æ‰¹é‡åˆ é™¤
     *
     * @param ids id
     * @return int
     */
    int deleteMore(@Param("ids")String ids);
````

````xml
    <delete id="deleteMore">
        delete from t_user where id in (${ids})
    </delete>
````

````java
    @Test
    public void deleteMore(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class);
        int result = mapper.deleteMore("11,12,13");
        System.out.println("ç»“æœï¼š"+result);
    }
````

![image-20220730133709966](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730133709966.png)

::: note æ³¨æ„

æ‰¹é‡åˆ é™¤çš„SQLè¯­å¥ä¸ºdelete from t_user where id in (1,2,3);

å¦‚æœç”¨#{ids},åˆ™SQLè¯­å¥å˜ä¸ºï¼šdelete from t_user where id in ('1,2,3');<span style="color:red">**ä¼šæŠ¥é”™**</span>

æ‰€ä»¥æ‰¹é‡åˆ é™¤ä½¿ç”¨${ids}

:::

### 3ã€åŠ¨æ€è®¾ç½®è¡¨å

````java
    /**
     * åŠ¨æ€è®¾ç½®è¡¨åï¼ŒæŸ¥è¯¢æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯
     *
     * @param tableName è¡¨å
     * @return {@link List}<{@link User}>
     */
    List<User> getAllUser(@Param("tableName") String tableName);
````

````xml
    <select id="getAllUserByTableName" resultType="com.yz.mybatis.entity.User">
        select * from ${tableName}
    </select>
````

````java
    @Test
    public void getAllUserByTableName(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class);
        List<User> tUser = mapper.getAllUserByTableName("t_user");
        tUser.forEach(user -> System.out.println(user));
    }
````

![image-20220730134222913](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730134222913.png)

### 4ã€æ·»åŠ åŠŸèƒ½è·å–è‡ªå¢çš„ä¸»é”®

t_clazz(clazz_id,clazz_name)

t_student(student_id,student_name,clazz_id)

1ã€æ·»åŠ ç­çº§ä¿¡æ¯

2ã€è·å–æ–°æ·»åŠ çš„ç­çº§çš„id

3ã€ä¸ºç­çº§åˆ†é…å­¦ç”Ÿï¼Œå³å°†æŸå­¦çš„ç­çº§idä¿®æ”¹ä¸ºæ–°æ·»åŠ çš„ç­çº§çš„id

 ````java
     /**
      * æ–°å¢ç”¨æˆ·
      *
      */
     int insertUser(User user);
 ````

````xml
    <!--
         useGeneratedKeysï¼šè®¾ç½®ä½¿ç”¨è‡ªå¢çš„ä¸»é”®
         keyPropertyï¼šå› ä¸ºå¢åˆ æ”¹æœ‰ç»Ÿä¸€çš„è¿”å›å€¼æ˜¯å—å½±å“çš„è¡Œæ•°ï¼Œå› æ­¤åªèƒ½å°†è·å–çš„è‡ªå¢çš„ä¸»é”®æ”¾åœ¨ä¼ è¾“çš„å‚ æ•°userå¯¹è±¡çš„æŸä¸ªå±æ€§ä¸­
    -->
    <insert id="insertUser" useGeneratedKeys="true" keyProperty="id">
        insert into t_user values (null,#{username},#{password},#{age},#{sex},#{email})
    </insert>
````

````java
    @Test
    public void insertUser(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        ParameterMapper mapper = sqlSession.getMapper(ParameterMapper.class);
        User user = new User();
        user.setUsername("æ¨æ´²7-30-2");
        user.setPassword("123");
        user.setAge(21);
        user.setSex("ç”·");
        user.setEmail("256@qq.com");
        int result = mapper.insertUser(user);
        System.out.println(result);
    }
````

![image-20220730135522251](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220730135522251.png)

## å…«ã€è‡ªå®šä¹‰æ˜ å°„resultMap

### 1ã€resultMapå¤„ç†å­—æ®µå’Œå±æ€§çš„æ˜ å°„å…³ç³»

<span style="color:red">**è‹¥å­—æ®µåå’Œå®ä½“ç±»ä¸­çš„å±æ€§åä¸ä¸€è‡´ï¼Œåˆ™å¯ä»¥é€šè¿‡resultMapè®¾ç½®è‡ªå®šä¹‰æ˜ å°„**</span>

æ›´å¤šè¯¦è§£æŸ¥çœ‹å®˜ç½‘ï¼š[https://mybatis.org/mybatis-3/zh/sqlmap-xml.html](https://mybatis.org/mybatis-3/zh/sqlmap-xml.html)

resultMapä¸­associationçš„å„ä¸ªå±æ€§çš„å«ä¹‰ï¼š

![image-20220731101626341](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220731101626341.png)

````xml
    <!--
        resultMapï¼šè®¾ç½®è‡ªå®šä¹‰æ˜ å°„å…³ç³»
        å±æ€§ï¼š
        idï¼šè¡¨ç¤ºè‡ªå®šä¹‰æ˜ å°„çš„å”¯ä¸€æ ‡è¯†
        typeï¼šæŸ¥è¯¢çš„æ•°æ®è¦æ˜ å°„çš„å®ä½“ç±»çš„ç±»å‹
        å­æ ‡ç­¾ï¼š
            idï¼šè®¾ç½®ä¸»é”®çš„æ˜ å°„å…³ç³»
            resultï¼šè®¾ç½®æ™®é€šå­—æ®µçš„æ˜ å°„å…³ç³»
        associationï¼šè®¾ç½®å¤šå¯¹ä¸€çš„æ˜ å°„å…³ç³»
        collectionï¼šè®¾ç½®ä¸€å¯¹å¤šçš„æ˜ å°„å…³ç³»
            å±æ€§ï¼š
            propertyï¼šè®¾ç½®æ˜ å°„å…³ç³»ä¸­å®ä½“ç±»ä¸­çš„å±æ€§å
            columnï¼šè®¾ç½®æ˜ å°„å…³ç³»ä¸­è¡¨ä¸­çš„å­—æ®µå
    -->
    <resultMap id="empResultMap" type="Emp">
        <id property="eid" column="eid"></id>
        <result property="empName" column="emp_name"></result>
        <result property="age" column="age"></result>
        <result property="sex" column="sex"></result>
        <result property="email" column="email"></result>
    </resultMap>
````

> è‹¥å­—æ®µåå’Œå®ä½“ç±»ä¸­çš„å±æ€§åä¸ä¸€è‡´ï¼Œä½†æ˜¯å­—æ®µåç¬¦åˆæ•°æ®åº“çš„è§„åˆ™ï¼ˆä½¿ç”¨_ï¼‰ï¼Œå®ä½“ç±»ä¸­çš„å±æ€§åç¬¦åˆJavaçš„è§„åˆ™ï¼ˆä½¿ç”¨é©¼å³°ï¼‰
>
> æ­¤æ—¶ä¹Ÿå¯é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å¤„ç†å­—æ®µåå’Œå®ä½“ç±»ä¸­çš„å±æ€§çš„æ˜ å°„å…³ç³»
>
> a>å¯ä»¥é€šè¿‡ä¸ºå­—æ®µèµ·åˆ«åçš„æ–¹å¼ï¼Œä¿è¯å’Œå®ä½“ç±»ä¸­çš„å±æ€§åä¿æŒä¸€è‡´
>
> b>å¯ä»¥åœ¨MyBatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­è®¾ç½®ä¸€ä¸ªå…¨å±€é…ç½®ä¿¡æ¯mapUnderscoreToCamelCaseï¼Œå¯
>
> ä»¥åœ¨æŸ¥è¯¢è¡¨ä¸­æ•°æ®æ—¶ï¼Œè‡ªåŠ¨å°†_ç±»å‹çš„å­—æ®µåè½¬æ¢ä¸ºé©¼å³°
>
> ä¾‹å¦‚ï¼šå­—æ®µåuser_nameï¼Œè®¾ç½®äº†mapUnderscoreToCamelCaseï¼Œæ­¤æ—¶å­—æ®µåå°±ä¼šè½¬æ¢ä¸ºuserName

### 2ã€å¤šå¯¹ä¸€æ˜ å°„å¤„ç†

#### a>çº§è”æ–¹å¼å¤„ç†æ˜ å°„å…³ç³»

````java
Emp getEmpAndDept(Integer eid);
````

````xml
    <resultMap id="empResultMap" type="Emp">
        <id property="eid" column="eid"></id>
        <result property="empName" column="emp_name"></result>
        <result property="age" column="age"></result>
        <result property="sex" column="sex"></result>
        <result property="email" column="email"></result>
        <result property="dept.did" column="did"></result>
        <result property="dept.deptName" column="dept_name"></result>
    </resultMap>
    <select id="getEmpAndDept" resultMap="empResultMap">
        select * from t_emp
            left outer join t_dept td on td.did = t_emp.did
        where eid = #{eid}
    </select>
````

````java
    @Test
    public void getEmpAndDept(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        EmpMapper mapper = sqlSession.getMapper(EmpMapper.class);
        Emp empAndDept = mapper.getEmpAndDept(1);
        System.out.println(empAndDept);
    }
````

ç»“æœï¼š

![image-20220731103418011](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220731103418011.png)

#### b>ä½¿ç”¨associationå¤„ç†æ˜ å°„å…³ç³»

````java
Emp getEmpAndDept(Integer eid);
````

````xml
    <resultMap id="empResultMap" type="Emp">
        <id property="eid" column="eid"/>
        <result property="empName" column="emp_name"/>
        <result property="age" column="age"/>
        <result property="sex" column="sex"/>
        <result property="email" column="email"/>
        <!--
            association:å¤„ç†å¤šå¯¹ä¸€çš„æ˜ å°„å…³ç³»
                property:éœ€è¦å¤„ç†å¤šå¯¹ä¸€çš„æ˜ å°„å…³ç³»çš„å±æ€§å
                javaType:è¯¥å±æ€§çš„ç±»å‹
        -->
        <association property="dept" javaType="dept">
            <id property="did" column="did" />
            <result property="deptName" column="dept_name"/>
        </association>
    </resultMap>
    <select id="getEmpAndDept" resultMap="empResultMap">
        select * from t_emp
            left outer join t_dept td on td.did = t_emp.did
        where eid = #{eid}
    </select>
````

````java
    @Test
    public void getEmpAndDept(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        EmpMapper mapper = sqlSession.getMapper(EmpMapper.class);
        Emp empAndDept = mapper.getEmpAndDept(1);
        System.out.println(empAndDept);
    }
````

ç»“æœ:

![image-20220731103418011](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220731103418011.png)

#### c>åˆ†æ­¥æŸ¥è¯¢âœï¸

1ï¼‰æŸ¥è¯¢å‘˜å·¥

````java
    /**
     *  é€šè¿‡åˆ†å¸ƒæŸ¥è¯¢æŸ¥è¯¢å‘˜å·¥ä»¥åŠå‘˜å·¥æ‰€å¯¹åº”çš„éƒ¨é—¨ä¿¡æ¯
     *     åˆ†æ­¥æŸ¥è¯¢ç¬¬ä¸€æ­¥ï¼šæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯
     *
     *
     * @return {@link Emp}
     */
    Emp getEmpAndDeptByStepOne(@Param("eid")Integer eid);
````

````xml
    <resultMap id="emp" type="emp">
        <id property="eid" column="eid"/>
        <result property="empName" column="emp_name"/>
        <result property="age" column="age"/>
        <result property="sex" column="sex"/>
        <result property="email" column="email"/>
        <!--
            select:è®¾ç½®åˆ†æ­¥æŸ¥è¯¢çš„sqlçš„å”¯ä¸€æ ‡è¯†ï¼Œï¼ˆnamespace.SQLIdæˆ–è€…mapperçš„å…¨ç±»å.æ–¹æ³•åï¼‰
            columnï¼šè®¾ç½®åˆ†æ­¥æŸ¥è¯¢çš„æ¡ä»¶
        -->
        <association
                property="dept"
                select="com.yz.mybatis.mapper.DeptMapper.getDept"
                column="did">
        </association>
    </resultMap>
    <select id="getEmpAndDeptByStepOne" resultMap="emp">
        select * from t_emp where eid = #{eid}
    </select>
````

2ï¼‰æŸ¥è¯¢éƒ¨é—¨ä¿¡æ¯

````java
    Dept getDept(@Param("did") Integer did);
````

````xml
    <resultMap id="dept" type="dept">
        <id property="did" column="did" />
        <result property="deptName" column="dept_name" />
    </resultMap>

    <select id="getDept" resultType="com.yz.mybatis.entity.Dept">
        select * from t_dept where did = #{did}
    </select>
````

æœ€ç»ˆå®ç°

````java
    @Test
    public void getEmpAndDeptTwo(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        EmpMapper mapper = sqlSession.getMapper(EmpMapper.class);
        Emp empAndDeptByStepOne = mapper.getEmpAndDeptByStepOne(1);
        System.out.println(empAndDeptByStepOne);
    }
````

ç»“æœï¼š

![image-20220731103418011](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220731103418011.png)

### 3ã€ä¸€å¯¹å¤šæ˜ å°„å¤„ç†

#### a>collection

````java
    /**
     * æ ¹æ®éƒ¨é—¨idæŸ¥æ–°éƒ¨é—¨ä»¥åŠéƒ¨é—¨ä¸­çš„å‘˜å·¥ä¿¡æ¯
     */
    Dept getDeptEmpByDid(@Param("did") int did);
````

````xml
    <resultMap id="deptEmpMap" type="dept">
        <id property="did" column="did"></id>
        <result property="deptName" column="dept_name"></result>
        <!--
            collectionï¼šå¤„ç†ä¸€å¯¹å¤šæ˜ å°„å…³ç³»
            ofTypeï¼šè®¾ç½®collectionæ ‡ç­¾æ‰€å¤„ç†çš„é›†åˆå±æ€§ä¸­å­˜å‚¨æ•°æ®çš„ç±»å‹
        -->
        <collection property="emps" ofType="emp">
            <id property="eid" column="eid"/>
            <result property="empName" column="emp_name"/>
            <result property="age" column="age"/>
            <result property="sex" column="sex"/>
            <result property="email" column="email"/>
        </collection>
    </resultMap>
    <select id="getDeptEmpByDid" resultMap="deptEmpMap">
        select  dept.*,emp.* from t_dept dept left join t_emp emp on dept.did = emp.did
        where dept.did = #{did}
    </select>
````

````java
    @Test
    public void getDeptEmpByDid(){
        SqlSession sqlSession = SqlSessionUtils.getSqlSession();
        DeptMapper mapper = sqlSession.getMapper(DeptMapper.class);
        Dept deptEmpByDid = mapper.getDeptEmpByDid(2);
        System.out.println(deptEmpByDid);
    }
````

å®ç°ç»“æœ:

![image-20220731113118848](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220731113118848.png)

#### b>åˆ†å¸ƒæŸ¥è¯¢

1ï¼‰æŸ¥è¯¢éƒ¨é—¨ä¿¡æ¯

````java
    /**
     * é€šè¿‡åˆ†æ­¥æŸ¥è¯¢æŸ¥è¯¢éƒ¨é—¨ä»¥åŠéƒ¨é—¨ä¸­æ‰€æœ‰çš„å‘˜å·¥ä¿¡æ¯
     * åˆ†æ­¥æŸ¥è¯¢ç¬¬ä¸€æ­¥ï¼šæŸ¥è¯¢éƒ¨é—¨ä¿¡æ¯
     */
    Dept getDeptAndEmpByStepOne(@Param("did") Integer did);
````

````xml
    <resultMap id="deptAndEmpByStepResultMap" type="Dept">
        <id property="did" column="did"></id>
        <result property="deptName" column="dept_name"></result>
        <collection
                property="emps"
                select="com.yz.mybatis.mapper.EmpMapper.getDeptAndEmpByStepTwo"
                column="did"></collection>
    </resultMap>
    <select id="getDeptAndEmpByStepOne" resultMap="deptAndEmpByStepResultMap">
        select * from t_dept where did = #{did}
    </select>
````

2ï¼‰æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯

````java
    List<Emp> getDeptAndEmpByStepTwo(@Param("did")Integer did);
````

````xml
    <select id="getDeptAndEmpByStepTwo" resultType="com.yz.mybatis.entity.Emp">
        select * from t_emp where did = #{did}
    </select>
````

å®ç°ç»“æœ:

![image-20220731113118848](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220731113118848.png)

> åˆ†æ­¥æŸ¥è¯¢çš„ä¼˜ç‚¹ï¼šå¯ä»¥å®ç°å»¶è¿ŸåŠ è½½ï¼Œä½†æ˜¯å¿…é¡»åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­è®¾ç½®å…¨å±€é…ç½®ä¿¡æ¯ï¼š
>
> lazyLoadingEnabledï¼šå»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³ã€‚å½“å¼€å¯æ—¶ï¼Œæ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå»¶è¿ŸåŠ è½½
>
> aggressiveLazyLoadingï¼šå½“å¼€å¯æ—¶ï¼Œä»»ä½•æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šåŠ è½½è¯¥å¯¹è±¡çš„æ‰€æœ‰å±æ€§ã€‚ å¦åˆ™ï¼Œæ¯ä¸ªå±æ€§ä¼šæŒ‰éœ€åŠ è½½
>
> æ­¤æ—¶å°±å¯ä»¥å®ç°æŒ‰éœ€åŠ è½½ï¼Œè·å–çš„æ•°æ®æ˜¯ä»€ä¹ˆï¼Œå°±åªä¼šæ‰§è¡Œç›¸åº”çš„sqlã€‚æ­¤æ—¶å¯é€šè¿‡associationå’Œcollectionä¸­çš„fetchTypeå±æ€§è®¾ç½®å½“å‰çš„åˆ†æ­¥æŸ¥è¯¢æ˜¯å¦ä½¿ç”¨å»¶è¿ŸåŠ è½½ï¼ŒfetchType="lazy(å»¶è¿ŸåŠ è½½)|eager(ç«‹å³åŠ è½½)"

## ä¹ã€åŠ¨æ€SQL

Mybatisæ¡†æ¶çš„åŠ¨æ€SQLæŠ€æœ¯æ˜¯ä¸€ç§æ ¹æ®ç‰¹å®šæ¡ä»¶åŠ¨æ€æ‹¼è£…SQLè¯­å¥çš„åŠŸèƒ½ï¼Œå®ƒå­˜åœ¨çš„æ„ä¹‰æ˜¯ä¸ºäº†**è§£å†³æ‹¼æ¥SQLè¯­å¥å­—ç¬¦ä¸²æ—¶çš„ç—›ç‚¹é—®é¢˜**ã€‚

[MyBatisåŠ¨æ€SQLæ–‡æ¡£](https://mybatis.net.cn/dynamic-sql.html)

![image-20220801215522377](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220801215522377.png)

### 1ã€if

### 2ã€where

### 3ã€trim

### 4ã€chooseã€whenã€otherwise

### 5ã€foreach

### 6ã€SQLç‰‡æ®µ
