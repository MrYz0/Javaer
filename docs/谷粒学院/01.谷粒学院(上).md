---
title: 谷粒学院(上)
date: 2022-07-20 22:36:11
permalink: /pages/e74a97/
titleTag: 项目学习
sticky: 1
categories:
  - 项目
  - 谷粒学院
tags:
  - 谷粒学院
author: 
  name: 杨洲
  link: https://github.com/xugaoyi
---

# 谷粒学院（上）

## 一、功能简介

谷粒学院，是一个B2C模式的职业技能在线教育系统，分为前台用户系统和后台运营平台。

## 二、系统模块



![img](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-1.png)
<!-- more -->

## 三、系统架构

**架构设计需要考虑的几个方面：**

- **性能：**主要考虑访问频率，每个用户每天的访问次数。项目初始阶段用户的访问量并不大，如果考虑做运营推广，可能会迎来服务器访问量骤增，因此要考虑**分布式部署，引入缓存**
- **可扩展性**：系统功能会随着用户量的增加以及多变的互联网用户需求不断地扩展，因此考虑到系统的可扩展性的要求需要**使用微服务架构，引入消息中间件**
- **高可用**：系统一旦宕机，将会带来不可挽回的损失，因此必须做负载均衡，甚至是异地多活这类复杂的方案。如果数据丢失，修复将会非常麻烦，只能靠人工逐条修复，这个很难接受，因此需要考虑存储高可靠。我们需要考虑多种异常情况：机器故障、机房故障，针对机器故障，我们需要设计 MySQL 同机房主备方案；针对机房故障，我们需要设计 MySQL 跨机房同步方案。
- **安全性**：系统的信息有一定的隐私性，例如用户的个人身份信息，不包含强隐私（例如玉照、情感）的信息，因此使用账号密码管理、数据库访问权限控制即可。
- **成本**：视频类网站的主要成本在于服务器成本、流量成本、存储成本、流媒体研发成本，中小型公司可以考虑使用云服务器和云服务。

![img](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-2.png)

## 四、数据库设计

### 4.1、数据库

guli_edu

### 4.2、数据表

```mysql
guli_edu.sql
```

::: details sql语句

````mysql
/*
 Navicat Premium Data Transfer

 Source Server         : localhost
 Source Server Type    : MySQL
 Source Server Version : 80022
 Source Host           : localhost:3306
 Source Schema         : guli_edu

 Target Server Type    : MySQL
 Target Server Version : 80022
 File Encoding         : 65001

 Date: 10/07/2022 13:37:02
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for edu_chapter
-- ----------------------------
DROP TABLE IF EXISTS `edu_chapter`;
CREATE TABLE `edu_chapter`  (
  `id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '章节ID',
  `course_id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '课程ID',
  `title` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '章节名称',
  `sort` int(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '显示排序',
  `gmt_create` datetime(0) NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime(0) NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_course_id`(`course_id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '课程' ROW_FORMAT = Compact;

-- ----------------------------
-- Records of edu_chapter
-- ----------------------------
INSERT INTO `edu_chapter` VALUES ('1', '14', '第一章：HTML', 0, '2019-01-01 12:27:40', '2019-01-01 12:55:30');
INSERT INTO `edu_chapter` VALUES ('1181729226915577857', '18', '第七章：I/O流', 70, '2019-10-09 08:32:58', '2019-10-09 08:33:20');
INSERT INTO `edu_chapter` VALUES ('1192252428399751169', '1192252213659774977', '第一章节', 0, '2019-11-07 09:28:25', '2019-11-07 09:28:25');
INSERT INTO `edu_chapter` VALUES ('15', '18', '第一章：Java入门', 0, '2019-01-01 12:27:40', '2019-10-09 09:13:19');
INSERT INTO `edu_chapter` VALUES ('3', '14', '第二章：CSS', 0, '2019-01-01 12:55:35', '2019-01-01 12:27:40');
INSERT INTO `edu_chapter` VALUES ('32', '18', '第二章：控制台输入和输出', 0, '2019-01-01 12:27:40', '2019-01-01 12:27:40');
INSERT INTO `edu_chapter` VALUES ('44', '18', '第三章：控制流', 0, '2019-01-01 12:27:40', '2019-01-01 12:27:40');
INSERT INTO `edu_chapter` VALUES ('48', '18', '第四章：类的定义', 0, '2019-01-01 12:27:40', '2019-01-01 12:27:40');
INSERT INTO `edu_chapter` VALUES ('63', '18', '第五章：数组', 0, '2019-01-01 12:27:40', '2019-01-01 12:27:40');
INSERT INTO `edu_chapter` VALUES ('64', '18', '第六章：继承', 61, '2019-01-01 12:27:40', '2019-10-09 08:32:47');

-- ----------------------------
-- Table structure for edu_comment
-- ----------------------------
DROP TABLE IF EXISTS `edu_comment`;
CREATE TABLE `edu_comment`  (
  `id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '讲师ID',
  `course_id` varchar(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT '' COMMENT '课程id',
  `teacher_id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT '' COMMENT '讲师id',
  `member_id` varchar(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT '' COMMENT '会员id',
  `nickname` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '会员昵称',
  `avatar` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '会员头像',
  `content` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '评论内容',
  `is_deleted` tinyint(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '逻辑删除 1（true）已删除， 0（false）未删除',
  `gmt_create` datetime(0) NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime(0) NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_course_id`(`course_id`) USING BTREE,
  INDEX `idx_teacher_id`(`teacher_id`) USING BTREE,
  INDEX `idx_member_id`(`member_id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '评论' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of edu_comment
-- ----------------------------
INSERT INTO `edu_comment` VALUES ('1194499162790211585', '1192252213659774977', '1189389726308478977', '1', '小三123', 'http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132', '课程很好', 0, '2019-11-13 14:16:08', '2019-11-13 14:16:08');
INSERT INTO `edu_comment` VALUES ('1194898406466420738', '1192252213659774977', '1189389726308478977', '1', '小三123', 'http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132', '11', 0, '2019-11-14 16:42:35', '2019-11-14 16:42:35');
INSERT INTO `edu_comment` VALUES ('1194898484388200450', '1192252213659774977', '1189389726308478977', '1', '小三123', 'http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132', '111', 0, '2019-11-14 16:42:53', '2019-11-14 16:42:53');
INSERT INTO `edu_comment` VALUES ('1195251020861317122', '1192252213659774977', '1189389726308478977', '1', NULL, NULL, '2233', 0, '2019-11-15 16:03:45', '2019-11-15 16:03:45');
INSERT INTO `edu_comment` VALUES ('1195251382720700418', '1192252213659774977', '1189389726308478977', '1', NULL, NULL, '4455', 0, '2019-11-15 16:05:11', '2019-11-15 16:05:11');
INSERT INTO `edu_comment` VALUES ('1195252819177570306', '1192252213659774977', '1189389726308478977', '1', '小三1231', 'http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132', '55', 0, '2019-11-15 16:10:53', '2019-11-15 16:10:53');
INSERT INTO `edu_comment` VALUES ('1195252899448160258', '1192252213659774977', '1189389726308478977', '1', '小三1231', 'http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132', '55', 0, '2019-11-15 16:11:13', '2019-11-15 16:11:13');
INSERT INTO `edu_comment` VALUES ('1195252920587452417', '1192252213659774977', '1189389726308478977', '1', '小三1231', 'http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132', '223344', 0, '2019-11-15 16:11:18', '2019-11-15 16:11:18');
INSERT INTO `edu_comment` VALUES ('1195262128095559681', '14', '1189389726308478977', '1', '小三1231', 'http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132', '11', 0, '2019-11-15 16:47:53', '2019-11-15 16:47:53');
INSERT INTO `edu_comment` VALUES ('1196264505170767874', '1192252213659774977', '1189389726308478977', '1', '小三1231', 'http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132', '666666', 0, '2019-11-18 11:10:58', '2019-11-18 11:10:58');

-- ----------------------------
-- Table structure for edu_course
-- ----------------------------
DROP TABLE IF EXISTS `edu_course`;
CREATE TABLE `edu_course`  (
  `id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '课程ID',
  `teacher_id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '课程讲师ID',
  `subject_id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '课程专业ID',
  `subject_parent_id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '课程专业父级ID',
  `title` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '课程标题',
  `price` decimal(10, 2) UNSIGNED NOT NULL DEFAULT 0.00 COMMENT '课程销售价格，设置为0则可免费观看',
  `lesson_num` int(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '总课时',
  `cover` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '课程封面图片路径',
  `buy_count` bigint(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '销售数量',
  `view_count` bigint(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '浏览数量',
  `version` bigint(0) UNSIGNED NOT NULL DEFAULT 1 COMMENT '乐观锁',
  `status` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT 'Draft' COMMENT '课程状态 Draft未发布  Normal已发布',
  `is_deleted` tinyint(0) NULL DEFAULT NULL COMMENT '逻辑删除 1（true）已删除， 0（false）未删除',
  `gmt_create` datetime(0) NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime(0) NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_title`(`title`) USING BTREE,
  INDEX `idx_subject_id`(`subject_id`) USING BTREE,
  INDEX `idx_teacher_id`(`teacher_id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '课程' ROW_FORMAT = Compact;

-- ----------------------------
-- Records of edu_course
-- ----------------------------
INSERT INTO `edu_course` VALUES ('1192252213659774977', '1189389726308478977', '1178214681139539969', '1178214681118568449', 'java基础课程：test', 0.01, 2, 'https://guli-file-190513.oss-cn-beijing.aliyuncs.com/cover/default.gif', 4, 387, 1, 'Normal', 0, '2019-11-07 09:27:33', '2019-11-18 13:35:03');
INSERT INTO `edu_course` VALUES ('14', '1189389726308478977', '1101348944971091969', '1101348944920760321', 'XHTML CSS2 JS整站制作教程课程学习', 0.00, 3, 'http://guli-file.oss-cn-beijing.aliyuncs.com/cover/2019/03/13/d0086eb0-f2dc-45f7-bba1-744d95e5be0f.jpg', 3, 44, 15, 'Normal', 0, '2018-04-02 18:33:34', '2019-11-16 21:21:45');
INSERT INTO `edu_course` VALUES ('15', '1189389726308478977', '1101348944971091969', '1101348944920760321', 'HTML5入门课程学习', 0.00, 23, 'http://guli-file.oss-cn-beijing.aliyuncs.com/cover/2019/03/13/22997b8e-3606-4d2e-9b4f-09f48418b6e4.jpg', 0, 51, 17, 'Normal', 0, '2018-04-02 18:34:32', '2019-11-12 10:19:20');
INSERT INTO `edu_course` VALUES ('18', '1189389726308478977', '1178214681139539969', '1178214681118568449', 'Java精品课程', 0.01, 20, 'http://guli-file.oss-cn-beijing.aliyuncs.com/cover/2019/03/06/866e9aca-b530-4f71-a690-72d4a4bfd1e7.jpg', 151, 737, 6, 'Normal', 0, '2018-04-02 21:28:46', '2019-11-18 11:14:52');

-- ----------------------------
-- Table structure for edu_course_collect
-- ----------------------------
DROP TABLE IF EXISTS `edu_course_collect`;
CREATE TABLE `edu_course_collect`  (
  `id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '收藏ID',
  `course_id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '课程讲师ID',
  `member_id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT '' COMMENT '课程专业ID',
  `is_deleted` tinyint(0) NOT NULL DEFAULT 0 COMMENT '逻辑删除 1（true）已删除， 0（false）未删除',
  `gmt_create` datetime(0) NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime(0) NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '课程收藏' ROW_FORMAT = Compact;

-- ----------------------------
-- Records of edu_course_collect
-- ----------------------------
INSERT INTO `edu_course_collect` VALUES ('1196269345666019330', '1192252213659774977', '1', 1, '2019-11-18 11:30:12', '2019-11-18 11:30:12');

-- ----------------------------
-- Table structure for edu_course_description
-- ----------------------------
DROP TABLE IF EXISTS `edu_course_description`;
CREATE TABLE `edu_course_description`  (
  `id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '课程ID',
  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL COMMENT '课程简介',
  `gmt_create` datetime(0) NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime(0) NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '课程简介' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of edu_course_description
-- ----------------------------
INSERT INTO `edu_course_description` VALUES ('1104870479077879809', '<p>11</p>', '2019-03-11 06:23:44', '2019-03-11 06:23:44');
INSERT INTO `edu_course_description` VALUES ('1192252213659774977', '<p>测试</p>', '2019-11-07 09:27:33', '2019-11-13 16:21:28');
INSERT INTO `edu_course_description` VALUES ('14', '', '2019-03-13 06:04:43', '2019-03-13 06:05:33');
INSERT INTO `edu_course_description` VALUES ('15', '', '2019-03-13 06:03:33', '2019-03-13 06:04:22');
INSERT INTO `edu_course_description` VALUES ('18', '<p>本套Java视频完全针对零基础学员，课堂实录，自发布以来，好评如潮！Java视频中注重与学生互动，讲授幽默诙谐、细致入微，覆盖Java基础所有核心知识点，同类Java视频中也是代码量大、案例多、实战性强的。同时，本Java视频教程注重技术原理剖析，深入JDK源码，辅以代码实战贯穿始终，用实践驱动理论，并辅以必要的代码练习。</p>\n<p>------------------------------------</p>\n<p>视频特点：</p>\n<p>通过学习本Java视频教程，大家能够真正将Java基础知识学以致用、活学活用，构架Java编程思想，牢牢掌握\"源码级\"的Javase核心技术，并为后续JavaWeb等技术的学习奠定扎实基础。<br /><br />1.通俗易懂，细致入微：每个知识点高屋建瓴，深入浅出，简洁明了的说明问题<br />2.具实战性：全程真正代码实战，涵盖上百个企业应用案例及练习<br />3.深入：源码分析，更有 Java 反射、动态代理的实际应用等<br />4.登录尚硅谷官网，技术讲师免费在线答疑</p>', '2019-03-06 18:06:36', '2019-10-30 19:58:36');

-- ----------------------------
-- Table structure for edu_subject
-- ----------------------------
DROP TABLE IF EXISTS `edu_subject`;
CREATE TABLE `edu_subject`  (
  `id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '课程类别ID',
  `title` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '类别名称',
  `parent_id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT '0' COMMENT '父ID',
  `sort` int(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '排序字段',
  `gmt_create` datetime(0) NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime(0) NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_parent_id`(`parent_id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '课程科目' ROW_FORMAT = Compact;

-- ----------------------------
-- Records of edu_subject
-- ----------------------------
INSERT INTO `edu_subject` VALUES ('1178214681118568449', '后端开发', '0', 1, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681139539969', 'Java', '1178214681118568449', 1, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681181483010', '前端开发', '0', 3, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681210843137', 'JavaScript', '1178214681181483010', 4, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681231814658', '云计算', '0', 5, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681252786178', 'Docker', '1178214681231814658', 5, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681294729217', 'Linux', '1178214681231814658', 6, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681324089345', '系统/运维', '0', 7, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681353449473', 'Linux', '1178214681324089345', 7, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681382809602', 'Windows', '1178214681324089345', 8, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681399586817', '数据库', '0', 9, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681428946945', 'MySQL', '1178214681399586817', 9, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681454112770', 'MongoDB', '1178214681399586817', 10, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681483472898', '大数据', '0', 11, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681504444418', 'Hadoop', '1178214681483472898', 11, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681529610242', 'Spark', '1178214681483472898', 12, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681554776066', '人工智能', '0', 13, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681584136193', 'Python', '1178214681554776066', 13, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681613496321', '编程语言', '0', 14, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178214681626079234', 'Java', '1178214681613496321', 14, '2019-09-29 15:47:25', '2019-09-29 15:47:25');
INSERT INTO `edu_subject` VALUES ('1178585108407984130', 'Python', '1178214681118568449', 2, '2019-09-30 16:19:22', '2019-09-30 16:19:22');
INSERT INTO `edu_subject` VALUES ('1178585108454121473', 'HTML/CSS', '1178214681181483010', 3, '2019-09-30 16:19:22', '2019-09-30 16:19:22');

-- ----------------------------
-- Table structure for edu_teacher
-- ----------------------------
DROP TABLE IF EXISTS `edu_teacher`;
CREATE TABLE `edu_teacher`  (
  `id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '讲师ID',
  `name` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '讲师姓名',
  `intro` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT '' COMMENT '讲师简介',
  `career` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '讲师资历,一句话说明讲师',
  `level` int(0) UNSIGNED NOT NULL COMMENT '头衔 1高级讲师 2首席讲师',
  `avatar` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '讲师头像',
  `sort` int(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '排序',
  `is_deleted` tinyint(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '逻辑删除 1（true）已删除， 0（false）未删除',
  `gmt_create` datetime(0) NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime(0) NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `uk_name`(`name`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '讲师' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of edu_teacher
-- ----------------------------
INSERT INTO `edu_teacher` VALUES ('1', '张三', '近年主持国家自然科学基金（6项）、江苏省重大科技成果转化项目（5项）、江苏省产学研前瞻性联合研究项目（3项）、省工业科技支撑、省高技术、省自然科学基金等省部级及其企业的主要科研项目40多个，多个项目在企业成功转化，产生了较好的经济、社会和环境效益。积极开展产学研科技合作，并与省内16家企业建立了江苏省研究生工作站，其中6家为江苏省优秀研究生工作站', '高级', 1, 'https://guli-file-190513.oss-cn-beijing.aliyuncs.com/avatar/default.jpg', 0, 0, '2019-10-30 14:18:46', '2022-07-10 12:01:25');
INSERT INTO `edu_teacher` VALUES ('1189389726308478977', '晴天', '高级讲师简介', '高级讲师资历', 2, 'https://online-teach-file.oss-cn-beijing.aliyuncs.com/teacher/2019/10/30/de47ee9b-7fec-43c5-8173-13c5f7f689b2.png', 1, 0, '2019-10-30 11:53:03', '2022-07-10 12:01:46');
INSERT INTO `edu_teacher` VALUES ('1189390295668469762', '李刚', '高级讲师简介', '高级讲师', 2, 'https://online-teach-file.oss-cn-beijing.aliyuncs.com/teacher/2019/10/30/b8aa36a2-db50-4eca-a6e3-cc6e608355e0.png', 2, 0, '2019-10-30 11:55:19', '2019-11-12 13:37:52');
INSERT INTO `edu_teacher` VALUES ('1189426437876985857', '王二', '高级讲师简介', '高级讲师', 2, 'https://online-teach-file.oss-cn-beijing.aliyuncs.com/teacher/2019/11/08/e44a2e92-2421-4ea3-bb49-46f2ec96ef88.png', 0, 0, '2019-10-30 14:18:56', '2019-11-12 13:37:35');
INSERT INTO `edu_teacher` VALUES ('1189426464967995393', '王五', '高级讲师简介', '高级讲师', 2, 'https://online-teach-file.oss-cn-beijing.aliyuncs.com/teacher/2019/10/30/65423f14-49a9-4092-baf5-6d0ef9686a85.png', 0, 0, '2019-10-30 14:19:02', '2022-07-10 11:54:14');
INSERT INTO `edu_teacher` VALUES ('1192249914833055746', '李四', '高级讲师简介', '高级讲师', 2, 'https://online-teach-file.oss-cn-beijing.aliyuncs.com/teacher/2019/11/07/91871e25-fd83-4af6-845f-ea8d471d825d.png', 0, 0, '2019-11-07 09:18:25', '2019-11-12 13:37:01');
INSERT INTO `edu_teacher` VALUES ('1192327476087115778', '1222-12-12', '1111', '11', 1, 'https://online-teach-file.oss-cn-beijing.aliyuncs.com/teacher/2019/11/08/5805c6cd-c8ad-4a77-aafd-d2e083bfd8a4.png', 0, 0, '2019-11-07 14:26:37', '2022-07-10 11:54:54');
INSERT INTO `edu_teacher` VALUES ('1195337453429129218', 'test', 'sdfsdf', 'sdfdf', 1, 'https://guli-file-190513.oss-cn-beijing.aliyuncs.com/avatar/default.jpg', 0, 0, '2019-11-15 21:47:12', '2019-11-15 21:47:27');
INSERT INTO `edu_teacher` VALUES ('1545710819088556034', '杨总', '', '', 1, NULL, 0, 0, '2022-07-09 18:05:52', '2022-07-09 18:05:52');
INSERT INTO `edu_teacher` VALUES ('1545998585600946178', '测试', '测试', '测试', 1, '', 1, 0, '2022-07-10 13:09:21', '2022-07-10 13:09:21');
INSERT INTO `edu_teacher` VALUES ('2', '1', '11', '11', 1, NULL, 0, 0, '2022-07-10 11:02:06', '2022-07-10 11:02:09');
INSERT INTO `edu_teacher` VALUES ('3', '2', '2', '22', 2, NULL, 0, 0, '2022-07-10 11:02:26', '2022-07-10 11:02:28');

-- ----------------------------
-- Table structure for edu_video
-- ----------------------------
DROP TABLE IF EXISTS `edu_video`;
CREATE TABLE `edu_video`  (
  `id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '视频ID',
  `course_id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '课程ID',
  `chapter_id` char(19) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '章节ID',
  `title` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '节点名称',
  `video_source_id` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '云端视频资源',
  `video_original_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL COMMENT '原始文件名称',
  `sort` int(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '排序字段',
  `play_count` bigint(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '播放次数',
  `is_free` tinyint(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '是否可以试听：0收费 1免费',
  `duration` float NOT NULL DEFAULT 0 COMMENT '视频时长（秒）',
  `status` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT 'Empty' COMMENT 'Empty未上传 Transcoding转码中  Normal正常',
  `size` bigint(0) UNSIGNED NOT NULL DEFAULT 0 COMMENT '视频源文件大小（字节）',
  `version` bigint(0) UNSIGNED NOT NULL DEFAULT 1 COMMENT '乐观锁',
  `gmt_create` datetime(0) NOT NULL COMMENT '创建时间',
  `gmt_modified` datetime(0) NOT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_course_id`(`course_id`) USING BTREE,
  INDEX `idx_chapter_id`(`chapter_id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = '课程视频' ROW_FORMAT = Compact;

-- ----------------------------
-- Records of edu_video
-- ----------------------------
INSERT INTO `edu_video` VALUES ('1182499307429339137', '18', '32', '第一节', '', '', 0, 0, 0, 0, '', 0, 1, '2019-10-11 11:32:59', '2019-10-11 11:57:38');
INSERT INTO `edu_video` VALUES ('1185312444399071234', '14', '1', '12', '', '', 0, 0, 0, 0, 'Empty', 0, 1, '2019-10-19 05:51:23', '2019-10-19 05:51:33');
INSERT INTO `edu_video` VALUES ('1189434737808990210', '18', '44', '测试', '', '', 1, 0, 0, 0, 'Empty', 0, 1, '2019-10-30 14:51:55', '2019-10-30 14:51:55');
INSERT INTO `edu_video` VALUES ('1189471423678939138', '18', '1181729226915577857', 'test', '2b887dc9584d4dc68908780ec57cd3b9', '视频', 1, 0, 0, 0, 'Empty', 0, 1, '2019-10-30 17:17:41', '2019-10-30 17:17:41');
INSERT INTO `edu_video` VALUES ('1189476403626409986', '18', '1181729226915577857', '22', '5155c73dc112475cbbddccf4723f7cef', '视频.mp4', 0, 0, 0, 0, 'Empty', 0, 1, '2019-10-30 17:37:29', '2019-10-30 17:37:29');
INSERT INTO `edu_video` VALUES ('1192252824606289921', '1192252213659774977', '1192252428399751169', '第一课时', '756cf06db9cb4f30be85a9758b19c645', 'eae2b847ef8503b81f5d5593d769dde2.mp4', 0, 0, 0, 0, 'Empty', 0, 1, '2019-11-07 09:29:59', '2019-11-07 09:29:59');
INSERT INTO `edu_video` VALUES ('1192628092797730818', '1192252213659774977', '1192252428399751169', '第二课时', '2a02d726622f4c7089d44cb993c531e1', 'eae2b847ef8503b81f5d5593d769dde2.mp4', 0, 0, 1, 0, 'Empty', 0, 1, '2019-11-08 10:21:10', '2019-11-08 10:21:22');
INSERT INTO `edu_video` VALUES ('1192632495013380097', '1192252213659774977', '1192252428399751169', '第三课时', '4e560c892fdf4fa2b42e0671aa42fa9d', 'eae2b847ef8503b81f5d5593d769dde2.mp4', 0, 0, 1, 0, 'Empty', 0, 1, '2019-11-08 10:38:40', '2019-11-08 10:38:40');
INSERT INTO `edu_video` VALUES ('1194117638832111617', '1192252213659774977', '1192252428399751169', '第四课时', '4e560c892fdf4fa2b42e0671aa42fa9d', 'eae2b847ef8503b81f5d5593d769dde2.mp4', 0, 0, 0, 0, 'Empty', 0, 1, '2019-11-12 13:00:05', '2019-11-12 13:00:05');
INSERT INTO `edu_video` VALUES ('1196263770832023554', '1192252213659774977', '1192252428399751169', '第五课时', '27d21158b0834cb5a8d50710937de330', 'eae2b847ef8503b81f5d5593d769dde2.mp4', 5, 0, 0, 0, 'Empty', 0, 1, '2019-11-18 11:08:03', '2019-11-18 11:08:03');
INSERT INTO `edu_video` VALUES ('17', '18', '15', '第一节：Java简介', '196116a6fee742e1ba9f6c18f65bd8c1', '1', 1, 1000, 1, 100, 'Draft', 0, 1, '2019-01-01 13:08:57', '2019-10-11 11:26:39');
INSERT INTO `edu_video` VALUES ('18', '18', '15', '第二节：表达式和赋值语句', '2d99b08ca0214909899910c9ba042d47', '7 - How Do I Find Time for My ', 2, 999, 1, 100, 'Draft', 0, 1, '2019-01-01 13:09:02', '2019-03-08 03:30:27');
INSERT INTO `edu_video` VALUES ('19', '18', '15', '第三节：String类', '51120d59ddfd424cb5ab08b44fc8b23a', 'eae2b847ef8503b81f5d5593d769dde2.mp4', 3, 888, 0, 100, 'Draft', 0, 1, '2019-01-01 13:09:05', '2019-11-12 12:50:45');
INSERT INTO `edu_video` VALUES ('20', '18', '15', '第四节：程序风格', '2a38988892d84df598752226c50f3fa3', '00-day10总结.avi', 4, 666, 0, 100, 'Draft', 0, 1, '2019-01-01 13:09:05', '2019-10-11 09:20:09');

SET FOREIGN_KEY_CHECKS = 1;
````

:::

![image-20220710133458184](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-3.png)

### 4.3、数据库设计规约

<span style="color:red">以下规约只针对本模块，更全面的文档参考《阿里巴巴Java开发手册》：五、MySQL数据库</span>

1、库名与应用名称尽量一致

2、表名、字段名必须使用小写字母或数字，禁止出现数字开头，

3、表名不使用复数名词

4、表的命名最好是加上“业务名称_表的作用”。如，edu_teacher

5、表必备三字段：id, gmt_create, gmt_modified

说明：

其中 id 必为主键，类型为 bigint unsigned、单表时自增、步长为 1。

（如果使用分库分表集群部署，则id类型为verchar，非自增，业务中使用分布式id生成器）

gmt_create, gmt_modified 的类型均为 datetime 类型，前者现在时表示主动创建，后者过去分词表示被 动更新。

6、单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。 说明：如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表。

7、表达是与否概念的字段，必须使用 is_xxx 的方式命名，数据类型是 unsigned tinyint （1 表示是，0 表示否）。

说明：任何字段如果为非负数，必须是 unsigned。

注意：POJO 类中的任何布尔类型的变量，都不要加 is 前缀。数据库表示是与否的值，使用 tinyint 类型，坚持 is_xxx 的 命名方式是为了明确其取值含义与取值范围。

正例：表达逻辑删除的字段名 is_deleted，1 表示删除，0 表示未删除。

8、小数类型为 decimal，禁止使用 float 和 double。 说明：float 和 double 在存储的时候，存在精度损失的问题，很可能在值的比较时，得到不 正确的结果。如果存储的数据范围超过 decimal 的范围，建议将数据拆成整数和小数分开存储。

9、如果存储的字符串长度几乎相等，使用 char 定长字符串类型。

10、varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索 引效率。

11、一索引名为 uk_字段名；普通索引名则为 idx_字段名。

说明：uk_ 即 unique key；idx_ 即 index 的简称

12、不得使用外键与级联，一切外键概念必须在应用层解决。外键与级联更新适用于单机低并发，不适合分布式、高并发集群；级联更新是强阻塞，存在数据库更新风暴的风险；外键影响数据库的插入速度。

## 五、搭建项目工程（父工程）

### 5.1	工程结构介绍

#### 1、工程结构

![img](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-4.png)

#### 2、模块说明

![image-20220709130817029](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-5.png)

### 5.2	创建父工程

**1、创建sprigboot工程guli-parent**

在idea开发工具中，使用 Spring Initializr 快速初始化一个 Spring Boot 模块，版本使用：2.2.1.RELEASE

![img](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-6.png)

**配置：**

<span style="color:red">groupId：com.yz</span>

<span style="color:red">artifactId：guli-parent</span>

一直下一步到完成

**2、删除 src 目录**

![img](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-7.png)

**3、配置 pom.xml**

修改版本为 ：<span style="color:red">2.2.1.RELEASE</span>

![img](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-8.png)

`<artifactId> `节点后面添加  pom类型

````xml
<artifactId>guli-parent</artifactId>
<packaging>pom</packaging>
````

**4、在pom.xml中添加依赖的版本**

**删除pom.xml中的**`<dependencies>内容`

````xml
<!-- 以下内容删除 -->
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
````

**添加 `<properties>`确定依赖的版本**

````xml
	<properties>
		<java.version>1.8</java.version>
		<guli.version>0.0.1-SNAPSHOT</guli.version>
		<mybatis-plus.version>3.5.1</mybatis-plus.version>
		<velocity.version>2.3</velocity.version>
		<swagger.version>3.0.0</swagger.version>
		<Knife4j.version>3.0.3</Knife4j.version>
		<aliyun.oss.version>3.15.0</aliyun.oss.version>
		<jodatime.version>2.10.4</jodatime.version>
		<poi.version>3.17</poi.version>
		<commons-fileupload.version>1.3.1</commons-fileupload.version>
		<commons-io.version>2.6</commons-io.version>
		<httpclient.version>4.5.13</httpclient.version>
		<jwt.version>0.9.1</jwt.version>
		<aliyun-java-sdk-core.version>4.1.0</aliyun-java-sdk-core.version>
		<aliyun-sdk-oss.version>2.5.0</aliyun-sdk-oss.version>
		<aliyun-java-sdk-vod.version>2.16.7</aliyun-java-sdk-vod.version>
		<aliyun-java-vod-upload.version>1.4.14</aliyun-java-vod-upload.version>
		<aliyun-sdk-vod-upload.version>1.4.14</aliyun-sdk-vod-upload.version>
		<fastjson.version>1.2.67</fastjson.version>
		<gson.version>2.8.7</gson.version>
		<json.version>20220320</json.version>
		<commons-dbutils.version>1.7</commons-dbutils.version>
		<canal.client.version>1.1.6</canal.client.version>
		<docker.image.prefix>zx</docker.image.prefix>
		<cloud-alibaba.version>0.2.2.RELEASE</cloud-alibaba.version>
	</properties>
````

**配置 `<dependencyManagement>` 锁定依赖的版本**

````xml
<dependencyManagement>
		<dependencies>
			<!--Spring Cloud-->
			<dependency>
				<groupId>org.springframework.cloud</groupId>
				<artifactId>spring-cloud-dependencies</artifactId>
				<version>Hoxton.RELEASE</version>
				<type>pom</type>
				<scope>import</scope>
			</dependency>
			<dependency>
				<groupId>org.springframework.cloud</groupId>
				<artifactId>spring-cloud-alibaba-dependencies</artifactId>
				<version>${cloud-alibaba.version}</version>
				<type>pom</type>
				<scope>import</scope>
			</dependency>
			<!--mybatis-plus 持久层-->
			<dependency>
				<groupId>com.baomidou</groupId>
				<artifactId>mybatis-plus-boot-starter</artifactId>
				<version>${mybatis-plus.version}</version>
			</dependency>
			<!--mybatis-plus代码生成器-->
			<dependency>
				<groupId>com.baomidou</groupId>
				<artifactId>mybatis-plus-generator</artifactId>
				<version>3.5.1</version>
			</dependency>
			<!--velocity模板-->
			<dependency>
				<groupId>org.apache.velocity</groupId>
				<artifactId>velocity-engine-core</artifactId>
				<version>${velocity.version}</version>
			</dependency>
			<!--freemarker模板-->
			<dependency>
				<groupId>org.freemarker</groupId>
				<artifactId>freemarker</artifactId>
			</dependency>
			<!--swagger-->
			<dependency>
				<groupId>io.springfox</groupId>
				<artifactId>springfox-boot-starter</artifactId>
				<version>${swagger.version}</version>
			</dependency>
			<dependency>
				<groupId>com.github.xiaoymin</groupId>
				<artifactId>knife4j-spring-boot-starter</artifactId>
				<!--在引用时请在maven中央仓库搜索3.X最新版本号-->
				<version>${Knife4j.version}</version>
			</dependency>

			<!--aliyunOSS-->
			<dependency>
				<groupId>com.aliyun.oss</groupId>
				<artifactId>aliyun-sdk-oss</artifactId>
				<version>${aliyun.oss.version}</version>
			</dependency>
			<!--日期时间工具-->
			<dependency>
				<groupId>joda-time</groupId>
				<artifactId>joda-time</artifactId>
				<version>${jodatime.version}</version>
			</dependency>
			<!--xls-->
			<dependency>
				<groupId>org.apache.poi</groupId>
				<artifactId>poi</artifactId>
				<version>${poi.version}</version>
			</dependency>
			<!--xlsx-->
			<dependency>
				<groupId>org.apache.poi</groupId>
				<artifactId>poi-ooxml</artifactId>
				<version>${poi.version}</version>
			</dependency>
			<!--文件上传-->
			<dependency>
				<groupId>commons-fileupload</groupId>
				<artifactId>commons-fileupload</artifactId>
				<version>${commons-fileupload.version}</version>
			</dependency>
			<!--commons-io-->
			<dependency>
				<groupId>commons-io</groupId>
				<artifactId>commons-io</artifactId>
				<version>${commons-io.version}</version>
			</dependency>
			<!--httpclient-->
			<dependency>
				<groupId>org.apache.httpcomponents</groupId>
				<artifactId>httpclient</artifactId>
				<version>${httpclient.version}</version>
			</dependency>
			<dependency>
				<groupId>com.google.code.gson</groupId>
				<artifactId>gson</artifactId>
				<version>${gson.version}</version>
			</dependency>
			<!-- JWT -->
			<dependency>
				<groupId>io.jsonwebtoken</groupId>
				<artifactId>jjwt</artifactId>
				<version>${jwt.version}</version>
			</dependency>
			<!--aliyun-->
			<dependency>
				<groupId>com.aliyun</groupId>
				<artifactId>aliyun-java-sdk-core</artifactId>
				<version>${aliyun-java-sdk-core.version}</version>
			</dependency>
			<dependency>
				<groupId>com.aliyun.oss</groupId>
				<artifactId>aliyun-sdk-oss</artifactId>
				<version>${aliyun-sdk-oss.version}</version>
			</dependency>
			<dependency>
				<groupId>com.aliyun</groupId>
				<artifactId>aliyun-java-sdk-vod</artifactId>
				<version>${aliyun-java-sdk-vod.version}</version>
			</dependency>
			<dependency>
				<groupId>com.aliyun</groupId>
				<artifactId>aliyun-java-vod-upload</artifactId>
				<version>${aliyun-java-vod-upload.version}</version>
			</dependency>
			<dependency>
				<groupId>com.aliyun</groupId>
				<artifactId>aliyun-sdk-vod-upload</artifactId>
				<version>${aliyun-sdk-vod-upload.version}</version>
			</dependency>
			<dependency>
				<groupId>com.alibaba</groupId>
				<artifactId>fastjson</artifactId>
				<version>${fastjson.version}</version>
			</dependency>
			<dependency>
				<groupId>org.json</groupId>
				<artifactId>json</artifactId>
				<version>${json.version}</version>
			</dependency>
			<dependency>
				<groupId>commons-dbutils</groupId>
				<artifactId>commons-dbutils</artifactId>
				<version>${commons-dbutils.version}</version>
			</dependency>
			<dependency>
				<groupId>com.alibaba.otter</groupId>
				<artifactId>canal.client</artifactId>
				<version>${canal.client.version}</version>
			</dependency>
		</dependencies>
	</dependencyManagement>
````

## 六、搭建项目工程（service模块）

### 6.1、搭建service模块

#### 1、在父工程guli-parent下面创建模块service

![image-20220709131352743](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-9.png)

选择maven进行，根据步骤填写信息

![image-20220709131544716](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-10.png)



#### 2、添加模块类型是pom

`<artifactId>` 节点后面添加  pom类型

#### 3、添加项目需要的依赖

````xml
    <dependencies>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>
        </dependency>
        <!--hystrix依赖，主要是用  @HystrixCommand -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
        </dependency>
        <!--服务注册-->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        </dependency>
        <!--服务调用-->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-openfeign</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <!--mybatis-plus-->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
        </dependency>
        <!--mysql-->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>
        <!--velocity模板-->
        <dependency>
            <groupId>org.apache.velocity</groupId>
            <artifactId>velocity-engine-core</artifactId>
        </dependency>
        <!--freemarker模板-->
        <dependency>
            <groupId>org.freemarker</groupId>
            <artifactId>freemarker</artifactId>
        </dependency>
        <!--swagger-->
        <dependency>
            <groupId>io.springfox</groupId>
            <artifactId>springfox-boot-starter</artifactId>
        </dependency>
        <dependency>
            <groupId>com.github.xiaoymin</groupId>
            <artifactId>knife4j-spring-boot-starter</artifactId>
            <!--在引用时请在maven中央仓库搜索3.X最新版本号-->
        </dependency>
        <!--lombok用来简化实体类：需要安装lombok插件-->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>
        <!--xls-->
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi</artifactId>
        </dependency>
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi-ooxml</artifactId>
        </dependency>
        <dependency>
            <groupId>commons-fileupload</groupId>
            <artifactId>commons-fileupload</artifactId>
        </dependency>
        <!--httpclient-->
        <dependency>
            <groupId>org.apache.httpcomponents</groupId>
            <artifactId>httpclient</artifactId>
        </dependency>
        <!--commons-io-->
        <dependency>
            <groupId>commons-io</groupId>
            <artifactId>commons-io</artifactId>
        </dependency>
        <!--gson-->
        <dependency>
            <groupId>com.google.code.gson</groupId>
            <artifactId>gson</artifactId>
        </dependency>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.12</version>
        </dependency>
    </dependencies>
````

::: note

前期将服务注册依赖注释，不然运行会报错

:::

### 6.2、搭建service-edu模块

#### 1、在父工程service模块下面创建子模块service-edu

![image-20220709132551769](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-11.png)

## 七、讲师管理模块配置和生成代码

### 7.1、讲师管理模块配置

**1、在service下面service-edu模块中创建配置文件**

![image-20220709132806227](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-12.png)

**resources目录下创建文件 application.yml**

````yml
spring:
  #数据库
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/guli_edu?useUnicode=true&useSSL=false&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: root
    password: 123456
  # 返回json的全局时间格式
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
# 端口号    
server:
  port: 8888
# ===========================MyBatis-Plus=====================================
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  mapper-locations: classpath:mapper/*.xml
````

### 7.2、创建MP代码生成器

在test/java目录下创建包com.yz.eduservice，创建代码生成器：CodeGenerator.java

````java
package com.yz.eduservice;
import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.baomidou.mybatisplus.generator.FastAutoGenerator;
import com.baomidou.mybatisplus.generator.config.OutputFile;
import com.baomidou.mybatisplus.generator.config.TemplateConfig;
import com.baomidou.mybatisplus.generator.engine.FreemarkerTemplateEngine;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.function.Consumer;
/**
 * @Author 杨洲
 * @Date 2022/7/9 13:31
 */
public class CodeGenerator {
    public static void main(String[] args) {
        List<String> tables = new ArrayList<>();
        tables.add("edu_teacher");


        FastAutoGenerator.create("jdbc:mysql://localhost:3306/guli_edu","root","123456")
                .globalConfig(builder -> {
                    builder.author("杨洲")               //作者
                            .outputDir("E:\\IdeaProjects\\guli-parent\\service\\service_edu"+"\\src\\main\\java")    //输出路径(写到java目录)
                            .enableSwagger()           //开启swagger
                            .commentDate("yyyy-MM-dd")
                            .fileOverride();            //开启覆盖之前生成的文件

                })
                .packageConfig(builder -> {
                    builder.parent("com.yz")
                            .moduleName("eduservice")
                            .entity("entity")           //实体类
                            .service("service")         //业务层接口
                            .serviceImpl("service.impl")//业务层实现类
                            .controller("controller")   //控制层
                            .mapper("mapper")           //数据层
                            .xml("mapper")              //数据层映射文件
                            .pathInfo(Collections.singletonMap(OutputFile.mapperXml,"E:\\IdeaProjects\\guli-parent\\service\\service_edu"+"\\src\\main\\resources\\mapper"));
                })
                .strategyConfig(builder -> {
                    builder.addInclude(tables)
                            .addTablePrefix("edu_", "c_") // 设置过滤表前缀
                            .serviceBuilder()
                            .formatServiceFileName("%sService")
                            .formatServiceImplFileName("%sServiceImpl")
                            .entityBuilder()
                            .enableLombok()
                            .logicDeleteColumnName("deleted")
                            .enableTableFieldAnnotation()
                            .controllerBuilder()
                            // 映射路径使用连字符格式，而不是驼峰
                            .enableHyphenStyle()
                            .formatFileName("%sController")
                            .enableRestStyle()
                            .mapperBuilder()
                            //生成通用的resultMap
                            .enableBaseResultMap()
                            .superClass(BaseMapper.class)
                            .formatMapperFileName("%sMapper")
                            .enableMapperAnnotation()
                            .formatXmlFileName("%sMapper");
                })
                .templateConfig(new Consumer<TemplateConfig.Builder>() {
                    @Override
                    public void accept(TemplateConfig.Builder builder) {
                        // 实体类使用我们自定义模板
                        builder.entity("templates/myentity.java");
                    }
                })
                .templateEngine(new FreemarkerTemplateEngine()) // 使用Freemarker引擎模板，默认的是Velocity引擎模板
                .execute();
    }
}
````

在resource目录下的templates目录下创建名为myentity.java.ftl的文件，内容如下：

````java
package ${package.Entity};

<#list table.importPackages as pkg>
    import ${pkg};
</#list>
<#if swagger>
    import io.swagger.annotations.ApiModel;
    import io.swagger.annotations.ApiModelProperty;
</#if>
<#if entityLombokModel>
    import lombok.Data;
    <#if chainModel>
        import lombok.experimental.Accessors;
    </#if>
</#if>

/**
* <p>
    * ${table.comment!}
    * </p>
*
* @author ${author}
* @since ${date}
*/
<#if entityLombokModel>
@Data
    <#if chainModel>
@Accessors(chain = true)
    </#if>
</#if>
<#if table.convert>
@TableName("${schemaName}${table.name}")
</#if>
<#if swagger>
@ApiModel(value = "${entity}对象", description = "${table.comment!}")
</#if>
<#if superEntityClass??>
public class ${entity} extends ${superEntityClass}<#if activeRecord><${entity}></#if> {
<#elseif activeRecord>
public class ${entity} extends Model<${entity}> {
<#elseif entitySerialVersionUID>
public class ${entity} implements Serializable {
<#else>
public class ${entity} {
</#if>
<#if entitySerialVersionUID>

    private static final long serialVersionUID = 1L;
</#if>
<#-- ----------  BEGIN 字段循环遍历  ---------->
<#list table.fields as field>
    <#if field.keyFlag>
        <#assign keyPropertyName="${field.propertyName}"/>
    </#if>

    <#if field.comment!?length gt 0>
        <#if swagger>
    @ApiModelProperty("${field.comment}")
        <#else>
            /**
            * ${field.comment}
            */
        </#if>
    </#if>
    <#if field.keyFlag>
    <#-- 主键 -->
        <#if field.keyIdentityFlag>
    @TableId(value = "${field.annotationColumnName}", type = IdType.AUTO)
        <#elseif idType??>
    @TableId(value = "${field.annotationColumnName}", type = IdType.${idType})
        <#elseif field.convert>
    @TableId("${field.annotationColumnName}")
        </#if>
    <#-- 普通字段 -->
    <#elseif field.fill??>
    <#-- -----   存在字段填充设置   ----->
        <#if field.convert>
    @TableField(value = "${field.annotationColumnName}", fill = FieldFill.${field.fill})
        <#else>
    @TableField(fill = FieldFill.${field.fill})
        </#if>
    <#elseif field.convert>
    @TableField("${field.annotationColumnName}")
    </#if>
<#-- 乐观锁注解 -->
    <#if field.versionField>
        @Version
    </#if>
<#-- 逻辑删除注解 -->
    <#if field.logicDeleteField>
        @TableLogic
    </#if>
    private ${field.propertyType} ${field.propertyName};
</#list>
<#------------  END 字段循环遍历  ---------->

<#if !entityLombokModel>
    <#list table.fields as field>
        <#if field.propertyType == "boolean">
            <#assign getprefix="is"/>
        <#else>
            <#assign getprefix="get"/>
        </#if>
        public ${field.propertyType} ${getprefix}${field.capitalName}() {
        return ${field.propertyName};
        }

        <#if chainModel>
            public ${entity} set${field.capitalName}(${field.propertyType} ${field.propertyName}) {
        <#else>
            public void set${field.capitalName}(${field.propertyType} ${field.propertyName}) {
        </#if>
        this.${field.propertyName} = ${field.propertyName};
        <#if chainModel>
            return this;
        </#if>
        }
    </#list>
</#if>

<#if entityColumnConstant>
    <#list table.fields as field>
        public static final String ${field.name?upper_case} = "${field.name}";

    </#list>
</#if>
<#if activeRecord>
    @Override
    public Serializable pkVal() {
    <#if keyPropertyName??>
        return this.${keyPropertyName};
    <#else>
        return null;
    </#if>
    }

</#if>
<#if !entityLombokModel>
    @Override
    public String toString() {
    return "${entity}{" +
    <#list table.fields as field>
        <#if field_index==0>
            "${field.propertyName}=" + ${field.propertyName} +
        <#else>
            ", ${field.propertyName}=" + ${field.propertyName} +
        </#if>
    </#list>
    "}";
    }
</#if>
}
````

::: tip 报错解决方式

将mysql驱动版本改成8.0.29

:::

### 7.3、编写后台管理api接口

#### 1、编写controller代码

````java
@RestController
@RequestMapping("/eduservice/teacher")
@Api(tags = "讲师管理接口")
public class TeacherController {

    @Resource
    private TeacherService teacherService;

    @ApiOperation("获取所有讲师")
    @GetMapping("list")
    public List<Teacher> getAll(){
        return teacherService.list(null);
    }

}
````

#### 2、创建SpringBoot配置类

在edu包下创建config包，创建MyBatisPlusConfig.java

````java
package com.yz.eduservice.config;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.transaction.annotation.EnableTransactionManagement;

/**
 * @Author 杨洲
 * @Date 2022/7/9 13:59
 */
@Configuration
@EnableTransactionManagement
@MapperScan("com.yz.eduservice.mapper")
public class MyBatisPlusConfig {
}
````

#### 3、创建SpringBoot启动类

创建启动类 EduApplication.java，注意启动类的创建位置

````java
package com.yz.eduservice;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * @Author 杨洲
 * @Date 2022/7/9 14:00
 */
@SpringBootApplication
public class EduApplication {
    public static void main(String[] args) {
        SpringApplication.run(EduApplication.class,args);
    }
}
````

#### **5、运行启动类**

访问[http://localhost:8888/doc.html](http://localhost:8888/doc.html#/default/讲师管理接口/getAllUsingGET)

因为引入的依赖是knife4j，可以直接使用Swagger访问

![image-20220709141607027](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-13.png)

### 7.4、讲师逻辑删除功能

#### 1、EduTeacherController添加删除方法

````java
    @ApiOperation("逻辑删除讲师")
    @DeleteMapping("{id}")
    public boolean removeById(@PathVariable("id") String id){
        return teacherService.removeById(id);
    }
````

#### 2、修改Teacher类

isDeleted字段上加上@TableLogic注解

````java
    @ApiModelProperty("逻辑删除 1（true）已删除， 0（false）未删除")
    @TableField("is_deleted")
    @TableLogic
    private Integer isDeleted;
````

![image-20220709143532438](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-14.png)

### 7.5、跨域配置

#### 1、什么是跨域

浏览器从一个域名的网页去请求另一个域名的资源时，<span style="color:red">域名、端口、协议任一不同，都是跨域 </span>。前后端分离开发中，需要考虑ajax跨域的问题。

这里我们可以从服务端解决这个问题

#### 2、配置

在启动类上添加注解

````java
@CrossOrigin //跨域
````

## 八、配置Swagger生成API接口文档

### 8.1、Swagger介绍

前后端分离开发模式中，api文档是最好的沟通方式。

Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。

及时性 (接口变更后，能够及时准确地通知相关前后端开发人员)规范性 (并且保证接口的规范性，如接口的地址，请求方式，参数及响应格式和错误信息)一致性 (接口信息一致，不会出现因开发人员拿到的文档版本不一致，而出现分歧)可测性 (直接在接口文档上进行测试，以方便理解业务)

### 8.2、配置Swagger

**1、创建common模块**

**在guli-parent下创建模块common**

配置：

groupId：com.yz

artifactId：common

![image-20220709144232613](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-15.png)

**2、在common中引入相关依赖**

````xml
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
            <scope>provided </scope>
        </dependency>
        <!--mybatis-plus-->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
            <scope>provided </scope>
        </dependency>
        <!--lombok用来简化实体类：需要安装lombok插件-->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <scope>provided </scope>
        </dependency>
        <!--swagger-->
        <dependency>
            <groupId>io.springfox</groupId>
            <artifactId>springfox-boot-starter</artifactId>
        </dependency>
        <dependency>
            <groupId>com.github.xiaoymin</groupId>
            <artifactId>knife4j-spring-boot-starter</artifactId>
        </dependency>
        <!-- redis -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-redis</artifactId>
        </dependency>

        <!-- spring2.X集成redis所需common-pool2 -->
<!--        <dependency>-->
<!--            <groupId>org.apache.commons</groupId>-->
<!--            <artifactId>commons-pool2</artifactId>-->
<!--            <version>2.6.0</version>-->
<!--        </dependency>-->

    </dependencies>
````

### 8.3、在common下面创建子模块service-base

![image-20220709144539487](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-16.png)

### 8.4、在模块service-base中，创建swagger的配置类

创建包com.yz.servicebase.config，创建类SwaggerConfig

````java
package com.yz.servicebase.config;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.service.Contact;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;

/**
 * @Author 杨洲
 * @Date 2022/7/9 14:50
 */
@Configuration
public class SwaggerConfig {
    @Bean
    public Docket docket() {
        return new Docket(DocumentationType.OAS_30).apiInfo(
                new ApiInfoBuilder()
                        .contact(new Contact("杨洲",
                                "https://mryz0.github.io/JavaStudy/",
                                "2569901191@qq.com"))
                        .description("谷粒学院项目文档")
                        .termsOfServiceUrl("https://mryz0.github.io/JavaStudy/")
                        .title("谷粒学院项目")
                        .build()
        );
    }
}
````

### 8.5、在模块service模块中引入service-base

````xml
        <dependency>
            <groupId>com.yz</groupId>
            <artifactId>service_base</artifactId>
            <version>0.0.1-SNAPSHOT</version>
        </dependency>
````

### 8.6、在service-edu启动类上添加注解，进行测试

````java
@CrossOrigin //跨域
@SpringBootApplication
@ComponentScan({"com.yz.servicebase","com.yz.eduservice"})
public class EduApplication {
    public static void main(String[] args) {
        SpringApplication.run(EduApplication.class,args);
    }
} 
````

### 8.7、API模型

可以添加一些自定义设置，例如：

定义样例数据

````java
    @ApiModelProperty(value = "创建时间", example = "2019-01-01 8:00:00")
    @TableField("gmt_create")
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")

    private LocalDateTime gmtCreate;

    @ApiModelProperty(value = "更新时间", example = "2019-01-01 8:00:00")
    @TableField("gmt_modified")
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime gmtModified;
````

### 8.8、定义接口说明和参数说明

定义在类上：@Api

定义在方法上：@ApiOperation

定义在参数上：@ApiParam

````java
@RestController
@RequestMapping("/admin/edu/teacher")
@Api(tags = "讲师管理接口")
public class TeacherController {

    @Resource
    private TeacherService teacherService;

    @ApiOperation("根据ID删除讲师")
    @DeleteMapping("{id}")
    public boolean removeById(
            @ApiParam(name = "id", value = "讲师ID", required = true)
            @PathVariable("id") String id){
        return teacherService.removeById(id);
    }

    @ApiOperation("所有讲师列表")
    @GetMapping("findAll")
    public List<Teacher> findAllTeacher(){
        return teacherService.list(null);
    }

}
````

![image-20220709161743361](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-17.png)

## 九、统一返回结果对象

### 9.1、统一返回数据格式

项目中我们会将响应封装成json返回，一般我们会将所有接口的数据格式统一， 使前端(iOS Android, Web)对数据的操作更一致、轻松。

一般情况下，统一返回数据格式没有固定的格式，只要能描述清楚返回的数据状态以及要返回的具体数据就可以。但是一般会包含状态码、返回消息、数据这几部分内容

例如，我们的系统要求返回的基本数据格式如下：

**列表：**

````json
{
  "success": true,
  "code": 20000,
  "message": "成功",
  "data": {
    "items": [
      {
        "id": "1",
        "name": "刘德华",
        "intro": "毕业于师范大学数学系，热爱教育事业，执教数学思维6年有余"
      }
    ]
  }
}
````

**分页：**

````json
{
  "success": true,
  "code": 20000,
  "message": "成功",
  "data": {
    "total": 17,
    "rows": [
      {
        "id": "1",
        "name": "刘德华",
        "intro": "毕业于师范大学数学系，热爱教育事业，执教数学思维6年有余"
      }
    ]
  }
}
````

**没有返回数据：**

```json
{
  "success": true,
  "code": 20000,
  "message": "成功",
  "data": {}
}
```

**失败：**

````json
{
  "success": false,
  "code": 20001,
  "message": "失败",
  "data": {}
}
````

因此，我们定义统一结果

````json
{
  "success": 布尔, //响应是否成功
  "code": 数字, //响应码
  "message": 字符串, //返回消息
  "data": HashMap //返回数据，放在键值对中
}
````

### 9.2、创建统一结果返回类

**1、在common模块下创建子模块common-utils**

![image-20220709162230244](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-18.png)

**2、创建接口定义返回码**

**创建包com.yz.commonutils，创建枚举ResponseEnum**

````java
package com.yz.commonutils;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.ToString;

/**
 * @Author 杨洲
 * @Date 2022/7/9 16:34
 */
@Getter
@AllArgsConstructor
@ToString
public enum ResponseEnum {

    SUCCESS(20000,"成功"),
    ERROR(20001,"失败");


    // 响应状态吗
    private Integer code;

    // 响应信息
    private String message;
}
````

**3、创建结果类**

**创建类 R.java**

````java
package com.yz.commonutils;

import io.swagger.annotations.ApiModel;
import lombok.Data;

import java.util.HashMap;
import java.util.Map;

/**
 * @Author 杨洲
 * @Date 2022/7/9 16:37
 */
@Data
@ApiModel("统一返回结果类")
public class R {
    private String message;

    private Integer code;

    private Map<String, Object> data = new HashMap<>();

    private R(){}
    /**
     * 返回成功结果
     * @return
     */
    private static R ok(){
        R r = new R();
        r.setCode(ResponseEnum.SUCCESS.getCode());
        r.setMessage(ResponseEnum.SUCCESS.getMessage());
        return r;
    }
    /**
     * 返回失败结果
     * @return
     */
    private static R error(){
        R r = new R();
        r.setCode(ResponseEnum.ERROR.getCode());
        r.setMessage(ResponseEnum.ERROR.getMessage());
        return r;
    }

    public static R setResult(ResponseEnum responseEnum){
        R r = new R();
        r.setCode(responseEnum.getCode());
        r.setMessage(responseEnum.getMessage());
        return r;
    }

    public R data(String key,Object value){
        this.data.put(key,value);
        return this;
    }

    public R data(Map<String, Object> map){
        this.setData(map);
        return this;
    }
    /**
     * 设置特定的响应消息
     * @param message
     * @return
     */
    public R message(String message){
        this.setMessage(message);
        return this;
    }
    /**
     * 设置特定的响应码
     * @param code
     * @return
     */
    public R code(Integer code){
        this.setCode(code);
        return this;
    }
}
````

### 9.3、统一返回结果使用

#### 1、在service模块中添加依赖

````xml
        <dependency>
            <groupId>com.yz</groupId>
            <artifactId>common_utils</artifactId>
            <version>0.0.1-SNAPSHOT</version>
        </dependency>
````

#### 2、修改Controller中的返回结果

列表

````java
	@ApiOperation("所有讲师列表")
    @GetMapping("findAll")
    public R findAllTeacher(){
        List<Teacher> list = teacherService.list(null);
        return R.ok().data("items",list);
    }
````

删除

````java
    @ApiOperation("根据ID删除讲师")
    @DeleteMapping("{id}")
    public R removeById(
            @ApiParam(name = "id", value = "讲师ID", required = true)
            @PathVariable("id") String id){
        boolean result = teacherService.removeById(id);
        if (result){
            return R.ok();
        }{
            return R.error();
        }
    }
````

测试结果如下：

![image-20220709171658356](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-19.png)

### 9.4、分页和条件查询接口开发

#### 9.4.1、条件查询

根据讲师名称name，讲师头衔level、讲师入驻时间gmt_create（时间段）查询

##### 1、创建查询对象

创建com.yz.eduservice.entity.vo包，创建TeacherQuery.java查询对象

````java
package com.yz.eduservice.entity.vo;

import io.swagger.annotations.Api;
import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

import javax.validation.Valid;
import java.io.Serializable;

/**
 * @Author 杨洲
 * @Date 2022/7/9 17:20
 */
@Data
@ApiModel(value = "Teacher查询对象", description = "讲师查询对象封装")
public class TeacherQuery implements Serializable {

    private static final long serialVersionUID = 1L;

    @ApiModelProperty(value = "教师名称，模糊查询")
    private String name;

    @ApiModelProperty(value = "头衔 1高级讲师 2首席讲师")
    private Integer level;

    @ApiModelProperty(value = "查询开始时间", example = "2019-01-01 10:10:10")
    private String begin;//注意，这里使用的是String类型，前端传过来的数据无需进行类型转换

    @ApiModelProperty(value = "查询结束时间", example = "2019-12-01 10:10:10")
    private String end;
}
````

##### 2、编写Controller

````java
    @ApiOperation("分页条件查询")
    @PostMapping("/{current}/{limit}")
    public R page(@ApiParam(name = "current", value = "当前页码", required = true)
                  @PathVariable Long current,
                  @ApiParam(name = "limit", value = "每页记录数", required = true)
                  @PathVariable Long limit,
                  @ApiParam(name = "teacherQuery", value = "查询对象", required = false)
                  @RequestBody TeacherQuery teacherQuery){
        //创建page对象
        Page<Teacher> teacherPage = new Page<>();
        //构架条件构造器
        QueryWrapper<Teacher> wrapper = new QueryWrapper<>();
        String name = teacherQuery.getName();
        Integer level = teacherQuery.getLevel();
        String begin = teacherQuery.getBegin();
        String end = teacherQuery.getEnd();
        //判断条件是否为空，如果不为空，拼接条件
        if (!StringUtils.isEmpty(name)){
            wrapper.like("name",name);
        }
        if (!StringUtils.isEmpty(level)){
            wrapper.eq("level",level);
        }
        if (!StringUtils.isEmpty(begin)){
            wrapper.ge("gmt_create",begin);
        }
        if (!StringUtils.isEmpty(end)){
            wrapper.le("gmt_create",end);
        }
        //调用方法实现分页条件查询
        teacherService.page(teacherPage,wrapper);
        long total = teacherPage.getTotal();
        List<Teacher> records = teacherPage.getRecords();
        return R.ok().data("total",total).data("rows",records);
    }
````

测试结果如下：

![image-20220709174003880](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-20.png)

### 9.5、新增和修改讲师接口开发

#### 9.5.1、自动填充封装

##### 1、在service-base模块中添加

**创建包handler，创建自动填充类 MyMetaObjectHandler**

````java
package com.yz.eduservice.config;

import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;
import org.apache.ibatis.reflection.MetaObject;
import org.springframework.stereotype.Component;

import java.time.LocalDateTime;

/**
 * @Author 杨洲
 * @Date 2022/7/9 18:01
 */
@Component
public class MyMetaObjectHandler implements MetaObjectHandler {

    @Override
    public void insertFill(MetaObject metaObject) {
        this.setFieldValByName("gmtCreate", LocalDateTime.now(),metaObject);
        this.setFieldValByName("gmtModified", LocalDateTime.now(),metaObject);
        this.setFieldValByName("isDeleted", 0,metaObject);
    }

    @Override
    public void updateFill(MetaObject metaObject) {
        this.setFieldValByName("gmtModified", LocalDateTime.now(),metaObject);
    }
}
````

##### 2、在实体类添加自动填充注解

![image-20220709180813693](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-21.png)

#### 9.5.2、controller方法定义

##### 1、新增

````java
    @ApiOperation("新增讲师")
    @PostMapping("save")
    public R save(@RequestBody Teacher teacher){
        teacherService.save(teacher);
        return R.ok();
    }
````

##### 2、根据id查询

````java
    @ApiOperation("根据id查询")
    @GetMapping("get/{id}")
    public R getById(
            @ApiParam(name = "id", value = "讲师ID", required = true)
            @PathVariable String id){
        Teacher teacher = teacherService.getById(id);
        return R.ok().data("item",teacher);
    }
````

##### 3、根据id修改

````java
    @ApiOperation("根据id修改")
    @PutMapping()
    public R update(@RequestBody Teacher teacher){
        teacherService.updateById(teacher);
        return R.ok().message("修改成功");
    }
````

## 十、统一异常处理

![image-20220709205504812](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-22.png)

### 10.1、制造异常

#### 1、制造异常

除以0

````java
    @ApiOperation("分页讲师列表")
    @GetMapping("pageTeacher/{current}/{limit}")
    public R pageList(
            @ApiParam(name = "current", value = "当前页码", required = true)
            @PathVariable Long current,
            @ApiParam(name = "limit", value = "每页记录数", required = true)
            @PathVariable Long limit){

        Page<Teacher> teacherPage = new Page<>(current,limit);
        int i = 10/0;
        teacherService.page(teacherPage, null);
        long total = teacherPage.getTotal();
        List<Teacher> records = teacherPage.getRecords();
        return  R.ok().data("total", total).data("rows", records);

    }
````

执行结果：

![image-20220709194653516](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-23.png)

#### 2、什么是统一异常处理

<span style="color:red">我们想让异常结果也显示为统一的返回结果对象，并且统一处理系统的异常信息，那么需要统一异常处理<</span>

### 10.2、统一异常处理

#### 1、创建统一异常处理器

在service-base中创建统一异常处理类GlobalExceptionHandler.java：

````java
package com.yz.servicebase.exception;

import com.yz.commonutils.R;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;


/**
 * 统一异常处理类
 */
@Slf4j
@Component //Spring容易自动管理
@ControllerAdvice//在controller层添加通知。如果使用@ControllerAdvice，则方法上需要添加@ResponseBody
public class GlobalExceptionHandler {

    @ExceptionHandler(Exception.class)
    @ResponseBody
    public R error(Exception e){
        e.printStackTrace();
        return R.error();
    }
}
````

#### 2、测试

![image-20220709194534262](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-24.png)



### 10.2、处理特定异常

#### 1、添加异常处理方法

GlobalExceptionHandler.java中添加

````java
	@ExceptionHandler(ArithmeticException.class)
    @ResponseBody
    public R error(ArithmeticException e){
        e.printStackTrace();
        log.error("执行了自定义异常");
        return R.error().message("执行了自定义异常");
    }
````

#### 2、测试

![image-20220709194950363](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-25.png)

### 10.3、自定义异常

#### 1、创建自定义异常

````java
package com.yz.servicebase.exception;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * @Author 杨洲
 * @Date 2022/7/9 19:50
 */
@Data
@AllArgsConstructor
@NoArgsConstructor
public class GuliException extends RuntimeException{

    /**
     * 状态码
     */
    private Integer code;

    /**
     * 返回消息
     */
    private String message;
}
````

#### 2、业务中需要的位置抛出GuliException

````java
    @ApiOperation("分页讲师列表")
    @GetMapping("pageTeacher/{current}/{limit}")
    public R pageList(
            @ApiParam(name = "current", value = "当前页码", required = true)
            @PathVariable Long current,
            @ApiParam(name = "limit", value = "每页记录数", required = true)
            @PathVariable Long limit){

        Page<Teacher> teacherPage = new Page<>(current,limit);
        try {
            int i = 10/0;
        } catch (Exception e) {
            throw new GuliException(20001,"出现自定义异常");
        }
        teacherService.page(teacherPage, null);
        long total = teacherPage.getTotal();
        List<Teacher> records = teacherPage.getRecords();
        return  R.ok().data("total", total).data("rows", records);

    }
````

#### 3、添加异常处理方法

GlobalExceptionHandler.java中添加

````java
    @ExceptionHandler(GuliException.class)
    @ResponseBody
    public R error(GuliException e){
        e.printStackTrace();
        log.error("执行了自定义异常");
        return R.error().message(e.getMessage()).code(e.getCode());
    }
````

#### 4、测试

![image-20220709195501509](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-26.png)

## 十一、统一日志处理

### 11.1、日志

#### 1、配置日志级别

日志记录器（Logger）的行为是分等级的。如下表所示：

分为：<span style="color:red">OFF、FATAL、ERROR、WARN、INFO、DEBUG、ALL</span>

默认情况下，spring boot从控制台打印出来的日志级别只有INFO及以上级别，可以配置日志级别

````properties
# 设置日志级别
logging.level.root=WARN
````

这种方式只能将日志打印在控制台上

![image-20220709205830487](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-27.png)

### 11.2、Logback日志

spring boot内部使用Logback作为日志实现的框架。

Logback和log4j非常相似，如果你对log4j很熟悉，那对logback很快就会得心应手。

logback相对于log4j的一些优点：[https://blog.csdn.net/caisini_vc/article/details/48551287](https://blog.csdn.net/caisini_vc/article/details/48551287)

#### 1、配置logback日志

删除application.properties中的日志配置

安装idea彩色日志插件：grep-console

resources 中创建 logback-spring.xml

````xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration  scan="true" scanPeriod="10 seconds">
    <!-- 日志级别从低到高分为TRACE < DEBUG < INFO < WARN < ERROR < FATAL，如果设置为WARN，则低于WARN的信息都不会输出 -->
    <!-- scan:当此属性设置为true时，配置文件如果发生改变，将会被重新加载，默认值为true -->
    <!-- scanPeriod:设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认单位是毫秒。当scan为true时，此属性生效。默认的时间间隔为1分钟。 -->
    <!-- debug:当此属性设置为true时，将打印出logback内部日志信息，实时查看logback运行状态。默认值为false。 -->
    <contextName>logback</contextName>
    <!-- name的值是变量的名称，value的值时变量定义的值。通过定义的值会被插入到logger上下文中。定义变量后，可以使“${}”来使用变量。 -->
    <property name="log.path" value="E:/project/guli_edu" />
    <!-- 彩色日志 -->
    <!-- 配置格式变量：CONSOLE_LOG_PATTERN 彩色日志格式 -->
    <!-- magenta:洋红 -->
    <!-- boldMagenta:粗红-->
    <!-- cyan:青色 -->
    <!-- white:白色 -->
    <!-- magenta:洋红 -->
    <property name="CONSOLE_LOG_PATTERN"
              value="%yellow(%date{yyyy-MM-dd HH:mm:ss}) |%highlight(%-5level) |%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)"/>
    <!--输出到控制台-->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或等于此级别的日志信息-->
        <!-- 例如：如果此处配置了INFO级别，则后面其他位置即使配置了DEBUG级别的日志，也不会被输出 -->
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>INFO</level>
        </filter>
        <encoder>
            <Pattern>${CONSOLE_LOG_PATTERN}</Pattern>
            <!-- 设置字符集 -->
            <charset>UTF-8</charset>
        </encoder>
    </appender>
    <!--输出到文件-->
    <!-- 时间滚动输出 level为 INFO 日志 -->
    <appender name="INFO_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- 正在记录的日志文件的路径及文件名 -->
        <file>${log.path}/log_info.log</file>
        <!--日志文件输出格式-->
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
            <charset>UTF-8</charset>
        </encoder>
        <!-- 日志记录器的滚动策略，按日期，按大小记录 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <!-- 每天日志归档路径以及格式 -->
            <fileNamePattern>${log.path}/info/log-info-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>100MB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
            <!--日志文件保留天数-->
            <maxHistory>15</maxHistory>
        </rollingPolicy>
        <!-- 此日志文件只记录info级别的 -->
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>INFO</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>
    <!-- 时间滚动输出 level为 WARN 日志 -->
    <appender name="WARN_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- 正在记录的日志文件的路径及文件名 -->
        <file>${log.path}/log_warn.log</file>
        <!--日志文件输出格式-->
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
            <charset>UTF-8</charset> <!-- 此处设置字符集 -->
        </encoder>
        <!-- 日志记录器的滚动策略，按日期，按大小记录 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${log.path}/warn/log-warn-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>100MB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
            <!--日志文件保留天数-->
            <maxHistory>15</maxHistory>
        </rollingPolicy>
        <!-- 此日志文件只记录warn级别的 -->
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>warn</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>
    <!-- 时间滚动输出 level为 ERROR 日志 -->
    <appender name="ERROR_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <!-- 正在记录的日志文件的路径及文件名 -->
        <file>${log.path}/log_error.log</file>
        <!--日志文件输出格式-->
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
            <charset>UTF-8</charset> <!-- 此处设置字符集 -->
        </encoder>
        <!-- 日志记录器的滚动策略，按日期，按大小记录 -->
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${log.path}/error/log-error-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>100MB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
            <!--日志文件保留天数-->
            <maxHistory>15</maxHistory>
        </rollingPolicy>
        <!-- 此日志文件只记录ERROR级别的 -->
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>ERROR</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
    </appender>
    <!--
        <logger>用来设置某一个包或者具体的某一个类的日志打印级别、以及指定<appender>。
        <logger>仅有一个name属性，
        一个可选的level和一个可选的addtivity属性。
        name:用来指定受此logger约束的某一个包或者具体的某一个类。
        level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF，
              如果未设置此属性，那么当前logger将会继承上级的级别。
    -->
    <!--
        使用mybatis的时候，sql语句是debug下才会打印，而这里我们只配置了info，所以想要查看sql语句的话，有以下两种操作：
        第一种把<root level="INFO">改成<root level="DEBUG">这样就会打印sql，不过这样日志那边会出现很多其他消息
        第二种就是单独给mapper下目录配置DEBUG模式，代码如下，这样配置sql语句会打印，其他还是正常DEBUG级别：
     -->
    <!--开发环境:打印控制台-->
    <springProfile name="dev">
        <!--可以输出项目中的debug日志，包括mybatis的sql日志-->
        <logger name="com.guli" level="INFO" />
        <!--
            root节点是必选节点，用来指定最基础的日志输出级别，只有一个level属性
            level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF，默认是DEBUG
            可以包含零个或多个appender元素。
        -->
        <root level="INFO">
            <appender-ref ref="CONSOLE" />
            <appender-ref ref="INFO_FILE" />
            <appender-ref ref="WARN_FILE" />
            <appender-ref ref="ERROR_FILE" />
        </root>
    </springProfile>
    <!--生产环境:输出到文件-->
    <springProfile name="pro">
        <root level="INFO">
            <appender-ref ref="CONSOLE" />
            <appender-ref ref="DEBUG_FILE" />
            <appender-ref ref="INFO_FILE" />
            <appender-ref ref="ERROR_FILE" />
            <appender-ref ref="WARN_FILE" />
        </root>
    </springProfile>
</configuration>
````

#### 2、将错误日志输出到文件

GlobalExceptionHandler.java 中

类上添加注解

````java
 @Slf4j
````

异常输出语句

````java
 log.error(e.getMessage());
````

![image-20220709211113769](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-28.png)

## 十二、vue-element-admin

### 12.1、vue-element-admin

#### 1、简介

而vue-element-admin是基于element-ui 的一套<span style="color:red">后台管理系统集成方案。</span>

**功能：**[https://panjiachen.github.io/vue-element-admin-site/zh/guide/#%E5%8A%9F%E8%83%BD](https://panjiachen.github.io/vue-element-admin-site/zh/guide/#%E5%8A%9F%E8%83%BD)

**GitHub地址：**[https://github.com/PanJiaChen/vue-element-admin](https://github.com/PanJiaChen/vue-element-admin)

**项目在线预览：**[https://panjiachen.gitee.io/vue-element-admin](https://panjiachen.gitee.io/vue-element-admin/#/login?redirect=%2Fdashboard)

#### 2、安装

````sh
# 解压压缩包
# 进入目录
cd vue-element-admin-master
# 安装依赖
npm install
# 启动。执行后，浏览器自动弹出并访问http://localhost:9527/
npm run dev
````

### 12.2、vue-admin-template

#### 1、简介

vueAdmin-template是基于vue-element-admin的一套后台管理系统基础模板（最少精简版），可作为模板进行二次开发。

**GitHub地址：**https://github.com/PanJiaChen/vue-admin-template

**建议：**你可以在 `vue-admin-template` 的基础上进行二次开发，把 `vue-element-admin`当做工具箱，想要什么功能或者组件就去 `vue-element-admin` 那里复制过来。

#### 2、安装

````sh
# 解压压缩包
# 进入目录
cd vue-admin-template-master
# 安装依赖
npm install
# 启动。执行后，浏览器自动弹出并访问http://localhost:9528/
npm run dev
````

### 12.3、项目的创建和基本配置

#### **1、创建项目**

将vue-admin-template-master重命名为guli-admin

#### 2、修改项目信息

package.json

```json
{
  "name": "guli-admin",
  "version": "4.4.0",
  "description": "谷粒学院后台管理系统",
  "author": "Pan <panfree23@gmail.com>",
   ·······
},
```

#### 3、项目的目录结构

````java
├── build // 构建脚本
├── node_modules // 项目依赖模块
├── src //项目源代码
├── static // 静态资源
└── package.json // 项目信息和依赖配置
````

```json
src 
├── api // 各种接口 
├── assets // 图片等资源 
├── components // 各种公共组件，非公共组件在各自view下维护 
├── icons //svg icon 
├── router // 路由表 
├── store // 存储 
├── styles // 各种样式 
├── utils // 公共工具，非公共工具，在各自view下维护 
├── views // 各种layout
├── App.vue //***项目顶层组件*** 
├── main.js //***项目入口文件***
└── permission.js //认证入口
```

#### 4、运行项目

```sh
npm run dev
```

### 12.4、登录页修改

src/views/login/index.vue（登录组件）

````html
<template>
  <div class="login-container">
    <el-form ref="loginForm" :model="loginForm" :rules="loginRules" class="login-form" auto-complete="on" label-position="left">

      <div class="title-container">
        <h3 class="title">谷粒学院后台管理系统</h3>
      </div>

      <el-form-item prop="username">
        <span class="svg-container">
          <svg-icon icon-class="user" />
        </span>
        <el-input
          ref="username"
          v-model="loginForm.username"
          placeholder="用户名"
          name="username"
          type="text"
          tabindex="1"
          auto-complete="on"
        />
      </el-form-item>

      <el-form-item prop="password">
        <span class="svg-container">
          <svg-icon icon-class="password" />
        </span>
        <el-input
          :key="passwordType"
          ref="password"
          v-model="loginForm.password"
          :type="passwordType"
          placeholder="密码"
          name="password"
          tabindex="2"
          auto-complete="on"
          @keyup.enter.native="handleLogin"
        />
        <span class="show-pwd" @click="showPwd">
          <svg-icon :icon-class="passwordType === 'password' ? 'eye' : 'eye-open'" />
        </span>
      </el-form-item>
      <el-button :loading="loading" type="primary" style="width:100%;margin-bottom:30px;" @click.native.prevent="handleLogin">登录</el-button>
    </el-form>
  </div>
</template>
````

### 12.5、国际化设置

打开 src/main.js<span style="color:red">（项目的js入口）</span>，第7行，修改语言为<span style="color:red"> zh-CN</span>，使用中文语言环境，例如：日期时间组件

````js
import locale from 'element-ui/lib/locale/lang/zh-CN' // lang i18n
````

## 十三、后台登录功能改造

### 13.1	写登录以及信息接口

````java
package com.yz.eduservice.controller;

import com.yz.commonutils.R;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.springframework.web.bind.annotation.*;

/**
 * @Author 杨洲
 * @Date 2022/7/10 7:11
 */
@Api(tags = "登录接口")
@RestController
@RequestMapping("/eduservice/user")
public class LoginController {

    //login
    @ApiOperation("管理员登录")
    @PostMapping("login")
    public R login(){
        return R.ok().data("token","admin-token");
    }


    //info
    @GetMapping("info")
    public R info(){
        return R.ok().data("roles","[admin]").data("name","admin").data("avatar","https://guli-file-190513.oss-cn-beijing.aliyuncs.com/avatar/default.jpg");
    }

    /**
     * 退出
     * @return
     */
    @PostMapping("logout")
    public R logout(){
        return R.ok();
    }
}
````

### 13.2 修改user.js

````js
import request from '@/utils/request'

export function login(data) {
  return request({
    url: '/eduservice/user/login',
    method: 'post',
    data
  })
}

export function getInfo(token) {
  return request({
    url: '/eduservice/user/info',
    method: 'get',
    params: { token }
  })
}

export function logout() {
  return request({
    url: '/eduservice/user/logout',
    method: 'post'
  })
}
````

## 十四、项目中的路由

### 14.1	谷粒学院路由定义

#### 1、修改路由

修改 src/router/index.js 文件，重新定义constantRouterMap

**注意：**每个路由的name不能相同

````js
  //讲师管理
  {
    path: '/edu/teacher',
    component: Layout,
    redirect: '/edu/teacher/list',
    name: 'Teacher',
    meta: { title: '讲师管理', icon: 'el-icon-s-help' },
    children: [
      {
        path: 'list',
        name: 'EduTeacherList',
        component: () => import('@/views/edu/teacher/list'),
        meta: { title: '讲师列表', icon: 'table' }
      },
      {
        path: 'create',
        name: 'EduTeacherCreate',
        component: () => import('@/views/edu/teacher/form'),
        meta: { title: '添加讲师', icon: 'tree' },
        hidden:false
      },
      {
        path: 'edit/:id',
        name: 'EduTeacherEdit',
        component: () => import('@/views/edu/teacher/form'),
        meta: { title: '编辑讲师', icon: 'tree' },
        hidden:true
      }
    ]
  },
````

### 14.2、创建vue组件

在src/views文件夹下创建以下文件夹和文件

![image-20220709221753142](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-29.png)

#### 1、form.vue

````html
<template>
  <div class="app-container">
    讲师表单
  </div>
</template>
````

#### 2、list.vue

````html
<template>
  <div class="app-container">
    讲师列表
  </div>
</template>
````

## 十五、讲师管理列表组件

**实现步骤**

![image-20220710094042847](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-30.png)

### 15.1、分页列表

#### 1、定义api

创建文件 src/api/edu/teacher.js

````js
import request from '@/utils/request'
const api_name = '/admin/edu/teacher'

export default {
  //1.讲师列表（条件分页查询）
  //current当前页 limit每页记录数 teacherQuery条件对象
  getTeacherListPage(page,limit,teacherQuery){
    return request({
      url: `${api_name}/${page}/${limit}`,
      method:'post',
      //teacherQuery条件对象，后端使用RequestBody获取数据
      //data表示把对象转换成json进行传递到接口里面
      data: teacherQuery
    })
  }
}
````

#### 2、初始化vue组件

src/views/edu/teacher/list.vue

````html
<template>
  <div class="app-container">
    讲师列表
  </div>
</template>

<script>
//引入调用teacher.js文件
import teacherApi from '@/api/edu/teacher'
export default {
  name: 'list',
  data() {//定义数据
    return {    
    }
  },
  created() {//页面渲染之前执行，一般用methods定义的方法
  },
  methods: {//创建具体的方法，调用teacher.js定义的方法
  },
}
</script>
````

#### 3、定义data

````js
  data() {//定义数据
    return {
      listLoading: true, // 是否显示loading信息
      list:null,//数据列表
      total: 0, // 总记录数
      page:1,//当前页
      limit:10,//每页记录数
      teacherQuery:{}//条件封装对象
    }
  },
````

#### 4、定义methods

````js
  methods: {//创建具体的方法，调用teacher.js定义的方法
    //讲师列表方法
    getList(){
      teacherApi.getTeacherListPage(this.page,this.limit,this.teacherQuery)
        .then(response=>{//请求成功
            //response接口返回数据
          console.log(response)
        })
        .catch(error=>{
          console.log(error)
        })//请求失败
    }
  },
````

![image-20220710102116896](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-31.png)

#### 5、表格渲染

````html
    <el-table
      :data="list"
      border
      highlight-current-row>
      <el-table-column
        label="序号"
        width="70"
        align="center">
        <template slot-scope="scope">
          {{(page-1)*limit + scope.$index + 1 }}
        </template>
      </el-table-column>
      <el-table-column prop="name" label="名称" width="80"/>
      <el-table-column prop="level" label="头衔" width="100" align="center" >
        <template v-slot="scope">
          <el-tag :type="scope.row.level === 1 ? '' : 'success'">
            {{ scope.row.level === 1 ? '高级讲师' : '首席讲师' }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column prop="intro" label="资历" />
      <el-table-column prop="gmtCreate" label="添加时间" width="160"/>
      <el-table-column prop="sort" label="排序" width="80"/>
      <el-table-column label="操作" width="200" align="center">
        <template v-slot="scope">
          <router-link :to="'/edu/teacher/edit/'+scope.row.id">
            <el-button type="primary" size="mini" icon="el-icon-edit">修改</el-button>
          </router-link>
          <el-button type="danger" size="mini" icon="el-icon-delete" @click="removeDataById(scope.row.id)" class="ml-5">删除</el-button>
        </template>
      </el-table-column>
    </el-table>
````

![image-20220710105108804](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-32.png)

#### 6、分页组件

①设置分页组件

````html
    <!-- 分页组件 -->
    <el-pagination
      :current-page="page"
      :total="total"
      :page-size="limit"
      :page-sizes="[5, 10, 20, 30, 40, 50, 100]"
      style="padding: 30px 0; text-align: center;"
      layout="total, sizes, prev, pager, next, jumper"
      @size-change="changePageSize"		    //修改当前页数据条数
      @current-change="changeCurrentPage"	//修改页码
    />
````

②添加方法

````js
    //讲师列表方法
    getList(){
      teacherApi.getTeacherListPage(this.page,this.limit,this.teacherQuery)
        .then(response=>{//请求成功
            //response接口返回数据
          this.list = response.data.rows
          this.total = response.data.total
        })
        .catch(error=>{
          console.log(error)
        })//请求失败
    },
    // 每页记录数改变，size：回调参数，表示当前选中的“每页条数”
    changePageSize(size) {
      this.limit = size
      this.getList()
    },

    // 改变页码，page：回调参数，表示当前选中的“页码”
    changeCurrentPage(page) {
      this.page = page
      this.getList()
    },
  },
````

![image-20220710112552164](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-33.png)

#### 7、顶部查询表单

<span style="color:red">**注意：**</span>

element-ui的 date-picker组件默认绑定的时间值是默认世界标准时间，和中国时间差8小时

<span style="color:red">设置 value-format="yyyy-MM-dd HH:mm:ss" 改变绑定的值</span>

````html
    <!--查询表单-->
    <el-card shadow="never">
      <span><i class="el-icon-search"></i>筛选搜索</span>
      <el-form :inline="true" class="demo-form-inline mt-10" >
        <el-form-item>
          <el-input v-model="teacherQuery.name" placeholder="讲师名"></el-input>
        </el-form-item>

        <el-form-item>
          <el-select v-model="teacherQuery.level" placeholder="讲师头衔">
            <el-option value="1" label="高级讲师"></el-option>
            <el-option value="2" label="首席讲师"></el-option>
          </el-select>
        </el-form-item>

        <el-form-item label="添加时间">
          <el-date-picker
            v-model="teacherQuery.begin"
            type="datetime"
            placeholder="选择开始时间"
            value-format="yyyy-MM-dd HH:mm:ss"
            default-time="00:00:00">
          </el-date-picker>
        </el-form-item>

        <el-form-item label="添加时间">
          <el-date-picker
            v-model="teacherQuery.end"
            type="datetime"
            placeholder="选择截止时间"
            value-format="yyyy-MM-dd HH:mm:ss"
            default-time="00:00:00">
          </el-date-picker>
        </el-form-item>
        <el-button type="primary" icon="el-icon-search" @click="getList()">查询</el-button>
        <el-button type="default" @click="resetData()">清空</el-button>
      </el-form>
    </el-card>
````

清空方法

````js
    resetData(){
      this.teacherQuery = {}
      this.getList()
    }
````

![image-20220710113021563](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-34.png)

### 15.2、删除

实现步骤

![image-20220710121013076](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-35.png)

#### 1、定义api

src/api/edu/teacher.js

````js
  //2.根据id删除讲师
  deleteTeacher(id){
    return request({
      url: `${api_name}/${id}`,
      method:'delete'
    })
  }
````

#### 2、定义methods

src/views/edu/teacher/list.vue

<span style="color:red">使用MessageBox 弹框组件</span>

````js
  //  根据id删除讲师
    removeDataById(id){
      this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        teacherApi.deleteTeacher(id).then(response=>{
          this.$message({
            type: 'success',
            message: '删除成功!'
          });
        })
      }).catch(() => {
        this.$message({
          type: 'info',
          message: '已取消删除'
        });
      });
    }
````

![image-20220710120726779](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-36.png)

### 15.3、新增

实现步骤

![image-20220710131749589](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-37.png)

#### 1、定义api

src/api/edu/teacher.js

````js
  //添加讲师
  addTeacher(teacher){
    return request({
      url:`${api_name}/save`,
      method:'post',
      data: teacher
    })
  }
````

#### 2、初始化组件

src/views/edu/teacher/form.vue

html

````html
<template>
  <div class="app-container">
    <el-card shadow="nerve">
      <el-form label-width="120px" size="large">
        <el-form-item label="讲师名称">
          <el-input v-model="teacher.name" />
        </el-form-item>

        <el-form-item label="讲师排序">
          <el-input-number v-model="teacher.sort" controls-position="right" min="0"/>
        </el-form-item>

        <el-form-item label="讲师头衔">
          <el-select v-model="teacher.level" clearable placeholder="请选择" >
            <!--
              数据类型一定要和取出的json中的一致，否则没法回填
              因此，这里value使用动态绑定的值，保证其数据类型是number
            -->
            <el-option value="1" label="高级讲师"/>
            <el-option value="2" label="首席讲师"/>
          </el-select>
        </el-form-item>

        <el-form-item label="讲师资历">
          <el-input v-model="teacher.career" />
        </el-form-item>

        <el-form-item label="讲师简介">
          <el-input v-model="teacher.intro" :rows="10" type="textarea" />
        </el-form-item>
        <!--  讲师头像    -->
        <el-form-item >
          <el-button :disabled="saveBtnDisabled" type="primary" @click="saveOrUpdate">保存</el-button>
        </el-form-item>
      </el-form>
    </el-card>
  </div>
</template>
````

js

````js
<script>
export default {
  name: 'form',
  data() {
    return {
      teacher:{
        name:'',
        sort:'',
        level:'',
        career:'',
        intro:'',
        avatar:'',
      },
      saveBtnDisabled:false //保存按钮是否禁用，
    }
  },
  methods: {
    saveOrUpdate(){

    },
    //保存
    saveTeacher(){

    }
  },

}
</script>
````

![image-20220710124526248](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-38.png)

#### 3、实现新增功能

引入teacher api模块

````js
import teacherApi from "@/api/edu/teacher";
````

完善saveTeacher方法

````js
  methods: {
    saveOrUpdate(){
        //添加
      this.saveTeacher()
      this.saveBtnDisabled = true
    },
    //添加讲师方法
    saveTeacher(){
        teacherApi.addTeacher(this.teacher)
            .then(response=>{//添加成功
            //提示信息
              this.$message({
                type: 'success',
                message: '添加成功!'
              });
            //回到列表页面 路由跳转
            this.$router.push({path:'/edu/teacher/list'})
        })
    }
  },
````

### 15.4、回显

实现步骤

![未命名表单 (4)(1)](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-39.png)

#### 1、定义api

src/api/edu/teacher.js

````js
  //根据id查询讲师
  getTeacherInfo(id){
    return request({
      url:`${api_name}/getTeacher/${id}`,
      method:'get',
    })
  },
````

#### 2、组件中调用api

methods中定义getInfo

````js
    //根据讲师id查询方法
    getInfo(id){
      teacherApi.getTeacherInfo(id)
        .then(response=>{
          this.teacher = response.data.teacher
      })
    },
````

#### 3、页面渲染前调用getInfo

````js
  created() {//在页面渲染之前执行
    if (this.$route.params && this.$route.params.id){
      //从路径获取id值
      const id = this.$route.params.id
      //调用根据id查询的方法
      this.getInfo(id)
    }
  },
````

### 15.5、更新

#### 1、定义api

````js
  //修改讲师
  updateTeacherInfo(teacher){
    return request({
      url:`${api_name}/updateTeacher`,
      method:'post',
      data: teacher
    })
  },
````

#### 2、组件中调用api

methods中定义updateTeacher

````js
    //修改讲师方法
    updateTeacher(){
      teacherApi.updateTeacherInfo(this.teacher)
        .then(response=>{
          //提示信息
          this.$message({
            type: 'success',
            message: '修改成功!'
          });
          //回到列表页面 路由跳转
          this.$router.push({path:'/edu/teacher/list'})
      })
    }
````

#### 3、完善saveOrUpdate方法

````js
    saveOrUpdate(){
        //判断修改还是添加
      //根据teacher是否有id
      if (!this.teacher.id){
        //添加
        this.saveTeacher()
      }else {
        //修改
        this.updateTeacher()
      }
    },
````

## 十六、阿里云存储OSS

### 16.1、对象存储OSS

**实现步骤**

![image-20220710210434716](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-40.png)

为了解决海量数据存储与弹性扩容，项目中我们采用云存储的解决方案- 阿里云OSS。

#### 1、开通“对象存储OSS”服务

（1）申请阿里云账号

（2）实名认证

（3）开通“对象存储OSS”服务

（4）进入管理控制台

#### 2、创建Bucket

选择：标准存储、公共读、不开通

![image-20220710200044267](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-41.png)

#### 3、上传默认头像

创建文件夹avatar，上传默认的用户头像

![image-20220710205045027](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-42.png)

## 十七、后端集成OSS

### 17.1、新建云存储微服务

#### 1、在service模块下创建子模块service-oss

![image-20220710210551764](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-43.png)

#### 2、配置pom.xml

service-oss上级模块service已经引入service的公共依赖，所以service-oss模块只需引入阿里云oss相关依赖即可，

service父模块已经引入了service-base模块，所以Swagger相关默认已经引入

````xml
<dependencies>
        <!--aliyun oss-->
        <dependency>
            <groupId>com.aliyun.oss</groupId>
            <artifactId>aliyun-sdk-oss</artifactId>
            <version>2.8.3</version>
        </dependency>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.12</version>
        </dependency>
        <!--日期工具栏依赖-->
        <dependency>
            <groupId>joda-time</groupId>
            <artifactId>joda-time</artifactId>
        </dependency>
</dependencies>
````

#### 3、配置application.yml

````yml
# 服务端接口
server:
  port: 8002
# 服务名
spring:
  application:
    name: server-oss
# 环境设置：dev、test、prod
  profiles:
    active: dev
#阿里云 OSS
# 不同服务器、地址不同
aliyun:
  oss:
    file:
      endpoint: your endpoint
      keyid: your accessKeyId
      keysecret: your accessKeySecret
#bucket可以在控制台创建，也可以使用java代码创建
      bucketname: yangzhou-file
````

#### 4、logback-spring.xml

#### 5、创建启动类

创建OssApplication.java

````java
package com.yz.oss;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.ComponentScan;

/**
 * @Author 杨洲
 * @Date 2022/7/10 20:56
 */
@SpringBootApplication
@ComponentScan(basePackages = {"com.yz"})
public class OssApplication {
    public static void main(String[] args) {
        SpringApplication.run(OssApplication.class,args);
    }
}
````

````js
location ~ /eduoss/ {           
    proxy_pass http://localhost:8001;
}
````

#### 6、启动项目

<span style="color:red">**报错**</span>

![image-20220710214646585](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-44.png)

> spring boot 会默认加载org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration这个类，
>
> 而DataSourceAutoConfiguration类使用了@Configuration注解向spring注入了dataSource bean，又因为项目（oss模块）中并没有关于dataSource相关的配置信息，所以当spring创建dataSource bean时因缺少相关的信息就会报错。

<span style="color:red">**解决办法：**</span>

方法1、在@SpringBootApplication注解上加上exclude，解除自动加载DataSourceAutoConfiguration

````java
@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)
````

### 17.2、实现文件上传

#### 1、从配置文件读取常量

创建常量读取工具类：ConstantPropertiesUtil.java

使用@Value读取application.yml里的配置内容

用spring的 InitializingBean 的 afterPropertiesSet 来初始化配置信息，这个方法将在所有的属性被初始化后调用。

````java
package com.yz.oss.utils;

import org.springframework.beans.factory.InitializingBean;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;


@Component
public class ConstanPropertiesUtils  implements InitializingBean {

    //读取配置文件内容
    @Value("${aliyun.oss.file.endpoint}")
    private String endpoint;

    @Value("${aliyun.oss.file.keyid}")
    private String keyId;

    @Value("${aliyun.oss.file.keysecret}")
    private String keySecret;

    // @Value("${aliyun.oss.file.filehost}")
    // private String fileHost;
    @Value("${aliyun.oss.file.bucketname}")
    private String bucketName;
    //定义公开静态变量
    public static String END_POINT;
    public static String ACCESS_KEY_ID;
    public static String ACCESS_KEY_SECRET;
    public static String BUCKET_NAME;
    // public static String FILE_HOST ;
    @Override
    public void afterPropertiesSet() throws Exception {
        END_POINT = endpoint;
        ACCESS_KEY_ID = keyId;
        ACCESS_KEY_SECRET = keySecret;
        BUCKET_NAME = bucketName;
        // FILE_HOST = fileHost;
    }
}
````

#### 2、文件上传

<span style="color:red">创建Service接口：FileService.java</span>

````java
public interface OssService {
    String uploadFileAvatar(MultipartFile file);
}
````

<span style="color:red">实现：FileServiceImpl.java</span>

参考SDK中的：Java->上传文件->简单上传->流式上传->上传文件流

![img](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-45.png)

````java
package com.yz.oss.service.impl;

import com.aliyun.oss.OSS;
import com.aliyun.oss.OSSClientBuilder;
import com.yz.oss.service.OssService;
import com.yz.oss.utils.ConstanPropertiesUtils;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;

/**
 * @Author 杨洲
 * @Date 2022/7/11 11:24
 */
@Service
public class OssServiceImpl implements OssService {
    //上传头像到oss
    @Override
    public String uploadFileAvatar(MultipartFile file) {
        //工具类获取值
        // Endpoint以华东1（杭州）为例，其它Region请按实际情况填写。
        String endpoint = ConstanPropertiesUtils.END_POINT;
        // 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。
        String accessKeyId = ConstanPropertiesUtils.ACCESS_KEY_ID;
        String accessKeySecret = ConstanPropertiesUtils.ACCESS_KEY_SECRET;
        // 填写Bucket名称。
        String bucketName = ConstanPropertiesUtils.BUCKET_NAME;

        try {
            // 创建OSSClient实例。
            OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);
            //获取文件上传输入流
            InputStream inputStream = file.getInputStream();
            //获取文件原始名称
            String fileName = file.getOriginalFilename();
            //调用oss方法实现上传
            //第一个参数据 Bucket名称
            //第二个参数据 上传到oss文件路径和文件名称
            //第三个参数据 上传文件流
            ossClient.putObject(bucketName, fileName, inputStream);
            //关闭OSSClient
            ossClient.shutdown();
            //把上传文件的路径进行返回
            //需要把上传到阿里云oss路径手动拼接处理
            // https://yangzhou-file.oss-cn-shanghai.aliyuncs.com/avatar/banner.png
            String url = "https://"+bucketName+"."+endpoint+"/"+fileName;
            return  url;
        } catch (IOException e) {
            return  null;
        }
    }
}
````

#### 3、控制层

<span style="color:red">创建controller：FileUploadController.java</span>

````java
package com.yz.oss.controller;

import com.yz.commonutils.R;
import com.yz.oss.service.OssService;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import javax.annotation.Resource;

/**
 * @Author 杨洲
 * @Date 2022/7/11 11:23
 */
@RestController
@RequestMapping("eduoss/fileoss")
public class OssController {

    @Resource
    private OssService ossService;

    //上传头像
    @PostMapping
    public R uploadOssFile(MultipartFile file){
        //获取上传文件    MultipartFile
        String url = ossService.uploadFileAvatar(file);
        return R.ok().data("url",url);
    }
}
````

#### 4、Postman测试

<span style="color:red">**Swagger版本没有文件上传测试**</span>

![image-20220711122626985](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-46.png)

#### 5、配置nginx反向代理

<span style="color:red">**nginx-1.22.0\conf\nginx.conf中配置**</span>

将接口地址加入nginx配置

````json
location ~ /eduoss/ {           
    proxy_pass http://localhost:8001;
}
````

![image-20220711122701449](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-47.png)

Nginx     **反向代理服务器**

- 请求转发

![image-20220711124828243](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-48.png)

- 负载均衡

![image-20220711125256514](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-49.png)

- 动静分离

### 17.3、上传头像接口完善

<span style="color:red">完善：FileServiceImpl.java </span>

![image-20220711122338752](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-50.png)

````java
package com.yz.oss.service.impl;

import com.aliyun.oss.OSS;
import com.aliyun.oss.OSSClientBuilder;
import com.yz.oss.service.OssService;
import com.yz.oss.utils.ConstanPropertiesUtils;
import org.joda.time.DateTime;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.UUID;

/**
 * @Author 杨洲
 * @Date 2022/7/11 11:24
 */
@Service
public class OssServiceImpl implements OssService {
    //上传头像到oss
    @Override
    public String uploadFileAvatar(MultipartFile file) {
        //工具类获取值
        // Endpoint以华东1（杭州）为例，其它Region请按实际情况填写。
        String endpoint = ConstanPropertiesUtils.END_POINT;
        // 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。
        String accessKeyId = ConstanPropertiesUtils.ACCESS_KEY_ID;
        String accessKeySecret = ConstanPropertiesUtils.ACCESS_KEY_SECRET;
        // 填写Bucket名称。
        String bucketName = ConstanPropertiesUtils.BUCKET_NAME;

        try {
            // 创建OSSClient实例。
            OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);
            //获取文件上传输入流
            InputStream inputStream = file.getInputStream();
            //获取文件原始名称
            String fileName = file.getOriginalFilename();

            //1.在文件名称里面添加随机唯一值
            //ver-das-213-
            String uuid = UUID.randomUUID().toString().replaceAll("-","");
            //test01.jpg
            fileName = uuid+fileName;

            //2.把文件按照日期进行分类
            //2022/7/11.jpg
            //获取当前日期
            String datePath = new DateTime().toString("yyyy/MM/dd");

            //拼接
            fileName = datePath+"/"+fileName;

            //调用oss方法实现上传
            //第一个参数据 Bucket名称
            //第二个参数据 上传到oss文件路径和文件名称
            //第三个参数据 上传文件流
            ossClient.putObject(bucketName, fileName, inputStream);
            //关闭OSSClient
            ossClient.shutdown();
            //把上传文件的路径进行返回
            //需要把上传到阿里云oss路径手动拼接处理
            // https://yangzhou-file.oss-cn-shanghai.aliyuncs.com/avatar/banner.png
            String url = "https://"+bucketName+"."+endpoint+"/"+fileName;
            return  url;
        } catch (IOException e) {
            return  null;
        }
    }
}
````

## 十八、前端整合上传组件

### 18.1、前端整合图片上传组件

#### 1、复制头像上传组件

**从vue-element-admin复制组件：**

[https://github.com/PanJiaChen/vue-element-admin](https://github.com/PanJiaChen/vue-element-admin)

vue-element-admin/src/components/ImageCropper

vue-element-admin/src/components/PanThumb

![image-20220711132511839](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-51.png)

#### 2、前端参考实现

src/views/components-demo/avatarUpload.vue

#### 3、前端添加文件上传组件

**src/views/edu/teacher/form.vue**

template：

````html
 <!--  讲师头像    -->
        <el-form-item label="讲师头像">
        <!--  头衔缩略图    -->
        <pan-thumb :image="teacher.avatar"/>
        <!--  讲师头像    -->
        <el-button type="primary" icon="el-icon-upload" @click="imagecropperShow=true">更换头像</el-button>
        <!--
            v-show:是否显示上传组件
            :key:类似于id，如果一个页面多个图片上传控件，可以做分区
            :url:后台上传的url地址
            @close:关闭上传组件
            @crop-upload-success:上传成功后回调-->
        <image-cropper
            v-show="imagecropperShow"
            :width="300"
            :height="300"
            :key="imagecropperKey"
            :url="BASE_API+'/eduoss/file/upload'"
            field="file"
            @close="close"
            @crop-upload-success="cropSuccess"/>
        </el-form-item>
        <el-form-item >
          <el-button type="primary" @click="saveOrUpdate">保存</el-button>
        </el-form-item>
````

引入组件模块

````js
import ImageCropper from '@/components/ImageCropper'
import PanThumb from '@/components/PanThumb'
````

![image-20220711144405039](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-52.png)

#### 4、js脚本实现上传和图片回显

````js
export default {
  components: {ImageCropper,PanThumb},
  data() {
    return {
      //其它数据模型
      ......,
      imagecropperShow: false, // 是否显示上传组件
      imagecropperKey: 0, // 上传组件id
      BASE_API:'http://localhost', // 接口API地址
    }
  },
  methods: {
    //其他函数
    ......,
    close(){//关闭上传弹框方法
      this.imagecropperShow = false
      // 上传失败后，重新打开上传组件时初始化组件，否则显示上一次的上传结果
      this.imagecropperKey = this.imagecropperKey + 1
    },
    cropSuccess(data){//上传成功方法
      this.imagecropperShow = false
      this.$message({
        type: 'success',
        message: '上传成功!'
      });
      this.teacher.avatar = data.url
      // // 上传成功后，重新打开上传组件时初始化组件，否则显示上一次的上传结果
      this.imagecropperKey = this.imagecropperKey + 1
    },
  },

}
````

### 18.2、测试文件上传

前后端联调

![image-20220711144429727](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-53.png)

## 十九、EasyExcel读写Excel的基本使用

[EasyExcel官方文档 - 基于Java的Excel处理工具 | Easy Excel (alibaba.com)](https://easyexcel.opensource.alibaba.com/)

### 19.1、Excel导入导出的应用场景

1、数据导入：减轻录入工作量

2、数据导出：统计信息归档

3、数据传输：异构系统之间数据传输

### 19.2、EasyExcel简介

#### 1、EasyExcel特点

- Java领域解析、生成Excel比较有名的框架有Apache poi、jxl等。但他们都存在一个严重的问题就是非常的耗内存。如果你的系统并发量不大的话可能还行，但是一旦并发上来后一定会OOM或者JVM频繁的full gc。
- EasyExcel是阿里巴巴开源的一个excel处理框架，<span style="color:red">**以使用简单、节省内存著称**</span>。EasyExcel能大大减少占用内存的主要原因是在解析Excel时没有将文件数据一次性全部加载到内存中，而是从磁盘上一行行读取数据，逐个解析。
- EasyExcel采用一行一行的解析模式，并将一行的解析结果以观察者的模式通知处理（AnalysisEventListener）。

## 二十、Excel写

### 20.1、pom中引入xml相关依赖

在service_edu模块中引入依赖

````xml
<dependencies>
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>easyexcel</artifactId>
        <version>2.1.1</version>
    </dependency>
</dependencies>
````

### 20.2、创建实体类

**设置表头和添加的数据字段**

````java
package com.yz.service.excel;

import com.alibaba.excel.annotation.ExcelProperty;
import lombok.Data;

/**
 * @Author 杨洲
 * @Date 2022/7/11 17:21
 */
//设置表头和添加的数据字段
@Data
public class DemoData {
    //设置表头名称
    @ExcelProperty("学生编号")
    private Integer sno;
    @ExcelProperty("学生姓名")
    private String sname;
}
````

### 20.3、构建方法测试

![image-20220711174251491](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-54.png)

![image-20220711174423818](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-55.png)

## 二十一、Excel读

实现步骤

![image-20220711180126324](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-56.png)

### 21.1、创建实体类

````java
package com.yz.service.excel;

import com.alibaba.excel.annotation.ExcelProperty;
import lombok.Data;

/**
 * @Author 杨洲
 * @Date 2022/7/11 17:21
 */
//设置表头和添加的数据字段
@Data
public class DemoData {
    //设置表头名称
    @ExcelProperty(value = "学生编号",index = 0)
    private Integer sno;
    @ExcelProperty(value = "学生姓名",index = 1)
    private String sname;
}
````

### 21.2、创建读取操作的监听器

````java
package com.yz.service.excel;

import com.alibaba.excel.context.AnalysisContext;
import com.alibaba.excel.event.AnalysisEventListener;

import java.util.Map;

/**
 * @Author 杨洲
 * @Date 2022/7/11 17:53
 */
public class ExcelListener extends AnalysisEventListener<DemoData> {
    //一行一行读取excel内容
    @Override
    public void invoke(DemoData demoData, AnalysisContext analysisContext) {
        System.out.println("****"+demoData);
    }
    //读取表头内容
    @Override
    public void invokeHeadMap(Map<Integer, String> headMap, AnalysisContext context) {
        System.out.println("表头"+headMap);
    }
    //读取完成之后
    @Override
    public void doAfterAllAnalysed(AnalysisContext analysisContext) {
    }
}
````

### 21.3、调用实现最终的读取

````java
package com.yz.service.excel;

import com.alibaba.excel.EasyExcel;

import java.util.ArrayList;
import java.util.List;

/**
 * @Author 杨洲
 * @Date 2022/7/11 17:29
 */
public class TestEasyExcel {
    public static void main(String[] args) {
        //实现excel读操作
        String filename = "E:\\write.xlsx";
        EasyExcel.read(filename, DemoData.class,new ExcelListener()).sheet().doRead();
    }
}
````

![image-20220711181124638](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-57.png)

## 二十二、课程分类管理接口

![image-20220711155353551](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-58.png)

### 22.1、添加依赖

**1、service-edu模块配置依赖**

````xml
<dependencies>
    <!-- https://mvnrepository.com/artifact/com.alibaba/easyexcel -->
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>easyexcel</artifactId>
        <version>2.1.1</version>
    </dependency>
</dependencies>
````

### 22.2、业务处理

#### 1、SubjectAdminController

````java
package com.yz.eduservice.controller;


import com.yz.commonutils.R;
import com.yz.eduservice.entity.Subject;
import com.yz.eduservice.service.SubjectService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import javax.annotation.Resource;
import java.util.List;

/**
 * <p>
 * 课程科目 前端控制器
 * </p>
 *
 * @author 杨洲
 * @since 2022-07-10
 */
@RestController
@RequestMapping("/admin/edu/subject")
@Api(tags="课程分类管理")
public class SubjectController {
    @Resource
    private SubjectService subjectService;

    //添加课程分类
    //获取到上传过来的文件，读取文件内容
    @ApiOperation(value = "Excel批量导入")
    @PostMapping("addSubject")
    public R addSubject(MultipartFile file){
        //获得上传过的excel文件
        subjectService.saveSubject(file,subjectService);
        return R.ok();
    }

}
````

#### 2、创建和Excel对应的实体类

com.yz.eduservice.entity.excel包下创建SubjectData

````java
package com.yz.eduservice.entity.excel;

import com.alibaba.excel.annotation.ExcelProperty;
import lombok.Data;

/**
 * @Author 杨洲
 * @Date 2022/7/11 18:12
 */
@Data
public class SubjectData {
    @ExcelProperty(index = 0)
    private String oneSubjectName;
    @ExcelProperty(index = 1)
    private String twoSubjectName;
}
````

#### 3、SubjectService

接口

````java
public interface SubjectService extends IService<Subject> {
    //添加课程分类
    void saveSubject(MultipartFile file,SubjectService subjectService);
}
````

实现类

````java
package com.yz.eduservice.service.impl;

import com.alibaba.excel.EasyExcel;
import com.yz.eduservice.entity.Subject;
import com.yz.eduservice.entity.excel.SubjectData;
import com.yz.eduservice.listener.SubjectExcelListener;
import com.yz.eduservice.mapper.SubjectMapper;
import com.yz.eduservice.service.SubjectService;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import java.io.InputStream;

/**
 * <p>
 * 课程科目 服务实现类
 * </p>
 *
 * @author 杨洲
 * @since 2022-07-10
 */
@Service
public class SubjectServiceImpl extends ServiceImpl<SubjectMapper, Subject> implements SubjectService {
    //添加课程分类
    @Override
    public void saveSubject(MultipartFile file,SubjectService subjectService) {
        try {
            //文件输入流
            InputStream in = file.getInputStream();
            //调用方法进行读取
            EasyExcel.read(in, SubjectData.class,new SubjectExcelListener(subjectService)).sheet().doRead();
        } catch (Exception e) {

        }
    }
}
````

#### 4、创建读取Excel监听器

````java
package com.yz.eduservice.listener;

import com.alibaba.excel.context.AnalysisContext;
import com.alibaba.excel.event.AnalysisEventListener;
import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.yz.eduservice.entity.Subject;
import com.yz.eduservice.entity.excel.SubjectData;
import com.yz.eduservice.service.SubjectService;
import com.yz.servicebase.exception.GuliException;

import java.util.Map;


/**
 * @Author 杨洲
 * @Date 2022/7/11 20:30
 */
public class SubjectExcelListener extends AnalysisEventListener<SubjectData> {

    //因为SubjectExcelListener不能交给Spring进行管理，需要自己new，不能注入其他对象
    //不能实现数据库操作
    public SubjectService subjectService;

    public SubjectExcelListener() {}
    //创建有参数构造，传递subjectService用于操作数据库
    public SubjectExcelListener(SubjectService subjectService) {
        this.subjectService = subjectService;
    }
    //读取excel内容，一行一行进行读取
    @Override
    public void invoke(SubjectData subjectData, AnalysisContext analysisContext) {
        if (subjectData == null){
            throw new GuliException(20001,"文件数据为空!!");
        }

        //一行一行读取，每次读取都有两个值，第一个值一级分类，第二个值二级分类
        //判断一级分类是否重复
        Subject existOneSubject = this.existOneSubject(subjectService, subjectData.getOneSubjectName());
        if (existOneSubject == null){//没有相同的一级分类，进行添加
            existOneSubject= new Subject();
            existOneSubject.setParentId("0");//parent_id
            existOneSubject.setTitle(subjectData.getOneSubjectName());//一级分类名称
            subjectService.save(existOneSubject);
        }

        String pid = existOneSubject.getParentId();
        //添加二级分类
        //判断二级分类是否重复
        Subject existTwoSubject = this.existTwoSubject(subjectService, subjectData.getTwoSubjectName(), pid);
        if (existTwoSubject == null){//没有相同的一级分类，进行添加
            existTwoSubject= new Subject();
            existTwoSubject.setParentId(pid);//parent_id
            existTwoSubject.setTitle(subjectData.getTwoSubjectName());//一级分类名称
            subjectService.save(existTwoSubject);
        }
    }
    //读取excel表头信息
    @Override
    public void invokeHeadMap(Map<Integer, String> headMap, AnalysisContext context) {
        System.out.println("表头信息："+headMap);
    }

    //读取完成后执行
    @Override
    public void doAfterAllAnalysed(AnalysisContext analysisContext) {
    }

    //判断一级分类不能重复添加
    private Subject existOneSubject(SubjectService subjectService, String name){
        QueryWrapper<Subject> wrapper = new QueryWrapper<>();
        wrapper.eq("title",name);
        wrapper.eq("parent_id","0");
        Subject oneSubject = subjectService.getOne(wrapper);
        return oneSubject;
    }
    //判断二级分类不能重复添加
    private Subject existTwoSubject(SubjectService subjectService, String name,String pid){
        QueryWrapper<Subject> wrapper = new QueryWrapper<>();
        wrapper.eq("title",name);
        wrapper.eq("parent_id",pid);
        Subject oneSubject = subjectService.getOne(wrapper);
        return oneSubject;
    }
}
````

#### 5、测试

①准备好xlsx文件

![image-20220711211920018](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-59.png)

②postman进行测试

![image-20220711211850503](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-60.png)

**测试结果**

![image-20220711211957918](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-61.png)

## 二十三、前端页面的实现

**实现步骤**

![image-20220711221735577](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-62.png)

### 23.1、Excel模板

#### 1、编辑Excel模板

#### 2、将文件上传至阿里云OSS

![image-20220711212421203](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-63.png)

### 23.2、配置路由

#### 1、添加路由

````js
//课程分类管理
  {
    path: '/edu/subject',
    component: Layout,
    redirect: '/edu/subject/list',
    name: 'Subject',
    meta: { title: '课程分类管理', icon: '' },
    children: [
      {
        path: 'list',
        name: 'EduSubject',
        component: () => import('@/views/edu/subject/list'),
        meta: { title: '课程分类列表', icon: '' }
      },
      {
        path: 'import',
        name: 'EduSubjectImport',
        component: () => import('@/views/edu/subject/import'),
        meta: { title: '导入课程分类', icon: '' },
        hidden:false
      },
    ]
  },
````

#### 2、添加vue组件

![image-20220711215527909](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-64.png)

### 23.3、表单组件import.vue

#### 1、页面template

````html
<template>
  <div class="app-container">
    <el-form label-width="120px">
      <el-form-item label="信息秒数据">
        <el-tag type="info">excel模板说明</el-tag>
        <el-tag class="ml-5">
          <i class="el-icon-download"></i>
          <a :href="OSS_PATH+'/excel/%E8%AF%BE%E7%A8%8B%E5%88%86%E7%B1%BB%E5%88%97%E8%A1%A8%E6%A8%A1%E6%9D%BF.xlsx'">点击下载模板</a>
        </el-tag>

      </el-form-item>
      <el-form-item label="选择Excel">
        <el-upload
          ref="upload"
          :auto-upload="false"
          :on-success="fileUploadSuccess"
          :on-error="fileUploadError"
          :disabled="importBtnDisabled"
          :limit="1"
          :action="BASE_API+'/admin/edu/subject/addSubject'"
          name="file"
          accept="application/vnd.ms-excel">
          <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
          <el-button
            :loading="loading"
            style="margin-left: 10px;"
            size="small"
            type="success"
            @click="submitUpload">{{ fileUploadBtnText }}</el-button>
        </el-upload>
      </el-form-item>
    </el-form>
  </div>
</template>
````

#### 2、js定义数据

````js
  data() {
    // 定义数据模型
    return {
      BASE_API: 'http://localhost', // 接口API地址
      OSS_PATH: 'https://yangzhou-file.oss-cn-shanghai.aliyuncs.com', // 阿里云OSS地址
      fileUploadBtnText: '上传到服务器', // 按钮文字
      importBtnDisabled: false, // 按钮是否禁用,
      loading: false
    }
  },
````

#### 3、js上传方法

````js
  // 定义方法
  methods: {
    submitUpload() {
      this.fileUploadBtnText = '正在上传'
      this.importBtnDisabled = true
      this.loading = true
      this.$refs.upload.submit()
    },
    //上传成功
    fileUploadSuccess(){
      //提示信息
      this.loading = false
      this.$message({
        type:'success',
        message:'添加课程分类成功'
      })
    },
    //上传失败
    fileUploadError(){
      //提示信息
      this.loading = false
      this.$message({
        type:'error',
        message:'添加课程分类失败'
      })
    }
  },
````

![image-20220712143506961](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-65.png)

## 二十四、课程分类显示接口



### 24.1	创建实体类

````java
@Data
public class OneSubject {
    private String id;
    private String title;

    //一个一级分类有多个二级分类(用集合表示)
    private List<TwoSubject> children = new ArrayList<>();
}

@Data
public class TwoSubject {
    private String id;
    private String title;
}
````

### 24.2	创建Controller

````java
    //课程分类列表（树形）
    @GetMapping("getAllSubject")
    public R getAllSubjects(){
        //list集合泛型是一级分类
       List<OneSubject> list =  subjectService.getAllOneTwoSubject();
        return R.ok().data("list",list);
    
````

### 24.33	创建service

接口

````java
//课程分类列表（树形）
List<OneSubject> getAllOneTwoSubject();
````

实现类

````java
//课程分类列表（树形）
    @Override
    public List<OneSubject> getAllOneTwoSubject() {
        //1.查询出所有的一级分类  parent_id = 0
        QueryWrapper<Subject> wrapperOne = new QueryWrapper<>();
        wrapperOne.eq("parent_id",0);
        List<Subject> oneSubjectList = baseMapper.selectList(wrapperOne);

        //2.查询出所有的二级分类 parent_id != 0
        QueryWrapper<Subject> wrapperTwo = new QueryWrapper<>();
        wrapperTwo.ne("parent_id",0);
        List<Subject> twoSubjectList = baseMapper.selectList(wrapperTwo);

        //创建list集合，用于存储最终封装数据
        List<OneSubject> finalSubjectList = new ArrayList<>();

        //3.封装一级分类
        //查询出所有的一级分类list集合遍历，得到每个一级分类对象，获取每个一级分类对象值
        //封装到要求的list集合里面 List<Subject> finalSubjectList
        for (int i = 0; i < oneSubjectList.size(); i++) {//遍历oneSubjectList集合
        //    得到oneSubjectList每个subject对象
            Subject subject = oneSubjectList.get(i);

            //把subject里面的值获取出来，放到OneSubject对象里面
            OneSubject oneSubject = new OneSubject();
            // oneSubject.setId(subject.getId());
            // oneSubject.setTitle(subject.getTitle());
            //copyProperties(Object source,Object target)-复制属性
            //Subject值复制到oneSubject对象里面
            BeanUtils.copyProperties(subject,oneSubject);
            //多个OneSubject放到finalSubject里面
            finalSubjectList.add(oneSubject);

            //在一级分类循环里面遍历查询出来的所有二级分类
            //创建list集合封装每个一级分类的二级分类
            List<TwoSubject> twoFinalSubject = new ArrayList<>();
            //遍历二级分类list集合
           for (int j = 0;j<twoSubjectList.size();j++){
               //获取每个二级分类
               Subject tSubject = twoSubjectList.get(j);
               //判断二级分类的parent_id和一级分类的id是否一致
               if (tSubject.getParentId().equals(subject.getId())){
                   //tSubject值复制到TwoSubject里面，放到twoFinalSubject里面
                   TwoSubject twoSubject = new TwoSubject();
                   BeanUtils.copyProperties(tSubject,twoSubject);
                   twoFinalSubject.add(twoSubject);
               }
           }

           //把一级所有二级分类放到一级分类里面
            oneSubject.setChildren(twoFinalSubject);
        }
        return finalSubjectList;
    }
````

测试结果：

![image-20220712162502987](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-66.png)

## 二十五、课程分类前端显示

### 25.1	参考 views/tree/index.vue

### 25.2	创建api

api/edu/subject.js

````js
import request from "@/utils/request";

const api_name = '/admin/edu/subject'

export default {

  getNestedTreeList(){
    return request({
      url:`${api_name}/getAllSubject`,
      method: 'GET',
    })
  }
}
````

### 25.3	list.vue

````html
<template>
  <div class="app-container">
    <el-input v-model="filterText" placeholder="Filter keyword" style="margin-bottom:30px;"/>

    <el-tree
      ref="subjectTree"
      :data="subjectList"
      :props="defaultProps"
      :filter-node-method="filterNode"
      class="filter-tree"
      default-expand-all
    />

  </div>
</template>
````

### 25.4	method

````js
<script>
import subject from '@/api/edu/subject'
export default {

  data() {
    return {
      filterText: '',
      subjectList: [],
      defaultProps: {
        children: 'children',
        label: 'title'
      }
    }
  },
  watch: {
    filterText(val) {
      this.$refs.subjectTree.filter(val)
    }
  },
  created() {
    this.fetchNodeList()
  },
  methods: {
    fetchNodeList() {
      subject.getNestedTreeList().then(response => {
        if (response.code === 20000) {
          this.subjectList = response.data.list
        }
      })
    },
    filterNode(value, data) {
      if (!value) return true
      return data.title.indexOf(value) !== -1
    }
  }
}
</script>
````

![image-20220712164458310](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-67.png)

