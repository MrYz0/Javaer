---
title: 谷粒学院(中)
date: 2022-07-20 22:36:23
permalink: /pages/13137a/
titleTag: 项目学习
categories:
  - 项目
  - 谷粒学院
tags:
  - 谷粒学院
author: 
  name: 杨洲
  link: https://github.com/xugaoyi
---


# 谷粒学院（中）


## 二十六、课程发布表单-步骤导航

**实现步骤**

![image-20220712195531885](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-68.png)

 **课程相关表分析**

![image-20220712201839976](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-68-2.png)

### 26.1	需求

#### 填写课程基本信息

![img](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-69.png)

#### 创建课程大纲

![img](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-70.png)

#### 最终发布课程

![img](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-71.png)

### 26.2	配置路由

#### 1、添加路由

````js
//课程管理
  {
    path: '/edu/course',
    component: Layout,
    redirect: '/edu/course/list',
    name: 'Course',
    meta: { title: '课程管理', icon: 'form' },
    children: [
      {
        path: 'list',
        name: 'EduCourseList',
        component: () => import('@/views/edu/course/info'),
        meta: { title: '课程列表', icon: 'table' }
      },
      {
        path: 'info',
        name: 'EduCourseInfo',
        component: () => import('@/views/edu/course/info'),
        meta: { title: '发布课程' },
        hidden:false
      },
      {
        path: 'info/:id',
        name: 'EduCourseInfoEdit',
        component: () => import('@/views/edu/course/info'),
        meta: { title: '编辑课程基本信息', naCache: true },
        hidden:true
      },
      {
        path: 'chapter/:id',
        name: 'EduCourseChapterEdit',
        component: () => import('@/views/edu/course/chapter'),
        meta: { title: '编辑课程大纲',naCache: true },
        hidden:true
      },
      {
        path: 'publish/:id',
        name: 'EduCoursePublishEdit',
        component: () => import('@/views/edu/course/publish'),
        meta: { title: '发布课程',naCache: true },
        hidden:true
      },
    ]
  },
````

#### 2、添加vue组件

![image-20220712192517608](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-72.png)



### 26.3、整合步骤条组件

#### 1、课程信息页面

info.vue

````html
<template>
  <div class="app-container">
    <h2 style="text-align: center;">发布新课程</h2>
    <el-steps :active="1" process-status="wait" align-center style="margin-bottom: 40px;">
      <el-step title="填写课程基本信息"/>
      <el-step title="创建课程大纲"/>
      <el-step title="提交审核"/>
    </el-steps>
    <el-form label-width="120px">
      <el-form-item>
        <el-button :disabled="saveBtnDisabled" type="primary" @click="next">保存并下一步</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>
<script>
export default {
  data() {
    return {
      saveBtnDisabled: false // 保存按钮是否禁用
    }
  },
  created() {
    console.log('info created')
  },
  methods: {
    next() {
      console.log('next')
      this.$router.push({ path: '/edu/course/chapter/1' })
    }
  }
}
</script>
````

#### 2、课程大纲页面

chapter.vue

````html
<template>
  <div class="app-container">
    <h2 style="text-align: center;">发布新课程</h2>
    <el-steps :active="2" process-status="wait" align-center style="margin-bottom: 40px;">
      <el-step title="填写课程基本信息"/>
      <el-step title="创建课程大纲"/>
      <el-step title="提交审核"/>
    </el-steps>
    <el-form label-width="120px">
      <el-form-item>
        <el-button @click="previous">上一步</el-button>
        <el-button :disabled="saveBtnDisabled" type="primary" @click="next">下一步</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>
<script>
export default {
  data() {
    return {
      saveBtnDisabled: false // 保存按钮是否禁用
    }
  },
  created() {
    console.log('chapter created')
  },
  methods: {
    previous() {
      console.log('previous')
      this.$router.push({ path: '/edu/course/info/1' })
    },
    next() {
      console.log('next')
      this.$router.push({ path: '/edu/course/publish/1' })
    }
  }
}
</script>
````

#### 3、课程发布页面

publish.vue

````html
<template>
  <div class="app-container">
    <h2 style="text-align: center;">发布新课程</h2>
    <el-steps :active="3" process-status="wait" align-center style="margin-bottom: 40px;">
      <el-step title="填写课程基本信息"/>
      <el-step title="创建课程大纲"/>
      <el-step title="提交审核"/>
    </el-steps>
    <el-form label-width="120px">
      <el-form-item>
        <el-button @click="previous">返回修改</el-button>
        <el-button :disabled="saveBtnDisabled" type="primary" @click="publish">发布课程</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>
<script>
export default {
  data() {
    return {
      saveBtnDisabled: false // 保存按钮是否禁用
    }
  },
  created() {
    console.log('publish created')
  },
  methods: {
    previous() {
      console.log('previous')
      this.$router.push({ path: '/edu/course/chapter/1' })
    },
    publish() {
      console.log('publish')
      this.$router.push({ path: '/edu/course/list' })
    }
  }
}
</script>
````

## 二十七、编辑课程基本信息

![image-20220712203441555](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-73.png)

### 27.1、后台api

#### 1、定义form表单对象

CourseInfoVo.java

````java
package com.yz.eduservice.entity.vo;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

import java.io.Serializable;
import java.math.BigDecimal;

/**
 * @Author 杨洲
 * @Date 2022/7/12 20:36
 */
@ApiModel(value = "课程基本信息", description = "编辑课程基本信息的表单对象")
@Data
public class CourseInfoVo implements Serializable {

    private static final long serialVersionUID = 1L;

    @ApiModelProperty(value = "课程ID")
    private String id;

    @ApiModelProperty(value = "课程讲师ID")
    private String teacherId;

    @ApiModelProperty(value = "课程专业ID")
    private String subjectId;

    @ApiModelProperty(value = "课程标题")
    private String title;

    @ApiModelProperty(value = "课程销售价格，设置为0则可免费观看")
    //0.01
    private BigDecimal price;

    @ApiModelProperty(value = "总课时")
    private Integer lessonNum;

    @ApiModelProperty(value = "课程封面图片路径")
    private String cover;

    @ApiModelProperty(value = "课程简介")
    private String description;
}
````

#### 2、修改CourseDescription主键生成策略

````java
@ApiModelProperty(value = "课程ID")
@TableId(value = "id",type = IdType.INPUT)//手动输入
private String id;
````

#### 3、定义常量

实体类CourseInfoVo.Java中定义

````java
package com.yz.eduservice.entity.vo;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

import java.io.Serializable;
import java.math.BigDecimal;

/**
 * @Author 杨洲
 * @Date 2022/7/12 20:36
 */
@ApiModel(value = "课程基本信息", description = "编辑课程基本信息的表单对象")
@Data
public class CourseInfoVo implements Serializable {

    private static final long serialVersionUID = 1L;

    @ApiModelProperty(value = "课程ID")
    private String id;

    @ApiModelProperty(value = "课程讲师ID")
    private String teacherId;

    @ApiModelProperty(value = "课程专业ID")
    private String subjectId;

    @ApiModelProperty(value = "一级课程ID")
    private String subjectParentId;

    @ApiModelProperty(value = "课程标题")
    private String title;

    @ApiModelProperty(value = "课程销售价格，设置为0则可免费观看")
    //0.01
    private BigDecimal price;

    @ApiModelProperty(value = "总课时")
    private Integer lessonNum;

    @ApiModelProperty(value = "课程封面图片路径")
    private String cover;

    @ApiModelProperty(value = "课程简介")
    private String description;
}
````

#### 4、定义控制层接口

CourseController.java

````java
@ApiOperation(value = "新增课程")
@PostMapping("addCourseInfo")
public R addCourseInfo(@RequestBody CourseInfoVo courseInfoVo){
      courseService.saveCourseInfo(courseInfoVo);
      return R.ok();
}
````

#### 5、定义业务层方法

接口：CourseService.java

````java
public interface CourseService extends IService<Course> {
    //添加课程基本信息的方法
    void saveCourseInfo(CourseInfoVo courseInfoVo);
}
````

实现：CourseServiceImpl.java

````java
package com.yz.eduservice.service.impl;

import com.yz.eduservice.entity.Course;
import com.yz.eduservice.entity.CourseDescription;
import com.yz.eduservice.entity.vo.CourseInfoVo;
import com.yz.eduservice.mapper.CourseMapper;
import com.yz.eduservice.service.CourseDescriptionService;
import com.yz.eduservice.service.CourseService;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.yz.servicebase.exception.GuliException;
import org.springframework.beans.BeanUtils;
import org.springframework.stereotype.Service;

import javax.annotation.Resource;

@Service
public class CourseServiceImpl extends ServiceImpl<CourseMapper, Course> implements CourseService {
    //课程描述的注入
    @Resource
    private CourseDescriptionService courseDescriptionService;
    //添加课程基本信息的方法
    @Override
    public void saveCourseInfo(CourseInfoVo courseInfoVo) {
        //1.向课程表添加课程基本信息
        //CourseInfo对象==>Course对象
        Course course = new Course();
        BeanUtils.copyProperties(courseInfoVo,course);
        int insert = baseMapper.insert(course);
        if (insert <= 0){
            throw new GuliException(20001,"添加课程信息失败");
        }

        //获取添加之后课程id
        String cid = course.getId();

        //2.向课程简介表添加课程简介
        //edu_course_description
        CourseDescription courseDescription = new CourseDescription();
        courseDescription.setDescription(courseInfoVo.getDescription());
        //设置描述id就是课程id
        courseDescription.setId(cid);
        courseDescriptionService.save(courseDescription);
    }
}
````

### 27.2、前端实现

**实现步骤**

![image-20220712221226307](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-74.png)

#### 1、定义api

创建course.js

````js
import request from "@/utils/request";

const api_name = '/admin/edu/course'

export default {

  addCourseInfo(courseInfo){
    return request({
      url:`${api_name}/addCourseInfo`,
      method: 'POST',
      data: courseInfo,
    })
  }
}
````

#### 2、组件模板

````html
<el-form label-width="120px">
  <el-form-item label="课程标题">
    <el-input v-model="courseInfo.title" placeholder=" 示例：机器学习项目课：从基础到搭建项目视频课程。专业名称注意大小写"/>
  </el-form-item>
  <!-- 所属分类 TODO -->

  <!-- 课程讲师 TODO -->

  <el-form-item label="总课时">
    <el-input-number :min="0" v-model="courseInfo.lessonNum" controls-position="right" placeholder="请填写课程的总课时数"/>
  </el-form-item>
  <!-- 课程简介 TODO -->
  <el-form-item label="课程简介">
    <el-input v-model="courseInfo.description" />
  </el-form-item>

  <!-- 课程封面 TODO -->
    
  <el-form-item label="课程价格">
    <el-input-number :min="0" v-model="courseInfo.price" controls-position="right" placeholder="免费课程请设置为0元"/> 元
  </el-form-item>
  <el-form-item>
    <el-button :disabled="saveBtnDisabled" type="primary" @click="next">保存并下一步</el-button>
  </el-form-item>
</el-form>
````

#### 3、方法js

````js
<script>
import courseApi from "@/api/edu/course";
export default {
  data() {
    return {
      courseInfo:{
        title: '',
        subjectId: '',
        teacherId: '',
        lessonNum: 0,
        description: '',
        cover: '',
        price: 0

      },
      saveBtnDisabled: false // 保存按钮是否禁用
    }
  },
  created() {
    console.log('info created')
  },
  methods: {
    saveOrUpdate() {
      courseApi.addCourseInfo(this.courseInfo).then(response =>{
        //提示
        this.$message({
          type:'success',
          message:'添加课程信息成功'
        })
        return response //将响应结果传递给then
      }).then(response =>{
        //跳转到第二步
        this.$router.push({ path: '/edu/course/chapter/'+response.data.courseId})
      })
      console.log('next')
    }
  }
}
</script>
````

## 二十八、下拉列表显示所有讲师

### 28.1、前端实现

#### 1、组件模板

````html
      <!-- 课程讲师 -->
      <el-form-item label="课程讲师">
        <el-select
          v-model="courseInfo.teacherId"
          placeholder="请选择">
          <el-option
            v-for="teacher in teacherList"
            :key="teacher.id"
            :label="teacher.name"
            :value="teacher.id"/>
        </el-select>
      </el-form-item>
````

#### 2、定义api

course.js

````js
  //2.查询所有讲师
  getListTeacher(){
    return request({
      url:`/admin/edu/teacher/findAll`,
      method: 'GET',
    })
  }
````

#### 3、组件脚本

定义data

````js
  data() {
    return {
        ······
      teacherList:[], //封装所有讲师
    }
  },
````

表单初始化时获取讲师列表

````js
  created() {
    //初始化所有讲师
    this.getListTeacher()
  },
  methods: {
    //查询所有讲师
    getListTeacher() {
      courseApi.getListTeacher().then(response =>{
        this.teacherList = response.data.items
      })
    }
  }
````

实现结果:

![image-20220713130341586](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-75.png)

## 二十九、课程分类多级联动实现

### 29.1	需求

![img](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-76.png)

### 29.2	获取一级分类

#### 1、组件数据定义

定义在data中

````js
  data() {
    return {
        ······
      subjectNestedList: [],//一级分类列表
      subSubjectList: [],//二级分类列表
    }
  },
````

### 29.3	组件模板

````html
      <!-- 所属分类：级联下拉列表 -->
      <!-- 一级分类 -->
      <el-form-item label="课程类别">
        <el-select
          v-model="courseInfo.subjectParentId"
          placeholder="请选择">
          <el-option
            v-for="subject in subjectNestedList"
            :key="subject.id"
            :label="subject.title"
            :value="subject.id"/>
        </el-select>
      </el-form-item>
````

### 29.4	组件脚本

表单初始化时获取一级分类嵌套列表，引入subject api

````js
import subjectApi from "@/api/edu/subject";
````

定义方法

````js
created() {
    ·······
    //初始化一级分类
    this.getOneSubject()
  },
  methods: {
	·········
    //查询素有一级分类
    getOneSubject(){
      subjectApi.getNestedTreeList().then(response =>{
        this.subjectNestedList = response.data.list
      })
    }
  }
````

### 29.5	级联显示二级分类

#### 1、组件模板

````html
        <!-- 二级分类 -->
        <el-select v-model="courseInfo.subjectId" placeholder="请选择二级分类" class="ml-5">
          <el-option
            v-for="subject in subSubjectList"
            :key="subject.value"
            :label="subject.title"
            :value="subject.id"/>
        </el-select>
````

#### 2、注册change事件

在一级分类的`<el-select>`组件中注册change事件

````js
<el-select @change="subjectLevelOneChanged" ......
````

#### 3、定义change事件方法

````js
 //点击某个一级分类，出发change，显示对应二级分类
    subjectLevelOneChanged(value){
      //value就是一级分类id值
      //遍历所有的分类：包含一级和二级分类
      for (let i = 0; i < this.subjectNestedList.length; i++) {
        //判断所有一级分类id和点击一级分类id是否一样
        if (this.subjectNestedList[i].id === value) {
          //从一级分类获取里面所有的二级分类
          this.subSubjectList = this.subjectNestedList[i].children
          //把二级分类id值清空
          this.courseInfo.subjectId = ''
        }
      }
    }
````

实现结果：

![image-20220713132807542](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-77.png)

## 三十、课程封面

### 30.1、整合上传组件

#### 1、上传默认封面

创建文件夹cover，上传默认的课程封面

![image-20220713140411189](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-78.png)

#### 2、定义默认封面

````js
      courseInfo:{
        ·····
        cover: 'https://yangzhou-file.oss-cn-shanghai.aliyuncs.com/2022/07/11/java.png',
        price: 0
      },
````

#### 3、组件模板

在info.vue中添加上传组件模板

````html
       <!-- 课程封面-->
       <el-form-item label="课程封面">
         <el-upload
           :show-file-list="false"
           :on-success="handleAvatarSuccess"
           :before-upload="beforeAvatarUpload"
           :action="BASE_API+'/eduoss/file/upload'"
           class="avatar-uploader">
           <img :src="courseInfo.cover" >
         </el-upload>
       </el-form-item>
````

#### 4、结果回调

````js
    //上传封面成功
    handleAvatarSuccess(res, file){
      console.log(res)// 上传响应
      console.log(URL.createObjectURL(file.raw))// base64编码
      this.courseInfo.cover = res.data.url
    },
    //上传之前的方法
    beforeAvatarUpload(file){
      const isLt2M = file.size / 1024 / 1024 < 2
      if (!isLt2M) {
        this.$message.error('上传头像图片大小不能超过 2MB!')
      }
      return isLt2M
    },
````

实现结果

![image-20220713140617638](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-79.png)

## 三十一、整合富文本编辑器

### 31.1、Tinymce可视化编辑器

参考

https://panjiachen.gitee.io/vue-element-admin/#/components/tinymce

https://panjiachen.gitee.io/vue-element-admin/#/example/create

### 31.2、组件初始化

复制vue-element-admin

![image-20220713143859958](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-80.png)

放置component中

![image-20220713143924914](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-81.png)



### 31.3、组件引入

为了让Tinymce能用于Vue.js项目，vue-element-admin-master对Tinymce进行了封装，下面我们将它引入到我们的课程信息页面

#### 1、复制组件

src/components/Tinymce

#### 2、引入组件

课程信息组件中引入 Tinymce

````js
import Tinymce from '@/components/Tinymce'

export default {
  components: { Tinymce },
  ......
}
````

#### 3、组件模板

````html
<!-- 课程简介 -->
<el-form-item label="课程简介">
     <tinymce :height="300" v-model="courseInfo.description"/>
</el-form-item>
````

#### 4、组件样式

在info.vue文件的最后添加如下代码，调整上传图片按钮的高度

````html
<style scoped>
.tinymce-container {
  line-height: 29px;
}
</style>
````

#### 5、图片的base64编码

Tinymce中的图片上传功能直接存储的是图片的base64编码，因此无需图片服务器

实现结果：

![image-20220713145244484](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-82.png)

## 三十二、课程大纲列表

### 32.1、后端实现

#### 1、定义vo

ChapterVo

````java
@Data
@ApiModel(value = "章节信息")
public class ChapterVo {

    private String id;
    private String title;
    //表示小节
    private List<VideoVo> children = new ArrayList<>();
}
````

VideoVo

````java
@Data
@ApiModel(value = "课时信息")
public class VideoVo {

    private String id;
    private String title;
    private Boolean free;
}
````

#### 2、controller层

````java
@RestController
@RequestMapping("/admin/edu/chapter")
@Api(tags = "课程章节管理")
public class ChapterController {

    @Resource
    private ChapterService chapterService;

    //课程大纲列表,根据课程id进行查询
    @ApiOperation("课程大纲列表")
    @GetMapping("getChapterVideo")
    public R getChapterVideo(@PathVariable String courseId){
        List<ChapterVo> list = chapterService.getChapterVideoByCourseId(courseId);
        return R.ok().data("allChapterVideo",list);
    }
}
````

#### 3、服务层

接口

````java
public interface ChapterService extends IService<Chapter> {
    //课程大纲列表,根据课程id进行查询
    List<ChapterVo> getChapterVideoByCourseId(String courseId);
}
````

实现类

````java
package com.yz.eduservice.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.yz.eduservice.entity.Chapter;
import com.yz.eduservice.entity.Video;
import com.yz.eduservice.entity.vo.ChapterVo;
import com.yz.eduservice.entity.vo.VideoVo;
import com.yz.eduservice.mapper.ChapterMapper;
import com.yz.eduservice.service.ChapterService;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.yz.eduservice.service.VideoService;
import org.springframework.beans.BeanUtils;
import org.springframework.stereotype.Service;

import javax.annotation.Resource;
import java.util.ArrayList;
import java.util.List;

/**
 * <p>
 * 课程 服务实现类
 * </p>
 *
 * @author 杨洲
 * @since 2022-07-12
 */
@Service
public class ChapterServiceImpl extends ServiceImpl<ChapterMapper, Chapter> implements ChapterService {

    //注入videoService
    @Resource
    private VideoService videoService;

    //课程大纲列表,根据课程id进行查询
    @Override
    public List<ChapterVo> getChapterVideoByCourseId(String courseId) {

        //1.根据吋课程id查询课程里面的所有章节
        QueryWrapper<Chapter> wrapperChapter = new QueryWrapper<>();
        wrapperChapter.eq("course_id",courseId);
        List<Chapter> chapterList = baseMapper.selectList(wrapperChapter);

        //2.查询课程id查询课程里面的所有小节
        QueryWrapper<Video> wrapperVideo = new QueryWrapper<>();
        wrapperVideo.eq("course_id",courseId);
        List<Video> videoList = videoService.list(wrapperVideo);

        //创建list集合，用于最终封装集合
        ArrayList<ChapterVo> finalChapterList = new ArrayList<>();
        //3.遍历查询小节list集合，进行封装
        //遍历查询章节list集合
        for (int i = 0; i < chapterList.size(); i++) {
            //每个章节
            Chapter chapter = chapterList.get(i);
            //chapter对象值复制到chapterVo中
            ChapterVo chapterVo = new ChapterVo();
            BeanUtils.copyProperties(chapter,chapterVo);
            //把chapterVo放到最终list集合中
            finalChapterList.add(chapterVo);

            //创建集合，用于封装章节的小节
            List<VideoVo> videoVoList = new ArrayList<>();
            //4.遍历小节list集合，进行封装
            for (int j = 0; j < videoList.size(); j++) {
                //得到每个小节
                Video video = videoList.get(j);
                //判断：小节里面chapter_id和章节里面的id是否一样
                if (video.getChapterId().equals(chapter.getId())){
                    //进行封装
                    VideoVo videoVo = new VideoVo();
                    BeanUtils.copyProperties(video,videoVo);
                    //放到小节封装集合中
                    videoVoList.add(videoVo);
                }
            }
            //把封装之后的小节list集合，放到章节对象里面
            chapterVo.setChildren(videoVoList);

        }


        return finalChapterList;
    }
}
````

#### 4、Swagger测试

![image-20220714080535835](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-83.png)

### 32.2、前端实现

#### 1、定义api

chapter.js

````js
import request from "@/utils/request";

const api_name = '/admin/edu/chapter'

export default {

  getChapterVideo(courseId){
    return request({
      url:`${api_name}/getChapterVideo/${courseId}`,
      method:'GET',
    })
  }

}
````

#### 2、定义组件脚本

定义data

````js
courseId: '', // 所属课程

chapterNestedList: [] // 章节嵌套课时列表
````

created中调用init方法

````js
  created() {
    console.log('chapter created')
    //章节小节数据初始化
    this.init()
  },
````

定义相关methods获取章节和课时列表

````js
 methods: {
   ·······
    init(){
      //获取路由的id
      if (this.$route.params && this.$route.params.id) {
        this.courseId = this.$route.params.id
        //根据课程id查询章节和小节
        this.getChapterVideo()
      }
    },
    //根据课程id查询章节和小节
    getChapterVideo(){
      chapterApi.getChapterVideo(this.courseId).then(response => {
        this.chapterNestedList = response.data.allChapterVideo
      })
    }
  }
````

#### 3、定义组件模板

````html
<!-- 章节 -->
    <ul  class="chapterList">
      <li v-for="chapter in chapterNestedList"
          :key="chapter.id">
        <p>
          {{ chapter.title }}
          <span class="acts">
                <el-button type="primary">添加课时</el-button>
                <el-button style="" type="warning">编辑</el-button>
                <el-button type="danger">删除</el-button>
            </span>
        </p>
        <!-- 视频 -->
        <ul class="chapterList videoList">
          <li
            v-for="video in chapter.children"
            :key="video.id">
            <p>{{ video.title }}
              <span class="acts">
                        <el-button type="warning">编辑</el-button>
                        <el-button type="danger">删除</el-button>
                    </span>
            </p>
          </li>
        </ul>
      </li>
    </ul>

````

#### 4、定义样式

将样式的定义放在页面的最后

scope表示这里定义的样式只在当前页面范围内生效，不会污染到其他的页面

````css
<style scoped>
.chapterList{
  position: relative;
  list-style: none;
  margin: 0;
  padding: 0;
}
.chapterList li{
  position: relative;
}
.chapterList p{
  position: relative;
  float: left;
  font-size: 20px;
  margin: 10px 0;
  padding: 10px;
  height: 70px;
  line-height: 50px;
  width: 100%;
  border: 1px solid #DDD;
}
.chapterList .acts {
  position: relative;
  z-index: 1;
  float: right;
  font-size: 14px;
}
.videoList{
  padding-left: 50px;
}
.videoList p{
  float: left;
  font-size: 14px;
  margin: 10px 0;
  padding: 10px;
  height: 50px;
  line-height: 30px;
  width: 100%;
  border: 1px dotted #DDD;
}
</style>
````

实现结果：

![image-20220714083334974](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/guli-84.png)

## 三十三、修改课程信息回显

### 33.1、接口定义

````java
    //根据课程id查询课程基本信息
    @GetMapping("getCourseInfo/{courseId}")
    public R getCourseInfo(@PathVariable("courseId") String courseId){
        CourseInfoVo courseInfoVo = courseService.getCourseInfo(courseId);
        return R.ok().data("courseInfoVo",courseInfoVo);
    }
````

### 33.2、业务层

接口

````java
    //根据课程id查询课程基本信息
    CourseInfoVo getCourseInfo(String courseId);
    //修改课程信息
    void updateCourseInfo(CourseInfoVo courseInfoVo);
````

实现类

````java
    //根据课程id查询课程基本信息
    @Override
    public CourseInfoVo getCourseInfo(String courseId) {
        //1.查询课程表
        Course course = baseMapper.selectById(courseId);
        CourseInfoVo courseInfoVo = new CourseInfoVo();
        BeanUtils.copyProperties(course,courseInfoVo);

        //2.查询课程简介表
        CourseDescription courseDescription = courseDescriptionService.getById(courseId);
        courseInfoVo.setDescription(courseDescription.getDescription());

        return courseInfoVo;
    }
    //修改课程信息
    @Override
    public void updateCourseInfo(CourseInfoVo courseInfoVo) {
        Course course = new Course();
        BeanUtils.copyProperties(courseInfoVo,course);
        //1.修改课程表
        int update = baseMapper.updateById(course);

        if (update <= 0){
            throw new GuliException(20001,"修改课程信息失败");
        }
        //2.修改描述表
        CourseDescription courseDescription = new CourseDescription();
        courseDescription.setId(courseInfoVo.getId());
        courseDescription.setDescription(courseInfoVo.getDescription());
        courseDescriptionService.updateById(courseDescription);
    }
````

### 33.3、前端实现

#### 1、定义api

api/edu/course.js

````js
  //3.根据课程id插叙课程信息
  getCourseInfo(id){
    return request({
      url:`${api_name}/getCourseInfo/${id}`,
      method: 'GET',
    })
  },
````

#### 2、组件js

````js
  created() {
    //获取路由id值
    if (this.$route.params && this.$route.params.id) {
      this.courseId = this.$route.params.id
    	//调用根据课程id查询课程的方法
      this.getCourseInfo()
    }
  },
  methods: {
    //根据课程id查询课程信息
    getCourseInfo() {
      courseApi.getCourseInfo(this.courseId).then(response => {
        //在courseInfo课程基本信息，包含一级分类id和二级分类id
        this.courseInfo = response.data.courseInfoVo
        })
      })
    },
  }        
````

### 33.4、解决级联下拉菜单回显问题

<span style="color:red">视频：P121</span>

#### 1、数据库中增加冗余列

    ````java
    subject_parent_id 课程专业父级ID
    ````

#### 2、vue组件中绑定数据

edu/course/infoinfo.vue

````html
<el-select v-model="courseInfo.subjectParentId" ......
````

#### 4、修改create方法

将 this.getOneSubject() 和 this.getListTeacher()移至else

````js
  created() {
    //获取路由id值
    if (this.$route.params && this.$route.params.id) {
      this.courseId = this.$route.params.id
      //
    //  调用根据课程id查询课程的方法
      this.getCourseInfo()
    }else{
      //初始化所有讲师
      this.getListTeacher()
      //初始化一级分类
      this.getOneSubject()
    }
    console.log('info created')
  },
````

#### 5、修改getCourseInfo方法

````js
  methods: {
    //根据课程id查询课程信息
    getCourseInfo() {
      courseApi.getCourseInfo(this.courseId).then(response => {
        //在courseInfo课程基本信息，包含一级分类id和二级分类id
        this.courseInfo = response.data.courseInfoVo
        //1.查询出所有分类，包含一级和二级
        subjectApi.getNestedTreeList().then(response => {
          //2.获取所有的一级分类
          this.subjectNestedList = response.data.list

          //3.把所有一级分类的数组进行遍历，
          for (var i = 0;i<this.subjectNestedList.length;i++){
            //获取每一个一级分类
            var oneSubject = this.subjectNestedList[i];
            //比较当前courseInfo里面的一级分类id和所有的一级分类id是否相同
            if (this.courseInfo.subjectParentId == oneSubject.id){
              //获取一级分类中所有二级分类
              this.subSubjectList = oneSubject.children
            }
          }
        })
        //初始化所有讲师
        this.getListTeacher()
      })
    },
  }        
````

## 三十四、更新课程信息

### 34.1、后端实现

#### 1、接口定义

````java
    //修改课程信息
    @PostMapping("updateCourseInfo")
    public R updateCourseInfo(@RequestBody CourseInfoVo courseInfoVo){
        courseService.updateCourseInfo(courseInfoVo);

        return R.ok();
    }
````

#### 2、业务层

接口

````java
    //修改课程信息
    void updateCourseInfo(CourseInfoVo courseInfoVo);
````

实现类

````java
    //修改课程信息
    @Override
    public void updateCourseInfo(CourseInfoVo courseInfoVo) {
        Course course = new Course();
        BeanUtils.copyProperties(courseInfoVo,course);
        //1.修改课程表
        int update = baseMapper.updateById(course);

        if (update <= 0){
            throw new GuliException(20001,"修改课程信息失败");
        }
        //2.修改描述表
        CourseDescription courseDescription = new CourseDescription();
        courseDescription.setId(courseInfoVo.getId());
        courseDescription.setDescription(courseInfoVo.getDescription());
        courseDescriptionService.updateById(courseDescription);
    }
````

### 34.2、前端实现

#### 1、定义api

course.js

````js
  //4.修改课程
  updateCourseInfo(courseInfoVo){
    return request({
      url:`${api_name}/updateCourseInfo`,
      method:'POST',
      data:courseInfoVo
    })
  }
````

#### 2、组件js

info.vue

````js
    //修改课程
    updateCourse(){
      courseApi.updateCourseInfo(this.courseInfo).then(response=>{
        //提示
        this.$message({
          type:'success',
          message:'修改课程信息成功'
        })
        return response //将响应结果传递给then
      }).then(response =>{
        //跳转到第二步
        this.$router.push({ path: '/edu/course/chapter/'+this.courseId})
      })
    },
````

## 三十五、章节管理后端接口开发

### 35.1、新增章节

web层

````java
    @ApiOperation("添加课程章节")
    @PostMapping("addChapter")
    public R addChapter(@RequestBody Chapter chapter){
        chapterService.save(chapter);
        return R.ok();
    }
````



### 35.2、根据id查询

web层

````java
    @ApiOperation("根据id查询课程章节")
    @GetMapping("getChapterInfo/{chapterId}")
    public R getChapterInfo(@PathVariable("chapterId") String chapterId){
        Chapter chapter = chapterService.getById(chapterId);
        return R.ok().data("chapter",chapter);
    }
````



### 35.3、更新

web层

````java
    @ApiOperation("修改课程章节")
    @PostMapping("updateChapter")
    public R updateChapter(@RequestBody Chapter chapter){
        chapterService.updateById(chapter);
        return R.ok();
    }
````



### 35.4、删除

#### 1、web层

````java
    @ApiOperation(value = "根据ID删除章节")
    @DeleteMapping("deleteChapter/{chapterId}")
    public R deleteChapter(@PathVariable("chapterId") String chapterId){
      boolean result = chapterService.removeChapterById(chapterId);
      if (result){
          return R.ok();
      }else{
          return R.error();
      }
    }
````

#### 2、Service

ChapterService层：接口

````java
    boolean removeChapterById(String chapterId);
````

ChapterService层：实现

````java
    @Override
    public boolean removeChapterById(String chapterId) {
        //根据id查询是否存在视频，如果有则提示用户尚有子节点
        if (videoService.getCountByChapterId(chapterId)){
            throw new GuliException(20001,"该分章节下存在视频课程，请先删除视频课程");
        }
        int result = baseMapper.deleteById(chapterId);
        return result > 0;
    }

````

VideoService：接口

````java
    boolean getCountByChapterId(String chapterId);
````

VideoService：实现

````java
    @Override
    public boolean getCountByChapterId(String chapterId) {
        QueryWrapper<Video> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("chapter_id", chapterId);
        Long count = baseMapper.selectCount(queryWrapper);
        return count > 0;
    }
````

## 三十六、章节管理前端页面实现

### 36.1、定义api

 ````js
import request from "@/utils/request";

const api_name = '/admin/edu/chapter'

export default {

    ·····
  //添加章节
  addChapter(chapter){
    return request({
      url:`${api_name}/addChapter`,
      method:'POST',
      data: chapter
    })
  },
  //删除章节
  deleteChapter(courseId){
    return request({
      url:`${api_name}/deleteChapter/${courseId}`,
      method:'delete',
    })
  },
  //修改章节
  updateCourse(chapter) {
    return request({
      url:`${api_name}/updateChapter`,
      method:'POST',
      data: chapter
    })
  },
  //根据id查询章节
  getChapterById(chapterId){
    return request({
      url:`${api_name}/getChapterInfo/${chapterId}`,
      method:'GET',
    })
  }
}
 ````

### 36.2、新增章节页面功能

#### 1、定义data数据

````js
dialogChapterFormVisible: false, //是否显示章节表单
chapter: {// 章节对象
   	title: '',
  	sort: 0
},	
````

#### 2、添加章节按钮

````html
<!--  添加  -->
<el-button type="primary" @click="openChapterDialog()" >添加章节</el-button>
````

#### 3、章节表单dialog

````html
<!-- 添加和修改章节表单 -->
    <el-dialog :visible.sync="dialogChapterFormVisible" title="添加章节">
      <el-form :model="chapter" label-width="120px">
        <el-form-item label="章节标题">
          <el-input v-model="chapter.title"/>
        </el-form-item>
        <el-form-item label="章节排序">
          <el-input-number v-model="chapter.sort" :min="0" controls-position="right"/>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button @click="dialogChapterFormVisible = false">取 消</el-button>
        <el-button type="primary" @click="saveOrUpdate">确 定</el-button>
      </div>
    </el-dialog>
````

#### 4、添加章节methods

````js
methods: {
    //弹窗添加章节页面
    openChapterDialog(){
      //弹窗
      this.dialogChapterFormVisible = true
      //表单数据情况
      this.chapter.title = ''
      this.chapter.sort = 0
    },
    //添加章节
    saveChapter(){
      //设置课程id到chapter对象里面
      this.chapter.courseId = this.courseId
      chapterApi.addChapter(this.chapter).then(response=>{
        //关闭弹窗
        this.dialogChapterFormVisible = false
        //提示
        this.$message({
          type:'success',
          message:'添加章节成功'
        })
        //刷新页面
        this.getChapterVideo()
      })
    },
    //添加和修改
    saveOrUpdate(){
      this.saveChapter()
    },
    ····
  }
````

### 36.3、修改章节信息

#### 1、编辑章节按钮

````html
<el-button type="text" @click="openEditChapter(chapter.id)">编辑</el-button>
````

#### 2、定义查询方法

<span style="color:red">先查询后修改</span>

````js
    //修改章节弹框数据回显
    openEditChapter(chapterId){
      //弹窗
      this.dialogChapterFormVisible = true
      //调用接口
      chapterApi.getChapterById(chapterId).then(response=>{
        this.chapter = response.data.chapter
      })
    },
````

#### 3、定义更新方法

````js
    //修改
    updateChapter(){
      chapterApi.updateChapter(this.chapter).then(response=>{
        //关闭弹窗
        this.dialogChapterFormVisible = false
        //提示
        this.$message({
          type:'success',
          message:'修改章节成功'
        })
        //刷新页面
        this.getChapterVideo()
      })
    },
````

### 36.4、删除章节

#### 1、按钮

````html
<el-button type="text" @click="removeChapter(chapter.id)">删除</el-button>
````

#### 2、定义删除方法

````js
 //删除章节
    removeChapter(courseId){
      this.$confirm('此操作将永久删除该章节, 是否继续?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        chapterApi.deleteChapter(courseId).then(response => {
          this.getChapterVideo()
          //提示
          this.$message({
            type:'success',
            message:'删除章节成功'
          })
        })
      }).catch(() => {
        this.$message({
          type: 'info',
          message: '已取消删除'
        });
      });
    },
````

## 三十七、课时管理后端开发

### 37.1、新增小节

web层

````java
	@ApiOperation("增加小节")
    @PostMapping("addVideo")
    public R addVideo(@RequestBody Video video){
        videoService.save(video);
        return R.ok();
    }
````

### 37.2、根据id查询

web层

````java
    @ApiOperation(value = "根据ID查询课时")
    @GetMapping("videoInfo/{id}")
    public R getVideInfoById(
            @ApiParam(name = "id", value = "课时ID", required = true)
            @PathVariable String id){
         Video video = videoService.getById(id);
         return R.ok().data("video", video);
    }
````

### 37.3、更新

web层

````java
    @ApiOperation(value = "更新课时")
    @PostMapping("updateVideo/{id}")
    public R updateCourseInfoById(
        @ApiParam(name = "video", value = "课时基本信息", required = true)
        @RequestBody Video video
        ){
        videoService.updateById(video);
        return R.ok();
    }
````

### 37.4、删除

web层

````java
    @ApiOperation("删除小节")
    @DeleteMapping("deleteVideo/{id}")
    public R deleteVideo(@PathVariable("id") String id){
        videoService.removeById(id);
        return R.ok();
    }
````

## 三十八、课时管理前端开发

### 38.1、定义api

````js
import request from "@/utils/request";

const api_name = '/admin/edu/video'

export default {
  //新增小节
  saveVideoInfo(video){
    return request({
      url: `${api_name}/addVideo`,
      method: 'POST',
      data:video
    })
  },
  deleteVideoInfo(id){
    return request({
      url:`${api_name}/deleteVideo/${id}`,
      method: 'DELETE',
    })
  },
  updateVideoInfo(video){
    return request({
      url:`${api_name}/updateVideo/`,
      method: 'POST',
      data:video
    })
  },
  getVideoInfoById(id) {
    return request({
      url: `${api_name}/videoInfo/${id}`,
      method: 'get'
    })
  },
}
````

### 38.2、新增小节功能

#### 1、定义data数据

````js
video: {// 课时对象
    title: '',
    sort: 0,
    free: 0,
    videoSourceId: ''
},
dialogVideoFormVisible: false,//小节弹窗
saveVideoBtnDisabled:false,
````

#### 2、添加小节按钮

````html
<el-button type="primary" icon="el-icon-plus" @click="openVideo(chapter.id)">添加课时</el-button>
````

#### 3、小节表单dialog

````html
 <!-- 添加和修改课时表单 -->
    <el-dialog :visible.sync="dialogVideoFormVisible" title="添加课时">
      <el-form :model="video" label-width="120px">
        <el-form-item label="课时标题">
          <el-input v-model="video.title"/>
        </el-form-item>
        <el-form-item label="课时排序">
          <el-input-number v-model="video.sort" :min="0" controls-position="right"/>
        </el-form-item>
        <el-form-item label="是否免费">
          <el-radio-group v-model="video.free">
            <el-radio :label="true">免费</el-radio>
            <el-radio :label="false">默认</el-radio>
          </el-radio-group>
        </el-form-item>
        <el-form-item label="上传视频">
          <!-- TODO -->
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button @click="dialogVideoFormVisible = false">取 消</el-button>
        <el-button :disabled="saveVideoBtnDisabled" type="primary" @click="saveOrUpdateVideo">确 定</el-button>
      </div>
    </el-dialog>
````

#### 4、添加小节methods

````js
//添加小节弹窗的方法
    openVideo(chapterId){
      //弹窗
      this.dialogVideoFormVisible = true
      this.saveVideoBtnDisabled = false
      //设置小节id
      this.video.chapterId = chapterId
    },
    addVideo(){
      //设置课程id到video对象里面
      this.video.courseId = this.courseId
      videoApi.saveVideoInfo(this.video).then(response => {
        //关闭弹窗
        this.dialogVideoFormVisible = false
        this.$message({
          type: 'success',
          message: '添加小节成功'
        });
        this.getChapterVideo()
      })
    },
    //添加和修改小节
    saveOrUpdateVideo(){
      this.saveVideoBtnDisabled = true
      this.addVideo()
    },
````

### 38.3、修改小节信息

#### 1、编辑小节按钮

````html
<el-button type="warning" icon="el-icon-edit" @click="openEditVideo(video.id)">编辑</el-button>
````

#### 2、定义定义查询方法

<span style="color:red">先查询后修改</span>

````js
    //修改小节弹框数据回显
    openEditVideo(id){
      this.dialogVideoFormVisible = true
      videoApi.getVideoInfoById(id).then(response =>{
        this.video = response.data.video
      })
    },
````

#### 3、定义更新方法

````js
    //修改小节
    updateVideoInfo() {
      videoApi.updateVideoInfo(this.video).then(response=>{
        this.dialogVideoFormVisible = false
        this.$message({
          type: 'success',
          message: '修改小节成功'
        });
        this.getChapterVideo()
      })
    },
````

### 38.4、删除小节

#### 1、按钮

````html
<el-button type="danger" icon="el-icon-delete" @click="removeVideo(video.id)">删除</el-button>
````

#### 2、定义删除方法

````js
    removeVideo(id){
      this.$confirm('此操作将永久删除该小节, 是否继续?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
       videoApi.deleteVideoInfo(id).then(response => {
          this.getChapterVideo()
          //提示
          this.$message({
            type:'success',
            message:'删除章节成功'
          })
        })
      }).catch(() => {
        this.$message({
          type: 'info',
          message: '已取消删除'
        });
      });
    },
````

## 三十九、课程最终发布后端

### 39.1、根据id查询课程发布信息 

方式一：业务层组装多个表多次的查询结果

方式二：数据访问层进行关联查询

我们使用第二种方式实现

![image-20220729210005973](http://yz-typora-img.oss-cn-shanghai.aliyuncs.com/img/image-20220729210005973.png)

#### 1、定义vo

在包com.yz.eduservice.entity.vo下，创建CoursePublishVo.java

````java
package com.yz.eduservice.entity.vo;

import io.swagger.annotations.ApiModel;
import lombok.Data;

import java.io.Serializable;

/**
 * @Author 杨洲
 * @Date 2022/7/15 22:53
 */
@ApiModel(value = "课程发布信息")
@Data
public class CoursePublishVo  implements Serializable {

    private static final long serialVersionUID = 1L;

    private String id;
    private String title;

    private String cover;

    private Integer lessonNum;

    private String subjectLevelOne;
    private String subjectLevelTwo;

    private String teacherName;

    private String price;//只用于显示
}
````

#### 2、数据访问层

接口：CourseMapper.java

````java
@Mapper
public interface CourseMapper extends BaseMapper<Course> {

    public CoursePublishVo getPublishCourseInfo(String courseId);
}

````

实现：CourseMapper.xml

````xml
    <!--  根据课程id查询课程确认信息  -->
    <select id="getPublishCourseInfo" resultType="com.yz.eduservice.entity.vo.CoursePublishVo">
        SELECT ec.id,ec.title,ec.price,ec.lesson_num AS lessonNum,ec.cover,
               et.name AS teacherName,
               es1.title AS subjectLevelOne,
               es2.title AS subjectLevelTwo
        FROM edu_course ec
                 LEFT JOIN edu_course_description ecd on ec.id = ecd.id
                 LEFT JOIN edu_teacher et on ec.teacher_id = et.id
                 LEFT JOIN edu_subject es1 on ec.subject_parent_id = es1.id
                 LEFT JOIN edu_subject es2 on ec.subject_id = es2.id
        WHERE ec.id = #{courseId}

    </select>
````

#### 3、业务层

接口：CourseService.java

````java
CoursePublishVo publishCourseInfo(String id);
````

实现：CourseServiceImpl.java

````java
    //根据ID获取课程发布信息
    @Override
    public CoursePublishVo publishCourseInfo(String id) {
        CoursePublishVo publishCourseInfo = baseMapper.getPublishCourseInfo(id);
        return publishCourseInfo;
    }
````

#### 4、controller层

````java
    @ApiOperation(value = "根据ID获取课程发布信息")
    @GetMapping("getPublishCourseInfo/{id}")
    public R getPublishCourseInfo(@PathVariable String id){
        CoursePublishVo coursePublishVo = courseService.publishCourseInfo(id);
        return R.ok().data("publishCourse",coursePublishVo);
    }
````

### 39.2、根据id发布课程

#### 1、controller层

````java
    @ApiOperation(value = "根据id发布课程")
    @PutMapping("publishCourse/{id}")
    public R publishCourse(
            @ApiParam(name = "id", value = "课程ID", required = true)
            @PathVariable String id){
        courseService.publishCourseById(id);
        return R.ok();
    }
````

#### 2、service层

接口

````java
boolean publishCourseById(String id);
````

实现

````java
@Override
    public boolean publishCourseById(String id) {
        Course course = new Course();
        course.setId(id);
        course.setStatus("Normal");//设置发布课程状态
        int result = baseMapper.updateById(course);
        return  result>0;
    }
````

## 四十、课程最终发布前端

### 40.1、定义api

分析这个页面一共有两个远程方法：一个是根基课程id获取课程基本预览信息，第二个是发布课程

````js
//  课程确认信息显示
  getCoursePublishInfoById(id) {
    return request({
      url: `${api_name}/getPublishCourseInfo/${id}`,
      method: 'get'
    })
  },
  //课程最终发布
  publishCourse(id) {
    return request({
      url: `${api_name}/publishCourse/${id}`,
      method: 'PUT',
    })
  },
````

### 40.2、定义数据模型

````js
  data() {
    return {
      saveBtnDisabled: false, // 保存按钮是否禁用
      courseId:'',// 所属课程
      coursePublish: {},
    }
  },
````

### 40.3、完善步骤导航

edu/course/chapter.vue

````js
    previous() {
      console.log('previous')
      this.$router.push({ path: '/edu/course/info/'+this.courseId })
    },
    next() {
      console.log('next')
      this.$router.push({ path: '/edu/course/publish/'+this.courseId})
    },
````

edu/course/pubish.js

````html
<div>
      <el-button @click="previous">返回修改</el-button>
      <el-button :disabled="saveBtnDisabled" type="primary" @click="publish">发布课程</el-button>
</div>
````

````js
    previous() {
      console.log('previous')
      this.$router.push({ path: '/edu/course/chapter/'+ this.courseId  })
    },
    publish() {
      console.log('publish')
      courseApi.publishCourse(this.courseId).then(response=>{
        //提示
        this.$message({
          type:'success',
          message:'发布课程成功'
        })
        //跳转课程列表页面
        this.$router.push({ path: '/edu/course/list' })
      })
    }
````

### 40.4、组件方法定义

import

````js
import courseApi from "@/api/edu/course";
````

created

````js
 created() {
    console.log('publish created')
    //获取路由里面的课程id
    if (this.$route.params && this.$route.params.id){
      this.courseId = this.$route.params.id

    }
    //根据调用接口方法根据课程id查询
    this.getCoursePublishInfoById()
  },
````

获取数据的方法

````js
  methods: {
    //根据课程id查询
    getCoursePublishInfoById() {
      courseApi.getCoursePublishInfoById(this.courseId).then(response=>{
        this.coursePublish = response.data.publishCourse
      })
    },
  }        
````

### 40.5、组件模板

````html
<template>
  <div class="app-container">
    <h2 style="text-align: center;">发布新课程</h2>
    <el-steps :active="3" process-status="wait" align-center style="margin-bottom: 40px;">
      <el-step title="填写课程基本信息"/>
      <el-step title="创建课程大纲"/>
      <el-step title="发布课程"/>
    </el-steps>
	<div class="ccInfo">
      <img :src="coursePublish.cover">
      <div class="main">
        <h2>{{ coursePublish.title }}</h2>
        <p class="gray"><span>共{{ coursePublish.lessonNum }}课时</span></p>
        <p><span>所属分类：{{ coursePublish.subjectLevelOne }} — {{ coursePublish.subjectLevelTwo }}</span></p>
        <p>课程讲师：{{ coursePublish.teacherName }}</p>
        <h3 class="red">￥{{ coursePublish.price }}</h3>
      </div>
    </div>
    <div>
      <el-button @click="previous">返回修改</el-button>
      <el-button :disabled="saveBtnDisabled" type="primary" @click="publish">发布课程</el-button>
    </div>
  </div>
</template>
````

### 40.6、css样式

```css
.ccInfo {
    background: #f5f5f5;
    padding: 20px;
    overflow: hidden;
    border: 1px dashed #DDD;
    margin-bottom: 40px;
    position: relative;
}
.ccInfo img {
    background: #d6d6d6;
    width: 500px;
    height: 278px;
    display: block;
    float: left;
    border: none;
}
.ccInfo .main {
    margin-left: 520px;
}
.ccInfo .main h2 {
    font-size: 28px;
    margin-bottom: 30px;
    line-height: 1;
    font-weight: normal;
}
.ccInfo .main p {
    margin-bottom: 10px;
    word-wrap: break-word;
    line-height: 24px;
    max-height: 48px;
    overflow: hidden;
}
.ccInfo .main p {
    margin-bottom: 10px;
    word-wrap: break-word;
    line-height: 24px;
    max-height: 48px;
    overflow: hidden;
}
.ccInfo .main h3 {
    left: 540px;
    bottom: 20px;
    line-height: 1;
    font-size: 28px;
    color: #d32f24;
    font-weight: normal;
    position: absolute;
}
```



